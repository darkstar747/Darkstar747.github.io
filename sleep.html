<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crash Clock & Nervous System Load Index – Prototype 1</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="Prototype timing tool that combines a crash clock, nervous system load index, and emotional lag to explain why you feel off."
  />

  <style>
    :root {
      --bg: #05070a;
      --card: #10131a;
      --card-soft: #151925;
      --border-subtle: #252a38;
      --text-main: #e0e3ec;
      --text-muted: #a0a6b5;
      --accent: #4cc9f0;
      --accent-soft: rgba(76, 201, 240, 0.1);
      --accent-strong: #f72585;
      --radius-lg: 14px;
      --radius-md: 10px;
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.6);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, -webkit-system-font,
        "Segoe UI", Roboto, sans-serif;
      background: radial-gradient(circle at top, #131729 0, #05070a 55%);
      color: var(--text-main);
      display: flex;
      justify-content: center;
      padding: 20px 12px 36px;
      scroll-behavior: smooth;
    }

    main {
      width: 100%;
      max-width: 940px;
      position: relative;
    }

    /* Top nav */
    .top-nav {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 8px;
      opacity: 0.9;
    }

    .top-nav a {
      color: var(--text-muted);
      text-decoration: none;
      margin-left: 12px;
    }

    .top-nav a:hover {
      color: var(--accent);
      text-decoration: underline;
    }

    .card {
      background: linear-gradient(135deg, #10131a, #151925);
      border-radius: 20px;
      padding: 20px 14px 22px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(255, 255, 255, 0.06);
      margin-bottom: 16px;
    }

    @media (min-width: 720px) {
      .card {
        padding: 24px 24px 26px;
      }
    }

    h1 {
      font-size: 1.8rem;
      margin: 0 0 6px;
      letter-spacing: 0.01em;
    }

    h2 {
      font-size: 1.15rem;
      margin: 0 0 10px;
    }

    h3 {
      font-size: 1rem;
      margin: 14px 0 6px;
    }

    p {
      margin: 6px 0 8px;
      color: var(--text-muted);
      line-height: 1.5;
    }

    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: var(--text-muted);
    }

    select,
    input[type="range"] {
      width: 100%;
      margin-bottom: 10px;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: #080a11;
      color: var(--text-main);
      font-size: 0.9rem;
      outline: none;
    }

    input[type="range"] {
      padding: 0;
      height: 28px;
    }

    .range-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: -4px;
      margin-bottom: 8px;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media (min-width: 760px) {
      .row.two {
        grid-template-columns: 1.15fr 1fr;
      }
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.8rem;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.06);
      background: rgba(8, 10, 18, 0.9);
      color: var(--text-muted);
      margin-right: 6px;
      margin-top: 4px;
    }

    .pill.accent {
      background: var(--accent-soft);
      border-color: rgba(76, 201, 240, 0.6);
      color: var(--accent);
    }

    .primary-btn {
      margin-top: 8px;
      padding: 9px 18px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), #4895ef);
      color: #05070a;
      font-weight: 600;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      box-shadow: 0 14px 30px rgba(0, 0, 0, 0.7);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.1s ease;
    }

    .primary-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 18px 40px rgba(0, 0, 0, 0.8);
    }

    .metrics-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 8px;
    }

    @media (min-width: 760px) {
      .metrics-grid {
        grid-template-columns: 1.15fr 1fr;
      }
    }

    .metric-card {
      border-radius: var(--radius-lg);
      background: radial-gradient(circle at top left, rgba(76, 201, 240, 0.12), #10131a 60%);
      border: 1px solid rgba(255, 255, 255, 0.06);
      padding: 14px 12px 12px;
    }

    .metric-title {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .metric-value {
      font-size: 1.6rem;
      font-weight: 600;
    }

    .metric-sub {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .metric-value.low {
      color: #4cc9f0;
    }
    .metric-value.medium {
      color: #f9c74f;
    }
    .metric-value.high {
      color: #f72585;
    }

    .timeline-chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .timeline-chip {
      font-size: 0.8rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      background: #080a11;
      color: var(--text-muted);
    }

    .timeline-chip.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--accent);
    }

    /* Timeline bar */
    .timeline-bar {
      margin-top: 10px;
    }

    .timeline-track {
      width: 100%;
      height: 8px;
      border-radius: 999px;
      background: #080a11;
      border: 1px solid rgba(255, 255, 255, 0.06);
      overflow: hidden;
      position: relative;
    }

    .timeline-fill {
      height: 100%;
      width: 0%;
      border-radius: inherit;
      background: linear-gradient(90deg, var(--accent), var(--accent-strong));
      box-shadow: 0 0 8px rgba(76, 201, 240, 0.7);
      transition: width 0.2s ease-out;
    }

    .timeline-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .why-box {
      margin-top: 10px;
      padding: 10px 10px 9px;
      border-radius: var(--radius-md);
      background: rgba(8, 10, 18, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.06);
      font-size: 0.88rem;
      color: var(--text-muted);
      line-height: 1.5;
    }

    .why-box strong {
      color: var(--accent);
      font-weight: 600;
    }

    .footer-note {
      margin-top: 8px;
      font-size: 0.75rem;
      color: var(--text-muted);
      border-top: 1px solid var(--border-subtle);
      padding-top: 6px;
    }

    .site-footer {
      margin-top: 4px;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: left;
    }

    .site-footer strong {
      color: var(--accent);
      font-weight: 500;
    }

    /* Tooltip */
    .tooltip-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 14px;
      height: 14px;
      font-size: 0.7rem;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.25);
      color: var(--text-muted);
      cursor: default;
      position: relative;
    }

    .tooltip-icon::after {
      content: attr(data-tooltip);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      bottom: 125%;
      background: #05070a;
      color: var(--text-main);
      padding: 6px 8px;
      border-radius: 6px;
      font-size: 0.72rem;
      line-height: 1.3;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      border: 1px solid rgba(255, 255, 255, 0.15);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.6);
      transition: opacity 0.12s ease;
      z-index: 5;
    }

    .tooltip-icon:hover::after {
      opacity: 1;
    }

    .group-caption {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 2px;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <main>
    <!-- Top nav -->
    <nav class="top-nav">
      <span>Tools:</span>
      <a href="index4.html">Home</a>
      <a href="index3.html">Anxiety Timing</a>
      <a href="index5.html">Crash Clock Prototype</a>
    </nav>

    <!-- Header card -->
    <section class="card">
      <h1>Crash Clock & Nervous System Load Index</h1>
      <p>
        A visual timing model that estimates your crash window, nervous system load and emotional lag,
        based on what you ate, how you slept and how cranked up your system feels today.
      </p>
      <div class="pill accent">Timing based modeling</div>
      <div class="pill">Crash · Load · Emotional lag</div>
    </section>

    <!-- Input card -->
    <section class="card">
      <h2>Inputs for the last few hours</h2>
      <p>Rough is fine. The goal here is pattern, not precision.</p>

      <div class="row two">
        <div>
          <h3>Meal and timing</h3>
          <p class="group-caption">
            These inputs tell the model how strong today’s spike and crash wave might be.
          </p>

          <label for="timeSinceMeal">
            Time since main meal or snack (hours)
          </label>
          <input id="timeSinceMeal" type="range" min="0" max="6" step="0.25" value="2" />
          <div class="range-label">
            <span>Just ate</span>
            <span><span id="timeSinceMealLabel">2.0</span> h</span>
            <span>6+ h</span>
          </div>

          <label for="mealSize">
            Carb heaviness of that meal
          </label>
          <select id="mealSize">
            <option value="20">Light – mostly protein / veg</option>
            <option value="45" selected>Medium – balanced plate</option>
            <option value="70">Heavy – big bowl, bread, or rice</option>
            <option value="90">Very heavy – pasta, takeout, buffet feel</option>
          </select>

          <label for="sugarLoad">
            Added sugar around that time
          </label>
          <select id="sugarLoad">
            <option value="5">Almost none</option>
            <option value="25" selected>Some – small sweet or a few bites</option>
            <option value="55">Moderate – dessert, candy, sweet snack</option>
            <option value="80">High – dessert plus extra sugary things</option>
          </select>

          <label for="caffeineLevel">
            Caffeine around or after that meal
          </label>
          <select id="caffeineLevel">
            <option value="0">None</option>
            <option value="20" selected>Mild – small tea or decaf</option>
            <option value="45">Moderate – 1 coffee / energy drink</option>
            <option value="70">High – 2 or more strong drinks</option>
          </select>
        </div>

        <div>
          <h3>Body state today</h3>
          <p class="group-caption">
            These inputs shape your nervous system load and how much “yesterday” you are still carrying.
          </p>

          <label for="sleepQuality">
            Sleep last night
          </label>
          <select id="sleepQuality">
            <option value="15">Poor – short or restless</option>
            <option value="5" selected>OK – not great, not awful</option>
            <option value="0">Good – felt rested</option>
          </select>

          <label for="stressLevel">
            Stress level today
          </label>
          <select id="stressLevel">
            <option value="5">Low</option>
            <option value="20" selected>Moderate</option>
            <option value="40">High</option>
          </select>

          <label for="hydrationLevel">
            Hydration so far today
          </label>
          <select id="hydrationLevel">
            <option value="25">Low – probably not enough fluids</option>
            <option value="10" selected>OK – some water, not ideal</option>
            <option value="0">Good – steady water intake</option>
          </select>

          <label for="gutSensitivity">
            Overall sensitivity baseline
          </label>
          <select id="gutSensitivity">
            <option value="10">Mild – body is usually quiet</option>
            <option value="25" selected>Medium – sensitive some days</option>
            <option value="45">High – very reactive, “live wires”</option>
          </select>

          <label for="ibsPattern">
            Week so far
          </label>
          <select id="ibsPattern">
            <option value="5">Steady – mostly typical days</option>
            <option value="20" selected>Wobbly – some rougher patches</option>
            <option value="40">Rough – frequent symptoms or fatigue</option>
          </select>
        </div>
      </div>

      <button id="calculateBtn" class="primary-btn">
        ⚡ Update model
      </button>
      <p class="footer-note">
        All numbers are intentionally soft. This is a sandbox to see how timing, load and carryover might interact.
      </p>
    </section>

    <!-- Output card: metrics -->
    <section class="card" id="resultsCard">
      <h2>Current state snapshot</h2>
      <p>
        This snapshot estimates where you are in your post-meal cycle and how much total load your
        nervous system is carrying right now.
      </p>

      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-title">
            Nervous System Load Index
            <span
              class="tooltip-icon"
              data-tooltip="Rough 0–100 gauge for how hard your nervous system is working right now."
            >?</span>
          </div>
          <div id="nsliValue" class="metric-value medium">56</div>
          <div id="nsliBand" class="metric-sub">
            Medium load – system is doing work in the background.
          </div>
        </div>

        <div class="metric-card">
          <div class="metric-title">
            Emotional Lag
            <span
              class="tooltip-icon"
              data-tooltip="How much of yesterday or this morning your body is still carrying into right now."
            >?</span>
          </div>
          <div id="lagValue" class="metric-value low">28</div>
          <div id="lagBand" class="metric-sub">
            Some carryover from earlier stress or poor sleep.
          </div>
        </div>
      </div>

      <div class="metric-card" style="margin-top: 10px;">
        <div class="metric-title">
          Crash Clock – where you are
          <span
            class="tooltip-icon"
            data-tooltip="Which part of the spike → crash → recovery arc you are likely sitting in."
          >?</span>
        </div>
        <div id="crashStage" class="metric-value medium">Crash window</div>
        <div id="crashBand" class="metric-sub">
          You are likely in a dip after a prior spike in energy or blood sugar.
        </div>

        <div class="timeline-bar">
          <div class="timeline-track">
            <div id="timelineFill" class="timeline-fill"></div>
          </div>
          <div class="timeline-labels">
            <span>Pre spike</span>
            <span>Spike</span>
            <span>Crash</span>
            <span>Recovery</span>
          </div>
        </div>

        <div class="timeline-chip-row" style="margin-top: 8px;">
          <span id="chipPre" class="timeline-chip">Pre spike</span>
          <span id="chipSpike" class="timeline-chip">Spike phase</span>
          <span id="chipCrash" class="timeline-chip active">Crash window</span>
          <span id="chipRecover" class="timeline-chip">Recovery</span>
        </div>
      </div>

      <div class="why-box" id="whyBox">
        Based on your inputs, your body looks like it is combining a moderate meal load,
        some sugar, and a medium sensitivity baseline with OK sleep and hydration. This can produce
        a noticeable but manageable wave that feels stronger if you focus on it.
        <br /><br />
        <strong>This wave will pass. Expect things to shift again within the next 20–40 minutes.</strong>
      </div>
    </section>

    <section class="card">
      <h2>How to read this prototype</h2>
      <p>
        The goal is not perfect math. It is a usable language for what your body might be doing:
        what is spiking, what is dropping and how much leftover stress is still in the system.
      </p>
      <ul>
        <li>
          <strong>Nervous System Load Index</strong> is like a CPU meter for your body
          on a 0 to 100 scale.
        </li>
        <li>
          <strong>Emotional Lag</strong> is how much of earlier stress or sleep debt is still
          coloring how today feels.
        </li>
        <li>
          <strong>Crash Clock</strong> guesses where you are in the spike → crash → recovery arc
          after carbs, sugar and caffeine.
        </li>
      </ul>
      <p class="footer-note">
        Not medical advice. Prototype only. Adjust the sliders on real days and see which patterns
        match your lived experience.
      </p>
      <p class="site-footer">
        <strong>Privacy:</strong> nothing is saved, nothing is tracked and all processing happens in your browser.
      </p>
    </section>
  </main>

  <script>
    function clamp(val, min, max) {
      return Math.min(max, Math.max(min, val));
    }

    function bandForScore(score) {
      if (score < 33) return "low";
      if (score < 66) return "medium";
      return "high";
    }

    function bandText(label, score) {
      const band = bandForScore(score);
      if (label === "nsli") {
        if (band === "low") return "Low load – nervous system has room to flex.";
        if (band === "medium") return "Medium load – system is active but not overwhelmed.";
        return "High load – your system is juggling several stressors at once.";
      }
      if (label === "lag") {
        if (band === "low") return "Low emotional residue – today is not carrying too much from before.";
        if (band === "medium") return "Some carryover from earlier stress or poor sleep.";
        return "High carryover – your body still thinks it is in yesterday's storm.";
      }
      return "";
    }

    function crashStageFor(timeH) {
      // Simple phase model by time since meal
      let stage = "pre";
      if (timeH < 0.5) {
        stage = "pre";
      } else if (timeH < 1.5) {
        stage = "spike";
      } else if (timeH < 3) {
        stage = "crash";
      } else {
        stage = "recover";
      }
      return stage;
    }

    function updateCrashChips(stage) {
      const chipPre = document.getElementById("chipPre");
      const chipSpike = document.getElementById("chipSpike");
      const chipCrash = document.getElementById("chipCrash");
      const chipRecover = document.getElementById("chipRecover");
      [chipPre, chipSpike, chipCrash, chipRecover].forEach((el) =>
        el.classList.remove("active")
      );
      if (stage === "pre") chipPre.classList.add("active");
      if (stage === "spike") chipSpike.classList.add("active");
      if (stage === "crash") chipCrash.classList.add("active");
      if (stage === "recover") chipRecover.classList.add("active");
    }

    function stageToFill(stage) {
      // Map stage to a percentage of the bar
      if (stage === "pre") return 10;
      if (stage === "spike") return 35;
      if (stage === "crash") return 70;
      return 95; // recover
    }

    function updateModel(scrollToResults) {
      const timeSinceMeal = parseFloat(
        document.getElementById("timeSinceMeal").value
      );
      const mealSize = parseFloat(
        document.getElementById("mealSize").value
      );
      const sugarLoad = parseFloat(
        document.getElementById("sugarLoad").value
      );
      const caffeineLevel = parseFloat(
        document.getElementById("caffeineLevel").value
      );
      const sleepQuality = parseFloat(
        document.getElementById("sleepQuality").value
      );
      const stressLevel = parseFloat(
        document.getElementById("stressLevel").value
      );
      const hydrationLevel = parseFloat(
        document.getElementById("hydrationLevel").value
      );
      const gutSensitivity = parseFloat(
        document.getElementById("gutSensitivity").value
      );
      const ibsPattern = parseFloat(
        document.getElementById("ibsPattern").value
      );

      // Metabolic load: how strong this meal + sugar + caffeine wave is
      const metabolicLoadRaw =
        mealSize * 0.45 + sugarLoad * 0.35 + caffeineLevel * 0.2;
      const metabolicLoad = clamp(metabolicLoadRaw, 0, 100);

      // Nervous System Load Index
      const stressComponent = stressLevel * 1.0;
      const sensitivityComponent = gutSensitivity * 1.1;
      const sleepComponent = sleepQuality * 1.1;
      const hydrationComponent = hydrationLevel * 0.8;

      const nsliRaw =
        metabolicLoad * 0.45 +
        stressComponent * 0.2 +
        sensitivityComponent * 0.2 +
        sleepComponent * 0.1 +
        hydrationComponent * 0.05;

      const nsli = Math.round(clamp(nsliRaw, 0, 100));

      // Emotional lag
      const lagRaw =
        sleepQuality * 1.4 +
        stressLevel * 1.3 +
        gutSensitivity * 0.9 +
        ibsPattern * 0.6;
      const lag = Math.round(clamp(lagRaw, 0, 100));

      // Crash clock stage
      const stage = crashStageFor(timeSinceMeal);
      let stageText = "";
      let stageSub = "";
      if (stage === "pre") {
        stageText = "Pre spike";
        stageSub =
          "Your system is still absorbing. This is a build up phase before the full wave.";
      } else if (stage === "spike") {
        stageText = "Spike phase";
        stageSub =
          "Energy and chemistry are rising. This can feel buzzy, fast, or sharpened.";
      } else if (stage === "crash") {
        stageText = "Crash window";
        stageSub =
          "You are likely in a dip after the rise. This is the classic crash and false anxiety zone.";
      } else {
        stageText = "Recovery";
        stageSub =
          "Your system is clearing the wave. Things may feel flat, tired, or slowly steadying.";
      }

      // Update DOM
      const nsliEl = document.getElementById("nsliValue");
      const lagEl = document.getElementById("lagValue");
      const crashStageEl = document.getElementById("crashStage");

      nsliEl.textContent = nsli;
      lagEl.textContent = lag;
      crashStageEl.textContent = stageText;

      [nsliEl, lagEl].forEach((el) => {
        el.classList.remove("low", "medium", "high");
      });
      nsliEl.classList.add(bandForScore(nsli));
      lagEl.classList.add(bandForScore(lag));

      document.getElementById("nsliBand").textContent = bandText("nsli", nsli);
      document.getElementById("lagBand").textContent = bandText("lag", lag);
      document.getElementById("crashBand").textContent = stageSub;

      updateCrashChips(stage);

      // Timeline bar
      const fillPct = stageToFill(stage);
      const fillEl = document.getElementById("timelineFill");
      fillEl.style.width = fillPct + "%";

      // Why-box narrative
      const whyBox = document.getElementById("whyBox");
      const pieces = [];

      if (nsli >= 70) {
        pieces.push(
          "Your nervous system is carrying a high combined load from this meal, today’s stress and your sensitivity baseline."
        );
      } else if (nsli >= 40) {
        pieces.push(
          "Your system is working at a medium level. It is not overloaded, but it is not idle either."
        );
      } else {
        pieces.push(
          "Overall load is on the lower side. If you feel off, it might be more about focus or interpretation than raw biology."
        );
      }

      if (lag >= 60) {
        pieces.push(
          "There is strong emotional lag from earlier stress, poor sleep or recent rough days, so today may feel heavier than the inputs alone suggest."
        );
      } else if (lag >= 30) {
        pieces.push(
          "There is some leftover tension in the system that can color how this current wave feels."
        );
      } else {
        pieces.push(
          "Emotional lag is relatively low, so most of what you feel now is tied to the current timing wave."
        );
      }

      if (stage === "crash") {
        pieces.push(
          "You appear to be in a crash window after a prior spike. For many sensitive people this is the time that feels like sudden anxiety or dread."
        );
      } else if (stage === "spike") {
        pieces.push(
          "You are in a spike phase where chemistry is rising. This can feel sharp or jittery if your system is already cranked up."
        );
      }

      pieces.push(
        "This wave will pass. Most people notice some kind of shift again within the next 20–40 minutes."
      );

      whyBox.innerHTML = pieces.join(" ") +
        "<br><br><strong>This wave will pass. Expect things to shift again within the next 20–40 minutes.</strong>";

      if (scrollToResults) {
        const resultsCard = document.getElementById("resultsCard");
        resultsCard.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    const timeRange = document.getElementById("timeSinceMeal");
    const timeLabel = document.getElementById("timeSinceMealLabel");
    timeRange.addEventListener("input", () => {
      timeLabel.textContent = parseFloat(timeRange.value).toFixed(2);
    });

    document.getElementById("calculateBtn").addEventListener("click", () => {
      updateModel(true);
    });

    timeLabel.textContent = parseFloat(timeRange.value).toFixed(2);
    updateModel(false);
  </script>
</body>
</html>
