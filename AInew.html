<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Body Rhythm Console - Beta v0.4</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: #05060a;
      color: #f2f2f7;
      display: flex;
      height: 100vh;
    }
    .console {
      margin: auto;
      width: min(980px, 100vw - 20px);
      height: min(640px, 100vh - 20px);
      border-radius: 24px;
      border: 2px solid #313446;
      display: grid;
      grid-template-columns: 2fr 1fr;
      background: radial-gradient(circle at top, #22263a 0, #090b13 40%, #05060a 80%);
      box-shadow: 0 22px 45px rgba(0,0,0,0.8);
      overflow: hidden;
    }

    /* Chat side */
    .chat {
      border-right: 1px solid #26293a;
      display: flex;
      flex-direction: column;
      min-width: 0;
    }
    .chat-header {
      padding: 10px 14px;
      border-bottom: 1px solid #26293a;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ba2ff;
      background: linear-gradient(to right, rgba(60,68,120,0.5), transparent);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .chat-messages {
      flex: 1;
      padding: 14px;
      overflow-y: auto;
      font-size: 14px;
    }
    .chat-msg {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .chat-msg strong {
      color: #d4d7ff;
    }
    .chat-input {
      display: flex;
      border-top: 1px solid #26293a;
    }
    .chat-input input {
      flex: 1;
      border: none;
      padding: 10px;
      background: #121522;
      color: #f2f2f7;
      outline: none;
      font-size: 14px;
    }
    .chat-input button {
      border: none;
      padding: 10px 16px;
      background: #2f7df6;
      color: white;
      font-size: 14px;
      cursor: pointer;
      border-radius: 0;
      white-space: nowrap;
    }
    .chat-input button:active {
      transform: translateY(1px);
    }

    /* Control side */
    .controls {
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow-y: auto;
      min-width: 0;
    }
    .panel {
      background: rgba(10,12,22,0.95);
      border-radius: 14px;
      padding: 10px 10px 12px 10px;
      border: 1px solid #2a3043;
    }
    .panel h3 {
      margin: 0 0 6px 0;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #a7b0ff;
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .btn {
      flex: 1;
      min-width: 90px;
      padding: 6px 8px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid #3a4058;
      background: #191e30;
      color: #f2f2f7;
      cursor: pointer;
      text-align: center;
    }
    .btn:active {
      transform: translateY(1px);
    }

    .slider-group {
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 12px;
      margin-bottom: 6px;
    }
    .slider-group label {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #b3b7d2;
    }
    .slider-group input[type="range"] {
      width: 100%;
    }
    .mini-label {
      font-size: 10px;
      color: #7e84a8;
      margin-top: 2px;
    }

    .time-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px 8px;
      font-size: 11px;
    }
    .time-grid label {
      display: flex;
      flex-direction: column;
      gap: 2px;
      color: #c1c6e3;
    }
    .time-grid input[type="time"],
    .time-grid select {
      background: #151829;
      border: 1px solid #303651;
      border-radius: 6px;
      padding: 3px 4px;
      color: #f2f2f7;
      font-size: 11px;
      outline: none;
    }

    .tag-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 4px;
    }
    .tag {
      font-size: 10px;
      border-radius: 999px;
      padding: 3px 6px;
      border: 1px solid #333a5b;
      color: #aab0d5;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #090b13;
    }
    ::-webkit-scrollbar-thumb {
      background: #2d3145;
      border-radius: 3px;
    }

    /* Basic responsive tweak */
    @media (max-width: 800px) {
      .console {
        grid-template-columns: 1fr;
        height: auto;
      }
      .chat {
        border-right: none;
        border-bottom: 1px solid #26293a;
      }
    }
  </style>
</head>
<body>
  <div class="console">
    <!-- Chat side -->
    <div class="chat">
      <div class="chat-header">Body Rhythm Console · Beta</div>
      <div class="chat-messages" id="chatMessages">
        <div class="chat-msg">
          <strong>App:</strong> Welcome. This console helps you understand how your body actually works. Not through diets or diagnoses, but through timing, stress load, and your gut–brain rhythm.
        </div>
        <div class="chat-msg">
          <strong>App:</strong> Most long term IBS-like issues and anxiety driven physical symptoms follow patterns that no one ever maps. This tool helps you find your personal rhythm so your mornings become more predictable and your nervous system stays calmer.
        </div>
        <div class="chat-msg">
          <strong>App:</strong> Use the sliders to describe how you feel, set tonight’s timing, and then log and explore. You are not broken, you just have a pattern that has not been visible yet.
        </div>
      </div>
      <div class="chat-input">
        <input id="chatInput" placeholder="Type a note or question (optional, not wired to real AI yet)...">
        <button onclick="sendChat()">Send</button>
      </div>
    </div>

    <!-- Controls side -->
    <div class="controls">
      <!-- Quick actions -->
      <div class="panel">
        <h3>Quick actions</h3>
        <div class="btn-row">
          <button class="btn" onclick="preset('log_today')">Log today</button>
          <button class="btn" onclick="preset('insight')">Show pattern</button>
          <button class="btn" onclick="preset('forecast')">Forecast tomorrow</button>
        </div>
        <div class="btn-row" style="margin-top:4px;">
          <button class="btn" onclick="preset('explain')">Explain my system</button>
          <button class="btn" onclick="preset('driving')">What is driving today?</button>
          <button class="btn" onclick="preset('questions')">Ask me questions</button>
        </div>
      </div>

      <!-- State sliders -->
      <div class="panel">
        <h3>State sliders</h3>
        <div class="slider-group">
          <label>
            <span>Stress</span>
            <span id="stressVal">2/10</span>
          </label>
          <input type="range" id="stress" min="0" max="10" value="2" oninput="updateLabel('stress')">
        </div>
        <div class="slider-group">
          <label>
            <span>Shoulder tension</span>
            <span id="shoulderVal">3/10</span>
          </label>
          <input type="range" id="shoulder" min="0" max="10" value="3" oninput="updateLabel('shoulder')">
        </div>
        <div class="slider-group">
          <label>
            <span>Gut comfort</span>
            <span id="gutVal">6/10</span>
          </label>
          <input type="range" id="gut" min="0" max="10" value="6" oninput="updateLabel('gut')">
        </div>
        <div class="slider-group">
          <label>
            <span>Anxiety level</span>
            <span id="anxVal">3/10</span>
          </label>
          <input type="range" id="anx" min="0" max="10" value="3" oninput="updateLabel('anx')">
        </div>
        <p class="mini-label">
          These describe how your nervous system feels right now. In a full version this is what the AI would use to estimate sensitivity and predict mornings.
        </p>
      </div>

      <!-- Tonight timing -->
      <div class="panel">
        <h3>Tonight's timing</h3>
        <div class="time-grid">
          <label>
            Dinner
            <input type="time" id="dinTime" value="19:00">
          </label>
          <label>
            Last food
            <input type="time" id="foodTime" value="19:45">
          </label>
          <label>
            Last drink
            <input type="time" id="drinkTime" value="21:30">
          </label>
          <label>
            Magnesium
            <input type="time" id="magTime" value="23:00">
          </label>
          <label>
            Sleep
            <input type="time" id="sleepTime" value="00:30">
          </label>
          <label>
            Wake
            <input type="time" id="wakeTime" value="08:00">
          </label>
        </div>
        <div class="tag-row">
          <span class="tag">Timing focused</span>
          <span class="tag">Vagus aware</span>
          <span class="tag">Morning stability</span>
        </div>
      </div>

      <!-- Morning outcome -->
      <div class="panel">
        <h3>Morning outcome</h3>
        <div class="time-grid">
          <label>
            BM time
            <input type="time" id="bmTime" value="08:05">
          </label>
          <label>
            Pain level
            <input type="range" id="bmPain" min="0" max="10" value="2" oninput="updateLabel('pain')">
            <span id="bmPainVal" style="font-size:10px;color:#b3b7d2;">2/10</span>
          </label>
          <label>
            Bristol form
            <select id="bmForm">
              <option value="1">1 · Separate hard lumps</option>
              <option value="2">2 · Lumpy sausage</option>
              <option value="3">3 · Cracked sausage</option>
              <option value="4" selected>4 · Smooth, soft sausage</option>
              <option value="5">5 · Soft blobs, clear edges</option>
              <option value="6">6 · Fluffy, mushy</option>
              <option value="7">7 · Watery, no solids</option>
            </select>
          </label>
        </div>
        <p class="mini-label">
          This is what actually happened in the morning. Later, this feeds back into pattern detection so you can see how last night’s timing and state match your outcomes.
        </p>
      </div>
    </div>
  </div>

  <script>
    function addMessage(sender, text) {
      const box = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = 'chat-msg';
      div.innerHTML = `<strong>${sender}:</strong> ${text}`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    function sendChat() {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text) return;
      addMessage('You', text);
      input.value = '';
      setTimeout(() => {
        addMessage('App', 'In the full version this text would be interpreted alongside your sliders, timing, and outcome so the AI can learn your patterns.');
      }, 400);
    }

    function updateLabel(which) {
      if (which === 'stress') {
        const v = document.getElementById('stress').value;
        document.getElementById('stressVal').textContent = `${v}/10`;
      }
      if (which === 'shoulder') {
        const v = document.getElementById('shoulder').value;
        document.getElementById('shoulderVal').textContent = `${v}/10`;
      }
      if (which === 'gut') {
        const v = document.getElementById('gut').value;
        document.getElementById('gutVal').textContent = `${v}/10`;
      }
      if (which === 'anx') {
        const v = document.getElementById('anx').value;
        document.getElementById('anxVal').textContent = `${v}/10`;
      }
      if (which === 'pain') {
        const v = document.getElementById('bmPain').value;
        document.getElementById('bmPainVal').textContent = `${v}/10`;
      }
    }

    function timeToMinutes(id) {
      const t = document.getElementById(id).value;
      if (!t) return null;
      const [h, m] = t.split(':').map(Number);
      return h * 60 + m;
    }

    function preset(type) {
      const stress = +document.getElementById('stress').value;
      const shoulder = +document.getElementById('shoulder').value;
      const gut = +document.getElementById('gut').value;
      const anx = +document.getElementById('anx').value;

      const tDinner = timeToMinutes('dinTime');
      const tFood = timeToMinutes('foodTime');
      const tDrink = timeToMinutes('drinkTime');
      const tMag = timeToMinutes('magTime');
      const tSleep = timeToMinutes('sleepTime');
      const tWake = timeToMinutes('wakeTime');

      const tBm = timeToMinutes('bmTime');
      const bmForm = document.getElementById('bmForm').value;
      const bmPain = +document.getElementById('bmPain').value;

      const drinkGap = tMag != null && tDrink != null ? tMag - tDrink : null;
      const foodGap = tSleep != null && tFood != null ? tSleep - tFood : null;

      if (type === 'log_today') {
        addMessage(
          'You',
          `Log today: stress=${stress}, shoulder=${shoulder}, gut=${gut}, anxiety=${anx}, BM form=${bmForm}, BM pain=${bmPain}.`
        );
        addMessage(
          'App',
          'Logged this state and outcome. In a full build this would be stored and used to refine your personal rhythm model over time.'
        );
      }

      if (type === 'insight') {
        addMessage('You', 'Show me today’s pattern.');
        let msg;

        if (drinkGap !== null && drinkGap < 75) {
          msg = 'Your last drink is fairly close to magnesium. On systems like yours, mornings tend to be softer or more unpredictable when the gap is under about 75 to 90 minutes.';
        } else if (shoulder >= 7) {
          msg = 'Shoulder tension is high. On days like this, splenic flexure and left side sensitivity often show up even if digestion itself is fine. This is more nervous system than gut tissue.';
        } else if (anx >= 6 && stress >= 6) {
          msg = 'Both stress and anxiety are elevated. That usually raises your internal volume knob and makes normal sensations feel louder, even when timing is decent.';
        } else if (gut >= 7 && stress <= 3 && (drinkGap === null || drinkGap >= 90)) {
          msg = 'This looks close to your stable rhythm: decent gut comfort, low stress, and a solid gap between last drink and magnesium. That is usually a strong setup for a predictable morning.';
        } else {
          msg = 'Today looks mixed. Nothing screams disaster, but sensitivity is a bit elevated. Small improvements in cutoff or evening calm will likely pay off tomorrow.';
        }

        // Light mention of outcome if available
        if (tBm != null) {
          if (bmForm >= 6) {
            msg += ' This morning’s form suggests your system is still on the softer side. Often that tracks back to either a tight drink gap or a bit more nervous system load than ideal.';
          } else if (bmForm === '4' && bmPain <= 2) {
            msg += ' The morning outcome you logged (smooth form and low pain) fits your more stable pattern, which is a good sign that your timing is on the right track.';
          }
        }

        addMessage('App', msg);
      }

      if (type === 'forecast') {
        addMessage('You', 'What is the forecast for tomorrow?');

        let msg = 'Given this setup, tomorrow looks like a sensitive but workable morning. Not perfect, not terrible. Expect more awareness than true pain.';

        if (drinkGap !== null && drinkGap >= 90 && stress <= 3 && anx <= 3 && shoulder <= 4 && gut >= 6) {
          msg = 'This is one of your stronger setups. I would expect a single mostly solid morning BM, low pain, and a quieter nervous system overall.';
        } else if (drinkGap !== null && drinkGap < 60) {
          msg = 'Tomorrow has a higher chance of a soft or partly watery morning, mostly due to the tight drink to magnesium gap. Not dangerous, just less stable.';
        } else if (anx >= 7 || stress >= 7) {
          msg = 'Tomorrow may feel louder in your body even if the gut behaves. Expect more internal noise, mostly driven by nervous system state rather than true gut trouble.';
        }

        addMessage('App', msg);
      }

      if (type === 'explain') {
        addMessage('You', 'Explain my system.');
        const msg =
          'You have a timing sensitive, nervous system heavy pattern. Evenings with calmer stress, lower shoulder tension, and a clear cutoff between last drink and magnesium usually give you stable mornings. When stress, anxiety, or shoulder tension run high, your sensitivity goes up even if nothing is “wrong” in the gut itself.';
        addMessage('App', msg);
      }

      if (type === 'driving') {
        addMessage('You', 'What is driving today?');
        let drivers = [];

        if (drinkGap !== null && drinkGap < 75) {
          drivers.push('tight last drink to magnesium gap');
        }
        if (shoulder >= 6) {
          drivers.push('shoulder and neck tension');
        }
        if (anx >= 6) {
          drivers.push('anxiety level');
        }
        if (stress >= 6) {
          drivers.push('overall stress load');
        }

        if (drivers.length === 0) {
          addMessage(
            'App',
            'Nothing is screaming as a strong driver today from the sliders alone. This looks more like a fine tune and watch what happens kind of day rather than a clear trigger day.'
          );
        } else {
          addMessage(
            'App',
            `The main drivers tonight look like: ${drivers.join(', ')}. Those are the knobs that usually change your sensitivity the most.`
          );
        }
      }

      if (type === 'questions') {
        addMessage('You', 'Ask me some narrowing questions.');

        const qs = [];

        if (drinkGap !== null && drinkGap < 75) {
          qs.push('Your last drink is fairly close to magnesium. On nights like this, have your worst or softest mornings usually happened, or does it still feel random to you?');
        }
        if (shoulder >= 7) {
          qs.push('With shoulder tension this high, do you usually notice more left side gut awareness or splenic flexure style pressure either that night or the next morning?');
        }
        if (anx >= 6) {
          qs.push('When anxiety is this elevated, do you tend to feel the anxiety first and then the gut reacts, or does the gut flare first and your mind responds after?');
        }
        if (stress >= 6 && anx < 6) {
          qs.push('Stress is high but anxiety is a bit lower. Does your body hold this mostly in muscle tension (shoulders, neck, jaw), or does your gut often join in too on days like this?');
        }
        if (gut <= 4) {
          qs.push('Gut comfort is low. Would you describe it more as sharp pain, pressure, bloating, or just hypersensitive awareness where everything inside feels too loud?');
        }

        if (qs.length === 0) {
          qs.push('Nothing jumps out as a clear driver from the sliders alone. If you had to guess, what part of today feels most off: timing, stress, sleep, or body tension?');
        }

        qs.forEach(q => addMessage('App', q));
      }
    }
  </script>
</body>
</html>
