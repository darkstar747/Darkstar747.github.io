<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Anxiety Spike Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      color-scheme: dark;
    }
    body {
      margin: 0;
      padding: 20px;
      background: #050505;
      color: #e5e5e5;
    }
    .shell {
      max-width: 1040px;
      margin: 0 auto;
      background: #131313;
      border-radius: 12px;
      padding: 18px 20px 24px;
      box-shadow: 0 0 0 1px #262626;
    }
    h1 {
      font-size: 1.6rem;
      margin: 0 0 6px;
    }
    p {
      margin: 4px 0 10px;
      color: #b0b0b0;
      font-size: 0.9rem;
    }
    .mode-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid #333;
      overflow: hidden;
      margin-top: 8px;
      margin-bottom: 10px;
    }
    .mode-toggle button {
      border: none;
      background: transparent;
      color: #d0d0d0;
      font-size: 0.85rem;
      padding: 6px 14px;
      cursor: pointer;
    }
    .mode-toggle button.active {
      background: #2c76ff;
      color: #050505;
    }
    label {
      display: block;
      font-size: 0.82rem;
      color: #cfcfcf;
      margin-bottom: 3px;
    }
    input[type="number"],
    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: 1px solid #333;
      background: #0d0d0d;
      color: #f5f5f5;
      font-size: 0.88rem;
      box-sizing: border-box;
    }
    input[type="range"] {
      width: 100%;
      height: 26px;
      -webkit-appearance: none;
      background: transparent;
    }
    input[type="range"]::-webkit-slider-runnable-track {
      height: 6px;
      background: #2a2a2a;
      border-radius: 999px;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #2c76ff;
      border: 1px solid #ffffff;
      margin-top: -6px;
    }
    input[type="range"]::-moz-range-track {
      height: 6px;
      background: #2a2a2a;
      border-radius: 999px;
    }
    input[type="range"]::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: #2c76ff;
      border: 1px solid #ffffff;
    }
    input:focus,
    select:focus {
      outline: none;
      border-color: #4d96ff;
    }
    .hint {
      margin-top: 3px;
      font-size: 0.75rem;
      color: #808080;
    }
    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
    .pill {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid #333;
      font-size: 0.78rem;
      cursor: pointer;
      user-select: none;
      background: #101010;
    }
    .pill.selected {
      background: #2c76ff;
      border-color: #2c76ff;
      color: #050505;
    }
    button.primary {
      margin-top: 16px;
      padding: 10px 18px;
      border-radius: 8px;
      border: none;
      background: #2c76ff;
      color: #050505;
      font-weight: 600;
      font-size: 0.95rem;
      cursor: pointer;
    }
    button.primary:hover {
      background: #5e97ff;
    }
    button.secondary {
      margin-top: 10px;
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid #333;
      background: #181818;
      color: #f0f0f0;
      font-size: 0.85rem;
      cursor: pointer;
    }
    button.secondary:hover {
      background: #222;
    }
    .mode-section {
      margin-top: 6px;
    }
    .hidden {
      display: none;
    }
    .grid-advanced {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px 20px;
      margin-top: 10px;
    }
    /* Meal grid */
    .meal-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-top: 10px;
      margin-bottom: 6px;
    }
    .meal-search {
      flex: 1;
    }
    .meal-search input {
      width: 100%;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid #333;
      background: #0d0d0d;
      color: #eee;
      font-size: 0.86rem;
      box-sizing: border-box;
    }
    .meal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      max-height: 280px;
      overflow-y: auto;
      padding-right: 4px;
      margin-top: 4px;
    }
    .meal-card {
      background: #101010;
      border-radius: 9px;
      padding: 8px 9px;
      border: 1px solid #262626;
      cursor: pointer;
      font-size: 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }
    .meal-card.selected {
      border-color: #2c76ff;
      box-shadow: 0 0 0 1px #2c76ff55;
    }
    .meal-emoji {
      font-size: 1.3rem;
    }
    .meal-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }
    .meal-name {
      font-weight: 600;
      font-size: 0.82rem;
    }
    .meal-tag {
      font-size: 0.68rem;
      padding: 1px 6px;
      border-radius: 999px;
      background: #1f1f1f;
      color: #ccc;
    }
    .meal-macros {
      font-size: 0.74rem;
      color: #a0a0a0;
    }
    .meal-cat {
      font-size: 0.72rem;
      color: #808080;
    }
    .subgrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
      gap: 12px 20px;
      margin-top: 12px;
    }
    .output {
      margin-top: 18px;
      padding-top: 12px;
      border-top: 1px solid #262626;
      font-size: 0.9rem;
    }
    .score-line {
      font-size: 1.05rem;
      margin-bottom: 4px;
    }
    .tag {
      display: inline-block;
      padding: 2px 9px;
      border-radius: 999px;
      font-size: 0.75rem;
      margin-left: 8px;
    }
    .tag-low {
      background: #11381f;
      color: #83e59a;
    }
    .tag-mod {
      background: #3c330f;
      color: #ffd469;
    }
    .tag-high {
      background: #3b1414;
      color: #ff8f8f;
    }
    .row {
      margin-top: 6px;
    }
    .small {
      font-size: 0.8rem;
      color: #8b8b8b;
      margin-top: 3px;
    }
    .timeline {
      margin-top: 10px;
      font-family: "SF Mono", Menlo, Consolas, monospace;
      font-size: 0.78rem;
      background: #101010;
      border-radius: 8px;
      padding: 8px 10px 10px;
      border: 1px solid #262626;
    }
    .bar {
      position: relative;
      height: 10px;
      background: #1b1b1b;
      border-radius: 999px;
      overflow: hidden;
      margin: 4px 0 4px;
    }
    .segment {
      position: absolute;
      top: 0;
      bottom: 0;
      border-radius: 999px;
    }
    .segment.spike {
      background: #f1c453; /* yellow */
    }
    .segment.mid {
      background: #ffb703; /* orange / between */
    }
    .segment.crash {
      background: #f94144; /* red */
    }
    .segment.recover {
      background: #3a86ff; /* blue */
    }
    .tick-row {
      position: relative;
      margin-top: 4px;
      height: 16px;
    }
    .tick {
      position: absolute;
      top: 0;
      font-size: 0.7rem;
      color: #777;
      transform: translateX(-50%);
      border-left: 1px solid #444;
      padding-left: 2px;
      padding-top: 1px;
      box-sizing: border-box;
    }
    .history {
      margin-top: 14px;
      padding-top: 10px;
      border-top: 1px dashed #303030;
      font-size: 0.8rem;
    }
    .history h3 {
      font-size: 0.9rem;
      margin: 0 0 4px;
    }
    .history-item {
      margin-top: 4px;
      color: #b3b3b3;
    }
    .badge {
      display: inline-block;
      padding: 1px 6px;
      border-radius: 6px;
      font-size: 0.7rem;
      background: #202020;
      margin-left: 6px;
      color: #ccc;
    }
    .explain {
      margin-top: 10px;
      font-size: 0.8rem;
      color: #b0b0b0;
      background: #151515;
      border-radius: 8px;
      padding: 8px 10px;
      border: 1px solid #262626;
    }
    .section-title {
      font-size: 0.95rem;
      margin-top: 14px;
      margin-bottom: 4px;
      font-weight: 600;
    }
    .reverse-block {
      margin-top: 12px;
      padding-top: 10px;
      border-top: 1px solid #262626;
      font-size: 0.84rem;
    }
    .reverse-grid {
      display: grid;
      grid-template-columns: minmax(140px, 220px) 1fr;
      gap: 10px 18px;
      align-items: center;
    }
    @media (max-width: 720px) {
      .reverse-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="shell">
    <h1>Anxiety Spike Predictor</h1>
    <p>
      Estimates when a meal and caffeine are likely to cause a spike, a crash and an anxiety window,
      based on carbs, sugar, caffeine and sensitivity. Educational only. Not medical advice.
    </p>

    <div class="mode-toggle">
      <button id="simpleModeBtn" class="active">Simple mode</button>
      <button id="advancedModeBtn">Advanced mode</button>
    </div>

    <!-- SIMPLE MODE -->
    <div id="simpleMode" class="mode-section">
      <div class="meal-header-row">
        <div>
          <label>Main meal type</label>
          <div class="hint">Pick the meal that looks most like what you ate.</div>
        </div>
        <div class="meal-search">
          <input id="mealSearch" type="text" placeholder="Search meals (pasta, ramen, burrito, sushi...)" />
        </div>
      </div>
      <div id="mealGrid" class="meal-grid"></div>

      <div class="subgrid">
        <div>
          <label>Time of this meal</label>
          <div class="pill-row" id="todGroup">
            <div class="pill" data-tod="morning">Morning</div>
            <div class="pill" data-tod="afternoon">Afternoon</div>
            <div class="pill selected" data-tod="evening">Evening or night</div>
          </div>
        </div>

        <div>
          <label>Portion size</label>
          <div class="pill-row" id="portionGroup">
            <div class="pill selected" data-portion="medium">Medium</div>
            <div class="pill" data-portion="small">Small</div>
            <div class="pill" data-portion="large">Large</div>
            <div class="pill" data-portion="restaurant">Restaurant sized</div>
          </div>
          <div class="hint">Controls how big the carb hit is.</div>
        </div>

        <div>
          <label>Sweet stuff with this meal</label>
          <div class="pill-row" id="sweetGroup">
            <div class="pill selected" data-sweet="none">None</div>
            <div class="pill" data-sweet="little">A little</div>
            <div class="pill" data-sweet="medium">Dessert portion</div>
            <div class="pill" data-sweet="lot">Big dessert or sugary drink</div>
          </div>
        </div>

        <div>
          <label>Caffeine around this time</label>
          <div class="pill-row" id="caffTypeGroup">
            <div class="pill selected" data-caff="none">None</div>
            <div class="pill" data-caff="tea">Tea</div>
            <div class="pill" data-caff="soda">Soda</div>
            <div class="pill" data-caff="smallCoffee">Small coffee</div>
            <div class="pill" data-caff="medCoffee">Medium coffee</div>
            <div class="pill" data-caff="largeCoffee">Large coffee</div>
            <div class="pill" data-caff="energy">Energy drink</div>
          </div>
          <div class="hint">We estimate caffeine in mg from this.</div>
        </div>

        <div>
          <label>How carb heavy was earlier today?</label>
          <input id="simpleStack" type="range" min="0" max="2" step="1" value="1" />
          <div class="hint" id="simpleStackLabel">Medium. One normal carb meal earlier.</div>
        </div>

        <div>
          <label>Your sensitivity to carbs and sugar</label>
          <input id="simpleSens" type="range" min="1" max="5" step="1" value="5" />
          <div class="hint" id="simpleSensLabel">5 of 5. Very high sensitivity.</div>
        </div>

        <div>
          <label>Your sensitivity to caffeine</label>
          <input id="simpleCaffSens" type="range" min="1" max="5" step="1" value="3" />
          <div class="hint" id="simpleCaffSensLabel">3 of 5. Average sensitivity.</div>
        </div>
      </div>
    </div>

    <!-- ADVANCED MODE -->
    <div id="advancedMode" class="mode-section hidden">
      <div class="grid-advanced">
        <div>
          <label for="advCarbs">Carbs in this meal (g)</label>
          <input id="advCarbs" type="number" value="80" />
          <div class="hint">Estimate total starch and carb content.</div>
        </div>

        <div>
          <label for="advSugar">Added sugar (g)</label>
          <input id="advSugar" type="number" value="10" />
          <div class="hint">Dessert, sweet drinks, candy.</div>
        </div>

        <div>
          <label for="advFiber">Fiber (g)</label>
          <input id="advFiber" type="number" value="3" />
          <div class="hint">Vegetables and whole grains.</div>
        </div>

        <div>
          <label for="advFat">Fat level</label>
          <select id="advFat">
            <option value="0">Low</option>
            <option value="1" selected>Medium</option>
            <option value="2">High</option>
          </select>
        </div>

        <div>
          <label for="advSens">Carb and sugar sensitivity (1 to 5)</label>
          <input id="advSens" type="number" min="1" max="5" value="5" />
        </div>

        <div>
          <label for="advPrior">Total carbs earlier today (g)</label>
          <input id="advPrior" type="number" value="60" />
        </div>

        <div>
          <label for="advTod">Time of this meal</label>
          <select id="adv
