<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Biology-Based Anxiety Timing Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta
    name="description"
    content="Free biology-based crash window calculator for people who feel 'anxious' after carbs, sugar and caffeine. No login, no woo, just timing."
  />
  <style>
    :root {
      --bg: #050608;
      --bg-soft: #101319;
      --bg-softer: #151924;
      --card: #141824;
      --accent: #ffcc80;
      --accent-soft: #ffc46a33;
      --accent-strong: #ff9800;
      --text-main: #f5f5f5;
      --text-soft: #b3bccb;
      --border-soft: #252a38;
      --border-strong: #3a4256;
      --danger: #ff5252;
      --warn: #ffb74d;
      --success: #66bb6a;
      --chip-low: #2e7d32;
      --chip-mid: #ffa000;
      --chip-high: #d32f2f;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: radial-gradient(circle at top, #181b2a 0, #050608 55%);
      color: var(--text-main);
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 14px 10px 40px;
    }

    .title-row {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 10px;
    }

    .title-row h1 {
      font-size: 1.2rem;
      margin: 0;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .title-sub {
      font-size: 0.8rem;
      color: var(--text-soft);
      max-width: 540px;
    }

    .title-sub strong {
      color: var(--accent);
      font-weight: 500;
    }

    .strip {
      position: sticky;
      top: 0;
      z-index: 20;
      padding: 8px 6px 10px;
      background: linear-gradient(to bottom, rgba(5, 6, 8, 0.97), rgba(5, 6, 8, 0.88));
      backdrop-filter: blur(16px);
      border-bottom: 1px solid rgba(37, 42, 56, 0.9);
      margin: 0 -10px 8px;
    }

    .strip-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .strip-main {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .strip-score {
      display: flex;
      align-items: baseline;
      gap: 4px;
    }

    .strip-score-number {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .strip-score-label {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .strip-window {
      font-size: 0.75rem;
      color: var(--text-soft);
    }

    .strip-share {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.72rem;
      color: var(--text-soft);
    }

    .strip-btn {
      border-radius: 999px;
      padding: 4px 8px;
      border: 1px solid var(--border-soft);
      background: #161d29;
      color: var(--text-main);
      font-size: 0.72rem;
      cursor: pointer;
      white-space: nowrap;
    }

    .strip-btn:hover {
      border-color: var(--accent);
    }

    .strip-share span {
      max-width: 180px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.2fr);
      gap: 10px;
    }

    @media (max-width: 800px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .card {
      background: rgba(13, 17, 27, 0.98);
      border-radius: 12px;
      border: 1px solid var(--border-soft);
      padding: 10px;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.55);
    }

    .card-soft {
      margin-top: 10px;
      background: rgba(15, 19, 30, 0.96);
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      padding: 8px;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 500;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .card-title span {
      font-size: 0.72rem;
      color: var(--text-soft);
      font-weight: 400;
    }

    .section-row {
      margin-bottom: 8px;
    }

    .section-row label {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.8rem;
      margin-bottom: 3px;
      color: var(--text-main);
    }

    .helper-text {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-top: 3px;
    }

    .warning-text {
      font-size: 0.74rem;
      color: var(--warn);
      margin-top: 3px;
    }

    .danger-text {
      font-size: 0.74rem;
      color: var(--danger);
      margin-top: 3px;
    }

    .input-row {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    input[type="number"],
    input[type="time"],
    input[type="text"],
    select {
      background: #0f1420;
      border-radius: 8px;
      border: 1px solid var(--border-soft);
      color: var(--text-main);
      padding: 6px 8px;
      font-size: 0.8rem;
      outline: none;
      min-width: 0;
    }

    input[type="number"]:focus,
    input[type="time"]:focus,
    input[type="text"]:focus,
    select:focus {
      border-color: var(--accent-strong);
    }

    input[type="range"] {
      width: 100%;
    }

    .mode-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      overflow: hidden;
      margin-bottom: 6px;
    }

    .mode-btn {
      padding: 4px 8px;
      font-size: 0.75rem;
      border: none;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      flex: 1;
      text-align: center;
      white-space: nowrap;
    }

    .mode-btn.active {
      background: #202637;
      color: var(--text-main);
    }

    .info-icon-btn {
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #141a28;
      color: var(--text-soft);
      font-size: 0.68rem;
      padding: 0 6px;
      cursor: pointer;
    }

    .info-text {
      display: none;
      font-size: 0.74rem;
      color: var(--text-soft);
      margin-top: 4px;
      border-radius: 8px;
      border: 1px dashed var(--border-soft);
      padding: 6px;
      background: rgba(13, 18, 26, 0.9);
    }

    .info-text.visible {
      display: block;
    }

    .score-strip {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .score-main {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .score-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .score-number {
      font-size: 2.1rem;
      font-weight: 600;
    }

    .score-label-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .score-label-main {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .score-meaning {
      font-size: 0.74rem;
      color: var(--text-soft);
      max-width: 260px;
    }

    .risk-chip {
      font-size: 0.72rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #151c27;
      color: var(--text-main);
      white-space: nowrap;
    }

    .risk-low {
      border-color: var(--chip-low);
      color: var(--success);
    }

    .risk-moderate {
      border-color: var(--chip-mid);
      color: var(--warn);
    }

    .risk-high {
      border-color: var(--chip-high);
      color: var(--danger);
    }

    .biology-line {
      font-size: 0.75rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .confidence-line {
      font-size: 0.74rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .gauge-row {
      margin-top: 6px;
    }

    .gauge {
      position: relative;
      height: 16px;
      border-radius: 999px;
      overflow: hidden;
      background: linear-gradient(
        90deg,
        rgba(102, 187, 106, 0.22),
        rgba(255, 202, 40, 0.22),
        rgba(229, 57, 53, 0.26)
      );
      border: 1px solid var(--border-soft);
    }

    .gauge-marker {
      position: absolute;
      top: -3px;
      width: 2px;
      height: 22px;
      background: var(--accent-strong);
      box-shadow: 0 0 6px rgba(255, 152, 0, 0.9);
      transform: translateX(-50%);
    }

    .gauge-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-top: 3px;
    }

    .breakdown-row {
      margin-top: 6px;
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .breakdown-chip {
      font-size: 0.7rem;
      padding: 3px 6px;
      border-radius: 999px;
      background: #171e2a;
      border: 1px solid var(--border-soft);
      color: var(--text-soft);
    }

    .two-col {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1fr);
      gap: 8px;
    }

    @media (max-width: 800px) {
      .two-col {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .food-list {
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      background: #0d111a;
      max-height: 210px;
      overflow-y: auto;
      padding: 4px;
    }

    .food-category {
      margin-bottom: 4px;
    }

    .food-category-title {
      font-size: 0.72rem;
      color: var(--text-soft);
      padding: 2px 4px;
      border-bottom: 1px solid var(--border-soft);
    }

    .food-row {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 4px 4px;
      border-radius: 8px;
      cursor: pointer;
    }

    .food-row:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .food-row.active {
      background: rgba(255, 152, 0, 0.14);
      border: 1px solid rgba(255, 152, 0, 0.5);
    }

    .food-emoji {
      font-size: 1rem;
      width: 22px;
    }

    .food-main {
      flex: 1;
      min-width: 0;
    }

    .food-name {
      font-size: 0.78rem;
    }

    .food-meta {
      font-size: 0.7rem;
      color: var(--text-soft);
    }

    .food-tag {
      font-size: 0.68rem;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 2px 6px;
      color: var(--text-soft);
    }

    .small-btn {
      font-size: 0.72rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #151b27;
      color: var(--text-main);
      cursor: pointer;
      white-space: nowrap;
    }

    .small-btn.primary {
      border-color: var(--accent-strong);
      background: #1e262f;
    }

    .small-btn:hover {
      border-color: var(--accent-strong);
    }

    .pill-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .pill-btn {
      font-size: 0.72rem;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #131825;
      color: var(--text-main);
      cursor: pointer;
      white-space: nowrap;
    }

    .pill-btn.active {
      background: rgba(255, 152, 0, 0.14);
      border-color: var(--accent-strong);
      color: var(--accent);
    }

    .symptom-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .symptom-btn {
      font-size: 0.72rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #141926;
      color: var(--text-main);
      cursor: pointer;
      white-space: nowrap;
    }

    .symptom-btn:hover {
      border-color: var(--accent-strong);
    }

    .timeline-bar {
      display: grid;
      grid-template-columns: 1fr 2fr 1.5fr;
      border-radius: 999px;
      overflow: hidden;
      height: 16px;
      border: 1px solid var(--border-soft);
    }

    .timeline-seg {
      height: 100%;
    }

    .timeline-spike {
      background: linear-gradient(90deg, #ffb300, #ff9800);
    }

    .timeline-crash {
      background: linear-gradient(90deg, #ff7043, #e53935);
    }

    .timeline-recover {
      background: linear-gradient(90deg, #6d4c41, #424242);
    }

    .timeline-marker {
      position: relative;
      height: 24px;
      margin-top: 4px;
    }

    .timeline-marker-line {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--accent-strong);
      box-shadow: 0 0 6px rgba(255, 152, 0, 0.9);
      transform: translateX(-50%);
    }

    .timeline-marker-label {
      position: absolute;
      top: 18px;
      transform: translateX(-50%);
      font-size: 0.72rem;
      color: var(--accent);
      white-space: nowrap;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.6);
    }

    .timeline-labels,
    .timeline-scale {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-top: 2px;
    }

    .share-row {
      margin-top: 8px;
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
      font-size: 0.72rem;
      color: var(--text-soft);
    }

    .why-btn {
      margin-top: 4px;
      font-size: 0.75rem;
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #151b28;
      color: var(--text-main);
      cursor: pointer;
    }

    .why-text {
      margin-top: 6px;
      font-size: 0.75rem;
      color: var(--text-soft);
      line-height: 1.45;
    }
  </style>
</head>
<body>
<div class="page">

  <div class="strip">
    <div class="strip-inner">
      <div class="strip-main">
        <div class="strip-score">
          <span class="strip-score-number" id="stripScoreNumber">0</span>
          <span class="strip-score-label" id="stripScoreLabel">Waiting for data</span>
        </div>
        <div class="strip-window" id="stripWindowLabel">
          Add a meal and timing to see your crash window.
        </div>
      </div>
      <div class="strip-share">
        <button class="strip-btn" id="shareStripBtn">Copy summary</button>
        <span id="shareStatus">Free, no login; you own your data.</span>
      </div>
    </div>
  </div>

  <div class="title-row">
    <h1>Biology-Based Crash Window Calculator (beta)</h1>
    <div class="title-sub">
      For people who feel ‚Äúanxious‚Äù after carbs, sugar and caffeine. This is about
      <strong>visceral sensitivity, blood sugar swings and timing</strong>, not moral weakness.
    </div>
  </div>

  <div class="layout">
    <div class="card">
      <div class="card-title">
        <span>Main spike estimate</span>
        <span>Free, anonymous; no data leaves your browser.</span>
      </div>

      <div class="score-strip">
        <div class="score-main">
          <div class="score-left">
            <div class="score-number" id="scoreMainNumber">0</div>
            <div class="score-label-block">
              <div class="score-label-main" id="scoreMainLabel">Waiting for enough data</div>
              <div class="score-meaning" id="scoreMeaning">
                Add a rough meal type, some sugar or caffeine, and timing to see a biology-based spike score.
              </div>
            </div>
          </div>
          <div class="score-right">
            <div class="risk-chip" id="riskChip">
              Waiting for meal + timing
            </div>
            <div class="biology-line" id="biologyLine">
              Biology vs ‚Äújust anxiety‚Äù will show here once we have a real spike.
            </div>
            <div class="confidence-line" id="confidenceLine">
              Confidence: very low (not enough info yet).
            </div>
          </div>
        </div>

        <div class="gauge-row">
          <div class="gauge">
            <div class="gauge-marker" id="gaugeMarker" style="left:0%;"></div>
          </div>
          <div class="gauge-labels">
            <span>Very low</span>
            <span>Moderate</span>
            <span>Very high</span>
          </div>
        </div>

        <div class="breakdown-row" id="breakdownRow">
          <span class="helper-text">Waiting for enough data to show what is driving this.</span>
        </div>
      </div>

      <div class="card-soft" style="margin-top:10px;">
        <div class="card-title">
          <span>Basic timing and sensitivity</span>
        </div>
        <div class="two-col">
          <div>
            <div class="section-row">
              <label for="timeSinceMealRange">Time since you started eating</label>
              <input id="timeSinceMealRange" type="range" min="0" max="240" value="0" />
              <div class="helper-text" id="timeSinceMealLabel">Just now</div>
            </div>

            <div class="section-row">
              <label for="mealClockTime">
                What time did you start this meal?
                <button type="button" class="info-icon-btn" data-info-target="infoClock">i</button>
              </label>
              <div class="input-row">
                <input id="mealClockTime" type="time" />
              </div>
              <div class="helper-text" id="clockWindowLabel">
                Add a rough meal time to see your crash window in clock time.
              </div>
              <div id="infoClock" class="info-text">
                You do not need an exact minute, just enough to convert ‚Äú90 minutes after eating‚Äù into real-world clock time.
              </div>
            </div>

            <div class="section-row">
              <label for="sensitivitySelect">
                How sensitive is your system today?
                <button type="button" class="info-icon-btn" data-info-target="infoSensitivity">i</button>
              </label>
              <select id="sensitivitySelect">
                <option value="0.8">Lower than usual</option>
                <option value="1" selected>Typical</option>
                <option value="1.3">Very sensitive</option>
              </select>
              <div id="infoSensitivity" class="info-text">
                ‚ÄúVery sensitive‚Äù fits IBS, visceral hypersensitivity, poor sleep, hangover days, hormone swings, or when you already feel on edge.
              </div>
            </div>
          </div>
          <div>
            <div class="section-row">
              <label>Mode</label>
              <div class="mode-toggle">
                <button type="button" class="mode-btn active" id="simpleModeBtn">Simple (tap foods)</button>
                <button type="button" class="mode-btn" id="advancedModeBtn">Advanced (enter numbers)</button>
              </div>
              <div class="helper-text">
                Simple mode is fine for most people. Advanced mode is for nutrition label nerds.
              </div>
            </div>
          </div>
        </div>
      </div>
            <div class="card-soft" id="simplePanel" style="margin-top:10px;">
        <div class="card-title">
          <span>Simple: what did this meal look like?</span>
          <span>Tap something close; it does not have to be perfect.</span>
        </div>

        <div class="section-row">
          <div class="input-row">
            <input
              type="text"
              id="foodSearch"
              placeholder="Search: pasta, pizza, salad, burger, dessert‚Ä¶"
            />
            <button type="button" class="small-btn" id="clearFoodBtn">Clear</button>
          </div>
          <div class="helper-text">
            These are rough presets. Pick the closest match to what you actually ate.
          </div>
        </div>

        <div class="section-row">
          <div class="food-list" id="foodList"></div>
          <div class="warning-text" id="dataWarning"></div>
        </div>

        <div class="section-row">
          <label>
            Extra dessert / sweets
            <button type="button" class="info-icon-btn" data-info-target="infoSugar">i</button>
          </label>
          <div class="pill-buttons">
            <button type="button" class="pill-btn" data-sugar="0">None</button>
            <button type="button" class="pill-btn" data-sugar="10">Small treat (~10 g)</button>
            <button type="button" class="pill-btn" data-sugar="20">Medium dessert (~20 g)</button>
            <button type="button" class="pill-btn" data-sugar="35">Big dessert (~35 g)</button>
          </div>
          <div class="input-row" style="margin-top:4px;">
            <input
              type="number"
              id="simpleSugarExact"
              placeholder="Or enter sugar directly in grams"
              min="0"
            />
          </div>
          <div class="helper-text">
            Examples: 2 cookies ‚âà 18 g, typical candy bar ‚âà 25 g, big dessert plate ‚âà 30‚Äì40 g, pint of ice cream can be 60+ g.
          </div>
          <div id="infoSugar" class="info-text">
            This is sugar on top of the meal, not counting the carbs from pasta, bread or rice.
          </div>
        </div>

        <div class="section-row">
          <label>
            Soda / sugary drink with this meal
            <button type="button" class="info-icon-btn" data-info-target="infoSoda">i</button>
          </label>
          <div class="pill-buttons">
            <button type="button" class="pill-btn" data-soda-sugar="0" data-soda-caf="0">None</button>
            <button type="button" class="pill-btn" data-soda-sugar="39" data-soda-caf="0">
              Soda can (no caffeine)
            </button>
            <button type="button" class="pill-btn" data-soda-sugar="39" data-soda-caf="35">
              Soda can (caffeinated)
            </button>
            <button type="button" class="pill-btn" data-soda-sugar="60" data-soda-caf="0">
              Large soda (no caffeine)
            </button>
            <button type="button" class="pill-btn" data-soda-sugar="60" data-soda-caf="60">
              Large soda (caffeinated)
            </button>
          </div>
          <div class="helper-text">
            These are rough estimates. If you want to be exact, use the label sugar in the advanced section.
          </div>
          <div id="infoSoda" class="info-text">
            Sugary drinks hit fast because they skip chewing and fiber. For sensitive people this can be a huge part of the spike.
          </div>
        </div>

        <div class="section-row">
          <label>
            Coffee / tea / energy drink (caffeine)
            <button type="button" class="info-icon-btn" data-info-target="infoCaf">i</button>
          </label>
          <div class="pill-buttons">
            <button type="button" class="pill-btn" data-caf="0">None</button>
            <button type="button" class="pill-btn" data-caf="90">Small coffee (~90 mg)</button>
            <button type="button" class="pill-btn" data-caf="150">Large coffee (~150‚Äì200 mg)</button>
            <button type="button" class="pill-btn" data-caf="160">Energy drink (~160 mg)</button>
            <button type="button" class="pill-btn" data-caf="240">Strong energy drink (~240 mg)</button>
          </div>
          <div class="input-row" style="margin-top:4px;">
            <input
              type="number"
              id="simpleCafExact"
              placeholder="Or enter caffeine in mg (optional)"
              min="0"
            />
          </div>
          <div class="helper-text">
            Examples: small coffee ‚âà 90 mg, large ‚âà 150‚Äì200 mg, energy drink can ‚âà 160‚Äì240 mg, strong tea ‚âà 40‚Äì60 mg.
          </div>
          <div id="infoCaf" class="info-text">
            If you are caffeine sensitive, this can stack on top of gut + sugar effects and feel like ‚Äúpure anxiety‚Äù.
          </div>
        </div>
      </div>

      <div class="card-soft" id="advancedPanel" style="margin-top:10px; display:none;">
        <div class="card-title">
          <span>Advanced: use nutrition label numbers</span>
          <span>Optional; simple mode is enough for pattern spotting.</span>
        </div>

        <div class="two-col">
          <div>
            <div class="section-row">
              <label>Carbs from this meal (g)</label>
              <input type="number" id="advCarbs" min="0" max="200" placeholder="Example: 70" />
            </div>
            <div class="section-row">
              <label>Sugar from this meal (g)</label>
              <input type="number" id="advSugar" min="0" max="200" placeholder="Example: 30" />
            </div>
          </div>
          <div>
            <div class="section-row">
              <label>Caffeine (mg)</label>
              <input type="number" id="advCaffeine" min="0" max="500" placeholder="Example: 160" />
            </div>
            <div class="section-row">
              <label>Fiber and fat feel</label>
              <div class="input-row">
                <input
                  type="number"
                  id="advFiber"
                  min="0"
                  max="25"
                  placeholder="Fiber g (optional)"
                  style="flex:1;"
                />
                <select id="advFat" style="flex:1;">
                  <option value="0">Not heavy / low fat</option>
                  <option value="1">Medium / normal</option>
                  <option value="2">Heavy / greasy</option>
                </select>
              </div>
              <div class="helper-text">
                More fiber softens spikes slightly. Heavier fat can delay them so the worst part hits later.
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card-soft" style="margin-top:10px;">
        <div class="card-title">
          <span>Crash window map</span>
          <button type="button" class="info-icon-btn" data-info-target="infoTimeline">i</button>
        </div>
        <div class="section-row" style="margin-top:2px;">
          <div class="timeline-bar">
            <div class="timeline-seg timeline-spike"></div>
            <div class="timeline-seg timeline-crash"></div>
            <div class="timeline-seg timeline-recover"></div>
          </div>
          <div class="timeline-marker">
            <div class="timeline-marker-line" id="timelineMarkerLine" style="left:0%;"></div>
            <div class="timeline-marker-label" id="timelineMarkerLabel" style="left:0%;">
              You are here
            </div>
          </div>
          <div class="timeline-labels">
            <span>0‚Äì45 min: spike building</span>
            <span>45‚Äì150 min: crash / anxiety</span>
            <span>150‚Äì240 min: recovery / slump</span>
          </div>
          <div class="timeline-scale">
            <span>0</span>
            <span>60</span>
            <span>120</span>
            <span>180</span>
            <span>240 min</span>
          </div>
          <div class="helper-text" id="timelineHelper">
            Add meal, sugar / caffeine and timing to see where you sit in the 0‚Äì240 minute wave.
          </div>
          <div id="infoTimeline" class="info-text">
            Heavy carbs + sugar + caffeine rarely cause ‚Äúrandom‚Äù feelings. They create a spike, then a crash, then a slump. This bar shows roughly where you are in that 0‚Äì240 minute cycle.
          </div>
        </div>
      </div>

      <div class="card-soft" style="margin-top:10px;">
        <div class="card-title">
          <span>Right now I feel‚Ä¶</span>
        </div>
        <div class="section-row">
          <div class="symptom-buttons">
            <button type="button" class="symptom-btn" data-symptom="jittery">Jittery / buzzy</button>
            <button type="button" class="symptom-btn" data-symptom="warmChest">Warm chest / wired</button>
            <button type="button" class="symptom-btn" data-symptom="flat">Flat / wiped out</button>
            <button type="button" class="symptom-btn" data-symptom="gutBuzz">Gut buzzing</button>
            <button type="button" class="symptom-btn" data-symptom="headache">Headache-ish</button>
            <button type="button" class="symptom-btn" data-symptom="randomAdrenaline">
              Random adrenaline hits
            </button>
          </div>
          <div id="symptomText" class="helper-text">
            Tap one that fits and we‚Äôll tell you whether it matches the predicted crash window.
          </div>
        </div>

        <div class="share-row">
          <button type="button" class="small-btn primary" id="shareBtn">Copy a short summary</button>
          <span>Paste it into Reddit, a note, or a chat. It never leaves your device unless you paste it.</span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">
        <span>Why does this feel like ‚Äúanxiety‚Äù?</span>
      </div>
      <button type="button" class="why-btn" id="whyBtn">
        Why am I feeling this way?
      </button>
      <div id="whyText" class="why-text" style="display:none;">
        Your brain often labels biology as ‚Äúanxiety‚Äù. A heavy carb + sugar + caffeine load can:
        <ul style="padding-left:18px; margin:4px 0;">
          <li>Stretch your gut and trigger visceral nerves</li>
          <li>Spike blood sugar and then over-correct into a crash</li>
          <li>Layer caffeine-driven adrenaline on top of that crash</li>
        </ul>
        If you are highly sensitive, that internal noise can feel identical to ‚ÄúI am freaking out‚Äù, even when nothing external is wrong.
        <br /><br />
        Over time you can use this to spot patterns, adjust timing, and prove to yourself that a lot of this is
        <strong>predictable body chemistry</strong>, not random doom.
      </div>
    </div>
  </div> <!-- end layout -->

</div> <!-- end page -->
<script>
  // ---------------------------
  // Food presets (grouped)
  // ---------------------------
  const mealCategories = [
    {
      name: "Pasta / rice / bowls",
      id: "pastaRice",
      items: [
        { id: "pasta", emoji: "üçù", name: "Plate of pasta", carbs: 80, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
        { id: "riceBowl", emoji: "üçö", name: "Rice bowl", carbs: 70, fiber: 2, fatLevel: 0, sugarBase: 2, tag: "High carb" },
        { id: "ramen", emoji: "üçú", name: "Ramen or noodle bowl", carbs: 65, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
        { id: "chipotleBowl", emoji: "ü•ó", name: "Burrito bowl", carbs: 65, fiber: 7, fatLevel: 2, sugarBase: 3, tag: "High carb, higher fiber" }
      ]
    },
    {
      name: "Pizza / fast food",
      id: "pizzaFast",
      items: [
        { id: "pizza2", emoji: "üçï", name: "Pizza, 2 slices", carbs: 60, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "High carb and fat" },
        { id: "pizza3", emoji: "üçï", name: "Pizza, 3 slices", carbs: 90, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "Very high carb" },
        { id: "burgerFries", emoji: "üçî", name: "Burger with fries", carbs: 70, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "Heavy" },
        { id: "burgerOnly", emoji: "üçî", name: "Burger, no fries", carbs: 45, fiber: 2, fatLevel: 2, sugarBase: 2, tag: "Medium carb" }
      ]
    },
    {
      name: "Lighter plates",
      id: "lightPlates",
      items: [
        { id: "saladLowCarb", emoji: "ü•ó", name: "Green salad, low carb", carbs: 18, fiber: 6, fatLevel: 1, sugarBase: 1, tag: "Light" },
        { id: "chickenVeg", emoji: "üçó", name: "Grilled chicken with vegetables", carbs: 20, fiber: 4, fatLevel: 1, sugarBase: 1, tag: "Lower carb" },
        { id: "salmonVeg", emoji: "üêü", name: "Salmon with vegetables", carbs: 15, fiber: 4, fatLevel: 2, sugarBase: 1, tag: "Lower carb" }
      ]
    },
    {
      name: "Desserts",
      id: "desserts",
      items: [
        { id: "iceCream", emoji: "üç®", name: "Ice cream bowl", carbs: 45, fiber: 1, fatLevel: 2, sugarBase: 28, tag: "High sugar" },
        { id: "cakeSlice", emoji: "üç∞", name: "Slice of cake", carbs: 45, fiber: 1, fatLevel: 2, sugarBase: 28, tag: "High sugar" },
        { id: "cookie2", emoji: "üç™", name: "Cookies, a couple", carbs: 30, fiber: 1, fatLevel: 2, sugarBase: 18, tag: "High sugar" }
      ]
    }
  ];

  let selectedMealId = null;
  let simpleSugarExtra = 0;
  let simpleCaffeine = 0;
  let simpleSodaSugar = 0;
  let simpleSodaCaf = 0;

  const elements = {
    simpleModeBtn: document.getElementById("simpleModeBtn"),
    advancedModeBtn: document.getElementById("advancedModeBtn"),
    simplePanel: document.getElementById("simplePanel"),
    advancedPanel: document.getElementById("advancedPanel"),

    timeRange: document.getElementById("timeSinceMealRange"),
    timeLabel: document.getElementById("timeSinceMealLabel"),
    sensitivitySelect: document.getElementById("sensitivitySelect"),
    mealClockTime: document.getElementById("mealClockTime"),
    clockWindowLabel: document.getElementById("clockWindowLabel"),

    foodList: document.getElementById("foodList"),
    foodSearch: document.getElementById("foodSearch"),
    clearFoodBtn: document.getElementById("clearFoodBtn"),
    dataWarning: document.getElementById("dataWarning"),

    simpleSugarExact: document.getElementById("simpleSugarExact"),
    simpleCafExact: document.getElementById("simpleCafExact"),

    scoreMainNumber: document.getElementById("scoreMainNumber"),
    scoreMainLabel: document.getElementById("scoreMainLabel"),
    scoreMeaning: document.getElementById("scoreMeaning"),
    biologyLine: document.getElementById("biologyLine"),
    confidenceLine: document.getElementById("confidenceLine"),

    riskChip: document.getElementById("riskChip"),
    gaugeMarker: document.getElementById("gaugeMarker"),
    breakdownRow: document.getElementById("breakdownRow"),

    timelineMarkerLine: document.getElementById("timelineMarkerLine"),
    timelineMarkerLabel: document.getElementById("timelineMarkerLabel"),
    timelineHelper: document.getElementById("timelineHelper"),

    symptomText: document.getElementById("symptomText"),

    stripScoreNumber: document.getElementById("stripScoreNumber"),
    stripScoreLabel: document.getElementById("stripScoreLabel"),
    stripWindowLabel: document.getElementById("stripWindowLabel"),

    shareBtn: document.getElementById("shareBtn"),
    shareStripBtn: document.getElementById("shareStripBtn"),
    shareStatus: document.getElementById("shareStatus"),

    whyBtn: document.getElementById("whyBtn"),
    whyText: document.getElementById("whyText")
  };

  // ---------------------------
  // Small helpers
  // ---------------------------
  function minutesLabel(val) {
    const v = Number(val);
    if (v === 0) return "Just now";
    if (v <= 30) return "~" + v + " minutes ago";
    const hours = Math.round((v / 60) * 10) / 10;
    if (hours < 1) return "~" + v + " minutes ago";
    return "~" + hours + " hours ago";
  }

  function formatClock(mins) {
    let m = ((mins % 1440) + 1440) % 1440;
    const h = Math.floor(m / 60);
    const mm = m % 60;
    const suffix = h >= 12 ? "PM" : "AM";
    let displayH = h % 12;
    if (displayH === 0) displayH = 12;
    return `${displayH}:${mm.toString().padStart(2, "0")} ${suffix}`;
  }

  function renderFoods(filterText = "") {
    const root = elements.foodList;
    root.innerHTML = "";
    const term = filterText.trim().toLowerCase();

    mealCategories.forEach(cat => {
      const filteredItems = cat.items.filter(item => {
        if (!term) return true;
        const hay = (item.name + " " + (item.tag || "")).toLowerCase();
        return hay.includes(term);
      });

      if (filteredItems.length === 0) return;

      const catDiv = document.createElement("div");
      catDiv.className = "food-category";

      const title = document.createElement("div");
      title.className = "food-category-title";
      title.textContent = cat.name;
      catDiv.appendChild(title);

      filteredItems.forEach(item => {
        const row = document.createElement("div");
        row.className = "food-row";
        row.dataset.mealId = item.id;

        const emojiSpan = document.createElement("div");
        emojiSpan.className = "food-emoji";
        emojiSpan.textContent = item.emoji;
        row.appendChild(emojiSpan);

        const mainDiv = document.createElement("div");
        mainDiv.className = "food-main";

        const nameDiv = document.createElement("div");
        nameDiv.className = "food-name";
        nameDiv.textContent = item.name;
        mainDiv.appendChild(nameDiv);

        const metaDiv = document.createElement("div");
        metaDiv.className = "food-meta";
        metaDiv.textContent = `${item.carbs} g carbs ‚Ä¢ ${item.tag}`;
        mainDiv.appendChild(metaDiv);

        row.appendChild(mainDiv);

        const tagSpan = document.createElement("span");
        tagSpan.className = "food-tag";
        tagSpan.textContent = item.tag;
        row.appendChild(tagSpan);

        row.addEventListener("click", () => {
          selectedMealId = item.id;
          document.querySelectorAll(".food-row").forEach(r => r.classList.remove("active"));
          row.classList.add("active");
          updateScore();
        });

        catDiv.appendChild(row);
      });

      root.appendChild(catDiv);
    });
  }

  function getSelectedMeal() {
    for (const cat of mealCategories) {
      for (const item of cat.items) {
        if (item.id === selectedMealId) return item;
      }
    }
    return null;
  }
    // ---------------------------
  // Core math model
  // ---------------------------
  function computeRisk() {
    const timeMin = Number(elements.timeRange.value);
    const sensitivity = Number(elements.sensitivitySelect.value);
    const useAdvanced = elements.advancedPanel.style.display !== "none";

    let carbs = 0;
    let sugar = 0;
    let caffeine = 0;
    let fiber = 0;
    let fatLevel = 0;

    if (useAdvanced) {
      carbs = Number(document.getElementById("advCarbs").value || 0);
      sugar = Number(document.getElementById("advSugar").value || 0);
      caffeine = Number(document.getElementById("advCaffeine").value || 0);
      fiber = Number(document.getElementById("advFiber").value || 0);
      fatLevel = Number(document.getElementById("advFat").value || 0);
    } else {
      const meal = getSelectedMeal();
      if (meal) {
        carbs = meal.carbs;
        fiber = meal.fiber || 0;
        fatLevel = meal.fatLevel || 0;
        sugar = meal.sugarBase || 0;
      }
      const dessertExtra = elements.simpleSugarExact.value !== ""
        ? Number(elements.simpleSugarExact.value)
        : simpleSugarExtra;
      if (!isNaN(dessertExtra)) sugar += dessertExtra;

      sugar += simpleSodaSugar;

      const extraCaf = elements.simpleCafExact.value !== ""
        ? Number(elements.simpleCafExact.value)
        : simpleCaffeine;
      caffeine = (isNaN(extraCaf) ? 0 : extraCaf) + simpleSodaCaf;
    }

    carbs = Math.max(0, Math.min(carbs, 200));
    sugar = Math.max(0, Math.min(sugar, 200));
    caffeine = Math.max(0, Math.min(caffeine, 500));

    const carbPoints = Math.min(40, carbs * 0.5);
    const sugarPoints = Math.min(40, sugar * 0.7);
    const caffeinePoints = Math.min(20, caffeine * 0.07);

    const t = Math.max(0, Math.min(Number(elements.timeRange.value), 240));
    const center = 90;
    const spread = 70;

    const fatDelayMinutes = fatLevel * 20;
    const effectiveTime = Math.max(0, Math.min(t + fatDelayMinutes, 240));
    const timingFactor = Math.exp(-Math.pow(effectiveTime - center, 2) / (2 * spread * spread));
    const timingMultiplier = 0.2 + timingFactor * 0.9;

    const fiberEffect = 1 - Math.min(0.25, fiber * 0.02);

    const baseSum = carbPoints + sugarPoints + caffeinePoints;
    let rawScore = baseSum * timingMultiplier * sensitivity * fiberEffect;
    rawScore = Math.max(0, Math.min(100, rawScore));

    const contributions = { carbs: 0, sugar: 0, caffeine: 0, timing: 0 };
    if (baseSum > 0) {
      contributions.carbs = (carbPoints / baseSum) * 100;
      contributions.sugar = (sugarPoints / baseSum) * 100;
      contributions.caffeine = (caffeinePoints / baseSum) * 100;
      contributions.timing = 100 - (contributions.carbs + contributions.sugar + contributions.caffeine);
    }

    return {
      score: rawScore,
      carbs,
      sugar,
      caffeine,
      timeMin: t,
      effectiveTime,
      contributions,
      hasMeal: !!getSelectedMeal(),
      hasSugar: sugar > 0,
      hasCaffeine: caffeine > 0
    };
  }

  function riskLabel(score) {
    if (score < 20) return "Very low";
    if (score < 40) return "Low";
    if (score < 60) return "Moderate";
    if (score < 80) return "High";
    return "Very high";
  }

  function riskChipClass(score) {
    if (score < 40) return "risk-chip risk-low";
    if (score < 75) return "risk-chip risk-moderate";
    return "risk-chip risk-high";
  }

  function scoreMeaningText(score) {
    if (score < 5) {
      return "Add a rough meal type, sugar or caffeine and timing to see a real spike estimate.";
    }
    if (score < 20) {
      return "Biology is pretty quiet. This is probably not a strong food or caffeine-driven episode.";
    }
    if (score < 40) {
      return "Mild spike. Your load might be nudging you, but something else may also be involved.";
    }
    if (score < 60) {
      return "Moderate spike. Your gut and blood sugar are likely contributing to how you feel.";
    }
    if (score < 80) {
      return "High spike. This timing and load strongly fit a crash window for sensitive people.";
    }
    return "Very high spike. This is classic body-driven anxiety territory for sensitive systems.";
  }

  function biologyLineText(score) {
    if (score < 20) {
      return "Biology: low. If you feel awful, it may be less about food timing and more about stress, thoughts or something else.";
    }
    if (score < 40) {
      return "Biology: mild. Your body is involved, but it is not screaming. Thoughts, context and posture still matter a lot here.";
    }
    if (score < 60) {
      return "Biology: moderate. This is likely biology-first, thoughts-second, especially if you are already sensitive.";
    }
    if (score < 80) {
      return "Biology: strong. For most sensitive people this level of load and timing can feel like ‚Äúpure anxiety‚Äù even when life is calm.";
    }
    return "Biology: very strong. This is the kind of spike that can convince anyone something is terribly wrong, even when it is mostly timing and chemistry.";
  }

  function confidenceText(result) {
    const { hasMeal, hasSugar, hasCaffeine, timeMin } = result;

    if (!hasMeal && !hasSugar && !hasCaffeine) {
      return "Confidence: very low (no meal, sugar or caffeine entered yet).";
    }
    if (!hasMeal && (hasSugar || hasCaffeine)) {
      return "Confidence: low (you entered sugar or caffeine, but no meal type; add a rough meal to tighten this up).";
    }
    if (hasMeal && (!hasSugar && !hasCaffeine)) {
      if (timeMin === 0) {
        return "Confidence: low (meal selected but timing is set to just now; slide the time since you started eating).";
      }
      return "Confidence: medium (meal and timing entered; sugar and caffeine left at zero).";
    }
    if (hasMeal && (hasSugar || hasCaffeine)) {
      if (timeMin === 0) {
        return "Confidence: medium (good load info, but timing is still at ‚Äújust now‚Äù; slide it closer to reality).";
      }
      return "Confidence: high (you entered meal, timing and at least some sugar or caffeine).";
    }
    return "Confidence: medium (partial data; the more you enter, the better this will line up with reality).";
  }

  function windowLabel(timeMin, effectiveTime) {
    if (timeMin === 0) return "‚è±Ô∏è Just ate this meal.";
    const t = effectiveTime;
    if (t < 40) return "‚è±Ô∏è Early digestion; spike is still building.";
    if (t <= 140) return "‚ö° Crash / anxiety window is active.";
    if (t <= 200) return "üå´Ô∏è Late crash / slump window.";
    return "üåô Probably in the recovery phase now.";
  }

  function updateClockWindow(result) {
    const input = elements.mealClockTime.value;
    if (!input) {
      elements.clockWindowLabel.textContent = "Add a rough meal time to see your crash window in clock time.";
      return;
    }
    const [hhStr, mmStr] = input.split(":");
    const hh = Number(hhStr);
    const mm = Number(mmStr);
    if (isNaN(hh) || isNaN(mm)) {
      elements.clockWindowLabel.textContent = "Meal time looks invalid. Try re-entering it.";
      return;
    }
    const mealStartMinOfDay = hh * 60 + mm;
    const crashStart = mealStartMinOfDay + 45;
    const crashEnd = mealStartMinOfDay + 150;
    const currentPoint = mealStartMinOfDay + result.effectiveTime;

    const crashStartStr = formatClock(crashStart);
    const crashEndStr = formatClock(crashEnd);
    const currentStr = formatClock(currentPoint);

    elements.clockWindowLabel.textContent =
      `If you started eating around ${formatClock(mealStartMinOfDay)}, your main crash window is roughly ${crashStartStr} to ${crashEndStr}. Right now you are around ${currentStr}.`;
  }

  function updateScore() {
    const result = computeRisk();
    const s = Math.round(result.score);

    elements.timeLabel.textContent = minutesLabel(result.timeMin);

    elements.scoreMainNumber.textContent = s;
    const label = riskLabel(s);
    elements.scoreMainLabel.textContent = label;
    elements.stripScoreNumber.textContent = s;
    elements.stripScoreLabel.textContent = label;

    elements.scoreMeaning.textContent = scoreMeaningText(s);
    elements.biologyLine.textContent = biologyLineText(s);
    elements.confidenceLine.textContent = confidenceText(result);

    const markerPos = Math.max(0, Math.min(100, s));
    elements.gaugeMarker.style.left = markerPos + "%";

    elements.riskChip.className = riskChipClass(s);
    if (s === 0) {
      elements.riskChip.textContent = "Waiting for meal + sugar / caffeine";
    } else {
      elements.riskChip.textContent = label + " spike right now";
    }

    elements.stripWindowLabel.textContent = windowLabel(result.timeMin, result.effectiveTime);

    elements.breakdownRow.innerHTML = "";
    if (s === 0) {
      const span = document.createElement("span");
      span.className = "helper-text";
      span.textContent = "Waiting for enough data to show what is driving this (carbs, sugar, caffeine, timing).";
      elements.breakdownRow.appendChild(span);
    } else {
      const c = result.contributions;
      const chips = [
        { label: "Carbs", val: c.carbs },
        { label: "Sugar", val: c.sugar },
        { label: "Caffeine", val: c.caffeine },
        { label: "Timing / sensitivity", val: c.timing }
      ];
      chips.forEach(ch => {
        const span = document.createElement("span");
        span.className = "breakdown-chip";
        span.textContent = `${ch.label}: ${Math.round(ch.val)}%`;
        elements.breakdownRow.appendChild(span);
      });
    }

    const tPercent = (Math.max(0, Math.min(result.effectiveTime, 240)) / 240) * 100;
    elements.timelineMarkerLine.style.left = tPercent + "%";
    elements.timelineMarkerLabel.style.left = tPercent + "%";

    if (s === 0) {
      elements.timelineHelper.textContent =
        "Add meal, sugar / caffeine and timing to see where you sit in the 0‚Äì240 minute wave.";
    } else {
      elements.timelineHelper.textContent =
        "This shows roughly where your body is in the spike ‚Üí crash ‚Üí recovery cycle for this meal.";
    }

    if (!result.hasMeal && (result.hasSugar || result.hasCaffeine)) {
      elements.dataWarning.textContent =
        "Tip: you entered sugar or caffeine but no meal type. Pick a rough meal above to tighten the estimate.";
    } else {
      elements.dataWarning.textContent = "";
    }

    elements.symptomText.textContent =
      "Tap one that fits and we‚Äôll tell you whether it matches the predicted crash window.";

    updateClockWindow(result);
  }

  function analyzeSymptom(symptom) {
    const result = computeRisk();
    const s = Math.round(result.score);
    const t = result.effectiveTime;

    let text = "";
    const inCrashWindow = t >= 40 && t <= 150;
    const lateCrash = t > 150 && t <= 210;

    if (symptom === "jittery" || symptom === "warmChest" || symptom === "randomAdrenaline") {
      if (inCrashWindow && s >= 40) {
        text = "That wired, buzzy feeling lines up with your predicted crash window. Your biology is loud right now; it does not mean anything is wrong with your character.";
      } else if (lateCrash) {
        text = "This could be a late wave from the same meal, but you are slightly past the main crash window. Still very likely biology, especially with carbs + sugar + caffeine in the mix.";
      } else {
        text = "This does not perfectly line up with the strongest crash window, but your nervous system may still be echoing earlier spikes, especially if today was a heavy carb / sugar day.";
      }
    } else if (symptom === "flat") {
      if (lateCrash || (inCrashWindow && s >= 30)) {
        text = "Feeling flat, blank or tired fits a post-spike slump. Your system may be in the ‚Äòcoming down‚Äô part of the wave after the earlier peak.";
      } else {
        text = "This might be more of a general fatigue rather than a sharp post-meal crash, but today‚Äôs load can still be keeping you lower than your baseline.";
      }
    } else if (symptom === "gutBuzz") {
      if (inCrashWindow) {
        text = "Gut buzzing during the crash window is classic visceral sensitivity. Your gut nerves are amplifying normal digestion into loud body noise.";
      } else {
        text = "You are outside the main crash window, but with visceral sensitivity, gut noise can linger. It still points more to biology than to ‚Äòrandom‚Äô anxiety.";
      }
    } else if (symptom === "headache") {
      if (lateCrash || inCrashWindow) {
        text = "Headaches can trade places with gut symptoms. This timing fits with blood sugar swings + tension. It is likely part of the same body-driven pattern.";
      } else {
        text = "This may be more of a general tension or dehydration headache. Today‚Äôs carbs and sugar can still make it easier to tip into discomfort.";
      }
    }

    if (!text) {
      text = "This tool cannot perfectly label every sensation, but based on your timing and score, biology is playing a big role here.";
    }

    elements.symptomText.textContent = text;
  }

  function buildShareText() {
    const r = computeRisk();
    const s = Math.round(r.score);
    const label = riskLabel(s);
    const sensitivityLabel = {
      "0.8": "low",
      "1": "medium",
      "1.3": "high"
    }[elements.sensitivitySelect.value] || "medium";

    const meal = getSelectedMeal();
    const mealName = meal ? meal.name : "Meal not specified";
    const parts = [];
    parts.push(`Post-meal anxiety spike estimate: ${s}/100 (${label}).`);
    parts.push(`Meal: ${mealName}. Approx carbs: ~${Math.round(r.carbs)} g, sugar: ~${Math.round(r.sugar)} g, caffeine: ~${Math.round(r.caffeine)} mg.`);
    parts.push(`Time since meal: ${minutesLabel(r.timeMin)}. Sensitivity level: ${sensitivityLabel}.`);
    parts.push(`Tool: darkstar747.github.io (free, no login, biology-based timing calculator).`);
    return parts.join(" ");
  }

  async function copyShareText() {
    const text = buildShareText();
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        elements.shareStatus.textContent = "Copied! You can paste this into Reddit, a note, or a chat.";
      } else {
        elements.shareStatus.textContent = "Copy failed: clipboard unavailable in this browser.";
        alert(text);
      }
    } catch (err) {
      elements.shareStatus.textContent = "Copy failed. Your browser may be blocking clipboard access.";
    }
  }

  // ---------------------------
  // Event wiring
  // ---------------------------
  function initEvents() {
    elements.simpleModeBtn.addEventListener("click", () => {
      elements.simpleModeBtn.classList.add("active");
      elements.advancedModeBtn.classList.remove("active");
      elements.simplePanel.style.display = "";
      elements.advancedPanel.style.display = "none";
      updateScore();
    });

    elements.advancedModeBtn.addEventListener("click", () => {
      elements.advancedModeBtn.classList.add("active");
      elements.simpleModeBtn.classList.remove("active");
      elements.simplePanel.style.display = "none";
      elements.advancedPanel.style.display = "";
      updateScore();
    });

    elements.timeRange.addEventListener("input", () => {
      elements.timeLabel.textContent = minutesLabel(elements.timeRange.value);
      updateScore();
    });

    elements.mealClockTime.addEventListener("input", () => {
      updateScore();
    });

    elements.sensitivitySelect.addEventListener("change", updateScore);

    elements.foodSearch.addEventListener("input", e => {
      renderFoods(e.target.value);
    });

    elements.clearFoodBtn.addEventListener("click", () => {
      elements.foodSearch.value = "";
      selectedMealId = null;
      renderFoods("");
      updateScore();
    });

    document.querySelectorAll('[data-sugar]').forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll('[data-sugar]').forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        simpleSugarExtra = Number(btn.dataset.sugar || 0);
        elements.simpleSugarExact.value = "";
        updateScore();
      });
    });

    elements.simpleSugarExact.addEventListener("input", () => {
      document.querySelectorAll('[data-sugar]').forEach(b => b.classList.remove("active"));
      updateScore();
    });

    document.querySelectorAll('[data-soda-sugar]').forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll('[data-soda-sugar]').forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        simpleSodaSugar = Number(btn.dataset.sodaSugar || 0);
        simpleSodaCaf = Number(btn.dataset.sodaCaf || 0);
        updateScore();
      });
    });

    document.querySelectorAll('[data-caf]').forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll('[data-caf]').forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        simpleCaffeine = Number(btn.dataset.caf || 0);
        elements.simpleCafExact.value = "";
        updateScore();
      });
    });

    elements.simpleCafExact.addEventListener("input", () => {
      document.querySelectorAll('[data-caf]').forEach(b => b.classList.remove("active"));
      updateScore();
    });

    ["advCarbs", "advSugar", "advCaffeine", "advFiber", "advFat"].forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      if (el.tagName === "SELECT") {
        el.addEventListener("change", updateScore);
      } else {
        el.addEventListener("input", updateScore);
      }
    });

    document.querySelectorAll(".info-icon-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const targetId = btn.getAttribute("data-info-target");
        if (!targetId) return;
        const info = document.getElementById(targetId);
        if (!info) return;
        info.classList.toggle("visible");
      });
    });

    document.querySelectorAll(".symptom-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const s = btn.getAttribute("data-symptom");
        analyzeSymptom(s);
      });
    });

    elements.shareBtn.addEventListener("click", copyShareText);
    elements.shareStripBtn.addEventListener("click", copyShareText);

    function toggleWhy() {
      const visible = elements.whyText.style.display === "block";
      elements.whyText.style.display = visible ? "none" : "block";
    }
    elements.whyBtn.addEventListener("click", toggleWhy);
  }

  renderFoods("");
  initEvents();
  updateScore();
</script>
</body>
</html>
