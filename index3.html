<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Post-Meal Anxiety Timing Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Free, no-login calculator that estimates anxiety spikes after carbs, sugar and caffeine, based on timing and sensitivity.">
  <style>
    :root {
      --base-font-size: 18px;
      --bg: #050709;
      --card: #11141a;
      --card-soft: #151923;
      --accent: #22c5ff;
      --accent-soft: rgba(34, 197, 255, 0.12);
      --danger: #ff4d6a;
      --warn: #fbbf24;
      --ok: #22c55e;
      --text-main: #f5f5f5;
      --text-soft: #c0c6d4;
      --border-subtle: #252b38;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #101827 0, #020308 55%, #000 100%);
      color: var(--text-main);
      font-size: var(--base-font-size);
      -webkit-font-smoothing: antialiased;
    }

    body.large-text {
      font-size: 19px;
    }

    body.high-contrast {
      --card: #05070c;
      --card-soft: #090d16;
      --border-subtle: #2f3746;
    }

    * {
      box-sizing: border-box;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    .page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 14px 14px 32px;
    }

    header {
      margin-bottom: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    h1 {
      font-size: 1.35rem;
      margin: 0;
      letter-spacing: 0.01em;
    }

    .badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    .badge {
      border-radius: 999px;
      padding: 4px 10px;
      border: 1px solid var(--border-subtle);
      background: linear-gradient(120deg, rgba(34,197,255,0.16), rgba(15,23,42,0.4));
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge span.emoji {
      font-size: 0.9rem;
    }

    .controls-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 0.82rem;
      color: var(--text-soft);
    }

    .toggle-pill {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      padding: 4px 8px;
      background: rgba(15,23,42,0.7);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .toggle-pill button {
      border: none;
      background: transparent;
      color: var(--text-soft);
      cursor: pointer;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 0.8rem;
    }

    .toggle-pill button.active {
      background: var(--accent);
      color: #020617;
      font-weight: 600;
    }

    /* Always-visible score strip */
    .score-strip {
      margin: 8px 0 14px;
      border-radius: 10px;
      padding: 8px 12px;
      border: 1px solid var(--border-subtle);
      background: linear-gradient(120deg, rgba(34,197,255,0.12), rgba(15,23,42,0.85));
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .score-strip-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .score-strip-label {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .score-strip-value {
      font-size: 1rem;
      font-weight: 600;
    }

    .score-strip-value span.number {
      font-size: 1.1rem;
    }

    .score-strip-chip {
      font-size: 0.78rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      color: var(--text-soft);
      background: rgba(15,23,42,0.8);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .score-strip-cta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .small-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.9);
      color: var(--text-soft);
      cursor: pointer;
      padding: 4px 10px;
      font-size: 0.78rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .small-btn.primary {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: var(--text-main);
    }

    .small-btn:hover {
      filter: brightness(1.1);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.1fr);
      gap: 16px;
      align-items: flex-start;
    }

    .card {
      border-radius: 14px;
      background: radial-gradient(circle at top left, rgba(15,118,255,0.16), rgba(15,23,42,0.95));
      border: 1px solid var(--border-subtle);
      padding: 12px 12px 14px;
    }

    .card-soft {
      border-radius: 14px;
      background: var(--card-soft);
      border: 1px solid var(--border-subtle);
      padding: 12px 12px 14px;
    }

    .card-title {
      font-size: 0.92rem;
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card-subtitle {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 10px;
    }

    .section-row {
      margin-bottom: 12px;
    }

    label {
      font-size: 0.8rem;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 4px;
    }

    .field {
      margin-bottom: 8px;
    }

    input[type="number"],
    input[type="time"],
    select {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.96);
      color: var(--text-main);
      font-size: 0.85rem;
    }

    input[type="range"] {
      width: 100%;
    }

    .pill-group {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .pill-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.96);
      color: var(--text-soft);
      font-size: 0.8rem;
      padding: 4px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill-btn.active {
      background: var(--accent);
      color: #020617;
      border-color: var(--accent);
      font-weight: 600;
    }

    .info-icon-btn {
      border-radius: 50%;
      border: 1px solid var(--border-subtle);
      width: 18px;
      height: 18px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      background: rgba(15,23,42,0.9);
      color: var(--text-soft);
      cursor: pointer;
    }

    .info-text {
      font-size: 0.76rem;
      color: var(--text-soft);
      margin-top: 4px;
      display: none;
    }

    .info-text.visible {
      display: block;
    }

    /* Food list */
    .food-search-row {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }

    .food-search-row input {
      flex: 1;
    }

    .food-search-row button {
      white-space: nowrap;
    }

    .food-list {
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.75);
      max-height: 220px;
      overflow-y: auto;
      padding: 6px;
      font-size: 0.8rem;
    }

    .food-category {
      margin-bottom: 6px;
    }

    .food-category-title {
      font-size: 0.78rem;
      color: var(--text-soft);
      text-transform: uppercase;
      letter-spacing: 0.06em;
      margin: 4px 2px;
    }

    .food-row {
      display: flex;
      gap: 6px;
      align-items: center;
      padding: 4px 6px;
      border-radius: 8px;
      cursor: pointer;
    }

    .food-row:hover {
      background: rgba(15,118,255,0.14);
    }

    .food-row.active {
      background: var(--accent-soft);
      border: 1px solid var(--accent);
    }

    .food-emoji {
      width: 22px;
    }

    .food-main {
      flex: 1;
    }

    .food-name {
      font-size: 0.8rem;
    }

    .food-meta {
      font-size: 0.72rem;
      color: var(--text-soft);
    }

    .food-tag {
      font-size: 0.7rem;
      padding: 1px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
    }

    /* Right panel ‚Äì score and timeline */
    .score-main-number {
      font-size: 2.2rem;
      font-weight: 700;
    }

    .score-label-line {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .risk-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.78rem;
      border: 1px solid rgba(148,163,184,0.8);
    }

    .risk-low {
      background: rgba(34,197,94,0.18);
      border-color: rgba(34,197,94,0.8);
      color: #bbf7d0;
    }

    .risk-moderate {
      background: rgba(250,204,21,0.18);
      border-color: rgba(250,204,21,0.9);
      color: #fef9c3;
    }

    .risk-high {
      background: rgba(248,113,113,0.18);
      border-color: rgba(248,113,113,0.9);
      color: #fee2e2;
    }

    .gauge-bar {
      margin-top: 8px;
      margin-bottom: 4px;
      height: 16px;
      border-radius: 999px;
      position: relative;
      overflow: hidden;
      background: linear-gradient(90deg, #16a34a, #eab308, #f97316, #ef4444);
    }

    .gauge-marker {
      position: absolute;
      top: -4px;
      width: 2px;
      height: 24px;
      background: #fff;
      box-shadow: 0 0 6px rgba(255,255,255,0.9);
    }

    .gauge-marker::after {
      content: "";
      position: absolute;
      top: 18px;
      left: 50%;
      transform: translateX(-50%);
      border-width: 4px 4px 0 4px;
      border-style: solid;
      border-color: #fff transparent transparent transparent;
    }

    .gauge-scale {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      color: var(--text-soft);
      margin-bottom: 4px;
    }

    .breakdown-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    .breakdown-chip {
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.9);
    }

    .timeline-bar {
      margin-top: 6px;
      margin-bottom: 4px;
      border-radius: 999px;
      overflow: hidden;
      height: 14px;
      display: flex;
    }

    .timeline-seg {
      flex: 1;
      font-size: 0.7rem;
    }

    .timeline-spike {
      background: rgba(34,197,94,0.18);
    }

    .timeline-crash {
      background: rgba(250,204,21,0.2);
    }

    .timeline-recover {
      background: rgba(59,130,246,0.22);
    }

    .timeline-marker {
      position: relative;
      margin-top: 4px;
      height: 18px;
    }

    .timeline-marker-line {
      position: absolute;
      top: 0;
      width: 2px;
      height: 18px;
      background: #e5e7eb;
      box-shadow: 0 0 4px rgba(248,250,252,0.9);
    }

    .timeline-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.72rem;
      color: var(--text-soft);
    }

    .symptom-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
      margin-bottom: 6px;
    }

    .symptom-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.96);
      color: var(--text-soft);
      font-size: 0.78rem;
      padding: 4px 8px;
      cursor: pointer;
    }

    .symptom-btn:hover {
      filter: brightness(1.08);
    }

    .helper-text {
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    .share-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      align-items: center;
      font-size: 0.76rem;
      color: var(--text-soft);
    }

    .why-btn {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: rgba(15,23,42,0.96);
      color: var(--text-main);
      font-size: 0.8rem;
      padding: 5px 10px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .why-text {
      margin-top: 6px;
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    /* Responsive */
    @media (max-width: 840px) {
      .layout {
        grid-template-columns: 1fr;
      }
      .page {
        padding: 10px 10px 26px;
      }
      .score-main-number {
        font-size: 1.9rem;
      }
      .food-list {
        max-height: 260px;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <header>
    <div class="title-block">
      <h1>Post-Meal Anxiety Timing Calculator</h1>
      <div class="badge-row">
        <div class="badge">
          <span class="emoji">üß†</span>
          <span>Biology-based estimate; not mental weakness</span>
        </div>
        <span>Free forever ‚Ä¢ No login ‚Ä¢ No tracking</span>
      </div>
    </div>
    <div class="controls-row">
      <div class="toggle-pill">
        <span>Text size</span>
        <button id="textNormalBtn" class="active" type="button">Normal</button>
        <button id="textLargeBtn" type="button">Larger</button>
      </div>
      <div class="toggle-pill">
        <span>Contrast</span>
        <button id="contrastOffBtn" class="active" type="button">Standard</button>
        <button id="contrastOnBtn" type="button">Boosted</button>
      </div>
    </div>
  </header>

  <!-- Score strip (always visible at top) -->
  <div class="score-strip" id="scoreStrip">
    <div class="score-strip-main">
      <div class="score-strip-label">Current spike risk (0‚Äì100)</div>
      <div class="score-strip-value">
        <span class="number" id="stripScoreNumber">0</span>
        <span id="stripScoreLabel">Very low</span>
      </div>
    </div>
    <div class="score-strip-cta">
      <div class="score-strip-chip" id="stripWindowLabel">
        ‚è±Ô∏è Waiting for inputs‚Ä¶
      </div>
      <button class="small-btn" type="button" id="whyStripBtn">Why am I feeling this way?</button>
      <button class="small-btn primary" type="button" id="shareStripBtn">Share result</button>
    </div>
  </div>

  <div class="layout">
    <!-- LEFT SIDE: Inputs -->
    <div>
      <div class="card">
        <div class="card-title">Simple vs advanced</div>
        <div class="card-subtitle">Start simple with ‚Äúwhat did this meal look like‚Äù and rough sugar / caffeine, or switch to advanced to enter grams and mg.</div>
        <div class="pill-group" style="margin-bottom:8px;">
          <button class="pill-btn active" type="button" id="simpleModeBtn">Simple mode</button>
          <button class="pill-btn" type="button" id="advancedModeBtn">Advanced numbers</button>
        </div>
        <div class="field">
          <label for="timeSinceMealRange">
            Time since this meal (minutes)
            <button type="button" class="info-icon-btn" data-info-target="infoTime">
              i
            </button>
          </label>
          <input id="timeSinceMealRange" type="range" min="0" max="240" step="5" value="90">
          <div class="helper-text">
            <span id="timeSinceMealLabel">~90 minutes ago</span>
          </div>
          <div id="infoTime" class="info-text">
            Most people with sensitive guts and nerves feel a ‚Äúwave‚Äù between about 45 and 150 minutes after a carb / sugar / caffeine hit. This slider helps place you on that curve.
          </div>
        </div>
        <div class="field">
          <label for="sensitivitySelect">
            My sensitivity level
            <button type="button" class="info-icon-btn" data-info-target="infoSensitivity">i</button>
          </label>
          <select id="sensitivitySelect">
            <option value="0.8">Low sensitivity</option>
            <option value="1.0" selected>Medium</option>
            <option value="1.3">High (IBS / visceral hypersensitivity)</option>
          </select>
          <div id="infoSensitivity" class="info-text">
            Higher sensitivity amplifies the same carbs, sugar and caffeine into a bigger nerve reaction and crash. ‚ÄúHigh‚Äù matches people with IBS and visceral hypersensitivity more closely.
          </div>
        </div>
      </div>
            <!-- Simple mode panel -->
      <div id="simplePanel" class="card-soft" style="margin-top:10px;">
        <div class="card-title">Simple meal description</div>
        <div class="card-subtitle">
          Pick the closest match to what you just ate. You can fine-tune sugar and caffeine below.
        </div>

        <div class="section-row">
          <label>
            What did this meal look like?
          </label>
          <div class="food-search-row">
            <input id="foodSearch" type="text" placeholder="Search: pasta, pizza, sushi, salad‚Ä¶">
            <button type="button" class="small-btn" id="clearFoodBtn">Clear</button>
          </div>
          <div class="food-list" id="foodList">
            <!-- Food categories and items are inserted by JS -->
          </div>
        </div>

        <div class="section-row">
          <label>
            Dessert / extra sugar
            <button type="button" class="info-icon-btn" data-info-target="infoSugar">i</button>
          </label>
          <div class="pill-group" style="margin-bottom:4px;">
            <button type="button" class="pill-btn" data-sugar="0">No dessert</button>
            <button type="button" class="pill-btn" data-sugar="10">Small sweet (~10 g)</button>
            <button type="button" class="pill-btn" data-sugar="25">Big dessert (~25 g)</button>
          </div>
          <div class="field" style="margin-top:4px;">
            <label for="simpleSugarExact">Or enter rough sugar (grams)</label>
            <input id="simpleSugarExact" type="number" min="0" max="120" step="1" placeholder="e.g. 18">
          </div>
          <div id="infoSugar" class="info-text">
            Sugar spikes blood glucose quickly, then your system over-corrects. The ‚Äúcrash‚Äù can feel like sudden anxiety, internal buzzing, or fatigue.
          </div>
        </div>

        <div class="section-row">
          <label>
            Caffeine with or around this meal
            <button type="button" class="info-icon-btn" data-info-target="infoCaffeine">i</button>
          </label>
          <div class="pill-group" style="margin-bottom:4px;">
            <button type="button" class="pill-btn" data-caf="0">No caffeine</button>
            <button type="button" class="pill-btn" data-caf="80">Small coffee / strong tea</button>
            <button type="button" class="pill-btn" data-caf="140">Big coffee</button>
            <button type="button" class="pill-btn" data-caf="200">Energy drink</button>
          </div>
          <div class="field" style="margin-top:4px;">
            <label for="simpleCafExact">Or enter caffeine (mg)</label>
            <input id="simpleCafExact" type="number" min="0" max="400" step="10" placeholder="e.g. 120">
          </div>
          <div id="infoCaffeine" class="info-text">
            Caffeine spikes adrenaline. Combined with carbs and sugar, it can turn a normal crash into a jittery, chest-warm, ‚Äúwired and tired‚Äù wave.
          </div>
        </div>
      </div>

      <!-- Advanced mode panel -->
      <div id="advancedPanel" class="card-soft" style="margin-top:10px; display:none;">
        <div class="card-title">Advanced meal details</div>
        <div class="card-subtitle">
          If you like numbers, enter your own estimates. These override simple mode values.
        </div>
        <div class="section-row">
          <div class="field">
            <label for="advCarbs">
              Carbs in this meal (g)
            </label>
            <input id="advCarbs" type="number" min="0" max="200" step="5" placeholder="e.g. 80 for a plate of pasta">
          </div>
          <div class="field">
            <label for="advSugar">Added / free sugar (g)</label>
            <input id="advSugar" type="number" min="0" max="150" step="1" placeholder="e.g. 25 for dessert">
          </div>
          <div class="field">
            <label for="advCaffeine">Caffeine (mg)</label>
            <input id="advCaffeine" type="number" min="0" max="400" step="10" placeholder="e.g. 140 for a big coffee">
          </div>
        </div>
        <div class="section-row">
          <div class="field">
            <label for="advFiber">Fiber in this meal (g)</label>
            <input id="advFiber" type="number" min="0" max="40" step="1" placeholder="e.g. 6">
          </div>
          <div class="field">
            <label for="advFat">
              Fat level
              <button type="button" class="info-icon-btn" data-info-target="infoFat">i</button>
            </label>
            <select id="advFat">
              <option value="0">Low (grilled, minimal oil)</option>
              <option value="1">Medium (some oil / cheese / dressing)</option>
              <option value="2">High (heavy cream, deep fried, fast food)</option>
            </select>
            <div id="infoFat" class="info-text">
              Fat slows stomach emptying. That can delay the crash, sometimes turning it into a late-evening or next-morning wave instead of an immediate one.
            </div>
          </div>
        </div>
      </div>
    </div>
        <!-- RIGHT SIDE: Score, timeline, explanations -->
    <div>
      <div class="card">
        <div class="card-title">Your current spike estimate</div>
        <div class="card-subtitle">
          This is a biology-based guess at how much today‚Äôs carbs, sugar and caffeine are pushing your nervous system right now.
        </div>
        <div style="display:flex; justify-content:space-between; align-items:flex-end; gap:8px;">
          <div>
            <div class="score-main-number" id="scoreMainNumber">0</div>
            <div class="score-label-line">
              <span id="scoreMainLabel">Very low</span>
            </div>
          </div>
          <div class="risk-chip" id="riskChip">Waiting for inputs‚Ä¶</div>
        </div>

        <div class="gauge-bar">
          <div class="gauge-marker" id="gaugeMarker" style="left:0%;"></div>
        </div>
        <div class="gauge-scale">
          <span>0</span>
          <span>25</span>
          <span>50</span>
          <span>75</span>
          <span>100</span>
        </div>

        <div class="breakdown-row" id="breakdownRow">
          <span class="breakdown-chip">Carbs: 0%</span>
          <span class="breakdown-chip">Sugar: 0%</span>
          <span class="breakdown-chip">Caffeine: 0%</span>
          <span class="breakdown-chip">Timing / sensitivity: 0%</span>
        </div>

        <div class="section-row" style="margin-top:10px;">
          <label>
            Crash window map
            <button type="button" class="info-icon-btn" data-info-target="infoTimeline">i</button>
          </label>
          <div class="timeline-bar">
            <div class="timeline-seg timeline-spike"></div>
            <div class="timeline-seg timeline-crash"></div>
            <div class="timeline-seg timeline-recover"></div>
          </div>
          <div class="timeline-marker">
            <div class="timeline-marker-line" id="timelineMarkerLine" style="left:0%;"></div>
          </div>
          <div class="timeline-labels">
            <span>Early / digestion</span>
            <span>Crash / anxiety window</span>
            <span>Recovery</span>
          </div>
          <div id="infoTimeline" class="info-text">
            Most symptoms are not random. Heavy carbs + sugar + caffeine usually create a spike, then a crash. This bar shows roughly where you are in that cycle.
          </div>
        </div>

        <div class="section-row">
          <label>Right now I feel‚Ä¶</label>
          <div class="symptom-buttons">
            <button type="button" class="symptom-btn" data-symptom="jittery">Jittery / buzzy</button>
            <button type="button" class="symptom-btn" data-symptom="warmChest">Warm chest / wired</button>
            <button type="button" class="symptom-btn" data-symptom="flat">Flat / wiped out</button>
            <button type="button" class="symptom-btn" data-symptom="gutBuzz">Gut buzzing</button>
            <button type="button" class="symptom-btn" data-symptom="headache">Headache-ish</button>
            <button type="button" class="symptom-btn" data-symptom="randomAdrenaline">Random adrenaline hits</button>
          </div>
          <div id="symptomText" class="helper-text">
            Tap one that fits and we‚Äôll tell you whether it matches the predicted crash window.
          </div>
        </div>

        <div class="share-row">
          <button type="button" class="small-btn primary" id="shareBtn">Copy a short summary</button>
          <span id="shareStatus">No text copied yet.</span>
        </div>
      </div>

      <div class="card-soft" style="margin-top:10px;">
        <div class="card-title">
          Why does this feel like ‚Äúanxiety‚Äù?
        </div>
        <button type="button" class="why-btn" id="whyBtn">
          Why am I feeling this way?
        </button>
        <div id="whyText" class="why-text" style="display:none;">
          Your brain often labels biology as ‚Äúanxiety‚Äù. A heavy carb + sugar + caffeine load can:
          <ul style="padding-left:18px; margin:4px 0;">
            <li>Stretch your gut and trigger visceral nerves</li>
            <li>Spike blood sugar and then over-correct into a crash</li>
            <li>Layer caffeine-driven adrenaline on top of that crash</li>
          </ul>
          If you are highly sensitive, that internal noise can feel identical to ‚ÄúI am freaking out‚Äù, even when nothing external is wrong. This tool is here to show that a lot of it is timing and chemistry, not personal failure.
        </div>
      </div>
    </div>
  </div> <!-- end layout -->

</div> <!-- end page -->
  <script>
  // ---------------------------
  // Food presets (grouped)
  // ---------------------------
  const mealCategories = [
    {
      name: "Pasta / rice / bowls",
      id: "pastaRice",
      items: [
        { id: "pasta", emoji: "üçù", name: "Plate of pasta", carbs: 80, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
        { id: "riceBowl", emoji: "üçö", name: "Rice bowl", carbs: 70, fiber: 2, fatLevel: 0, sugarBase: 2, tag: "High carb" },
        { id: "ramen", emoji: "üçú", name: "Ramen or noodle bowl", carbs: 65, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
        { id: "chipotleBowl", emoji: "ü•ó", name: "Burrito bowl", carbs: 65, fiber: 7, fatLevel: 2, sugarBase: 3, tag: "High carb, higher fiber" }
      ]
    },
    {
      name: "Pizza / fast food",
      id: "pizzaFast",
      items: [
        { id: "pizza2", emoji: "üçï", name: "Pizza, 2 slices", carbs: 60, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "High carb and fat" },
        { id: "pizza3", emoji: "üçï", name: "Pizza, 3 slices", carbs: 90, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "Very high carb" },
        { id: "burgerFries", emoji: "üçî", name: "Burger with fries", carbs: 70, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "Heavy" },
        { id: "burgerOnly", emoji: "üçî", name: "Burger, no fries", carbs: 45, fiber: 2, fatLevel: 2, sugarBase: 2, tag: "Medium carb" }
      ]
    },
    {
      name: "Lighter plates",
      id: "lightPlates",
      items: [
        { id: "saladLowCarb", emoji: "ü•ó", name: "Green salad, low carb", carbs: 18, fiber: 6, fatLevel: 1, sugarBase: 1, tag: "Light" },
        { id: "chickenVeg", emoji: "üçó", name: "Grilled chicken with vegetables", carbs: 20, fiber: 4, fatLevel: 1, sugarBase: 1, tag: "Lower carb" },
        { id: "salmonVeg", emoji: "üêü", name: "Salmon with vegetables", carbs: 15, fiber: 4, fatLevel: 2, sugarBase: 1, tag: "Lower carb" }
      ]
    },
    {
      name: "Desserts",
      id: "desserts",
      items: [
        { id: "iceCream", emoji: "üç®", name: "Ice cream bowl", carbs: 45, fiber: 1, fatLevel: 2, sugarBase: 28, tag: "High sugar" },
        { id: "cakeSlice", emoji: "üç∞", name: "Slice of cake", carbs: 45, fiber: 1, fatLevel: 2, sugarBase: 28, tag: "High sugar" },
        { id: "cookie2", emoji: "üç™", name: "Cookies, a couple", carbs: 30, fiber: 1, fatLevel: 2, sugarBase: 18, tag: "High sugar" }
      ]
    }
  ];

  let selectedMealId = null;
  let simpleSugarExtra = 0;
  let simpleCaffeine = 0;

  const elements = {
    simpleModeBtn: document.getElementById("simpleModeBtn"),
    advancedModeBtn: document.getElementById("advancedModeBtn"),
    simplePanel: document.getElementById("simplePanel"),
    advancedPanel: document.getElementById("advancedPanel"),
    timeRange: document.getElementById("timeSinceMealRange"),
    timeLabel: document.getElementById("timeSinceMealLabel"),
    sensitivitySelect: document.getElementById("sensitivitySelect"),
    foodList: document.getElementById("foodList"),
    foodSearch: document.getElementById("foodSearch"),
    clearFoodBtn: document.getElementById("clearFoodBtn"),
    simpleSugarExact: document.getElementById("simpleSugarExact"),
    simpleCafExact: document.getElementById("simpleCafExact"),
    scoreMainNumber: document.getElementById("scoreMainNumber"),
    scoreMainLabel: document.getElementById("scoreMainLabel"),
    riskChip: document.getElementById("riskChip"),
    gaugeMarker: document.getElementById("gaugeMarker"),
    breakdownRow: document.getElementById("breakdownRow"),
    timelineMarkerLine: document.getElementById("timelineMarkerLine"),
    symptomText: document.getElementById("symptomText"),
    stripScoreNumber: document.getElementById("stripScoreNumber"),
    stripScoreLabel: document.getElementById("stripScoreLabel"),
    stripWindowLabel: document.getElementById("stripWindowLabel"),
    shareBtn: document.getElementById("shareBtn"),
    shareStripBtn: document.getElementById("shareStripBtn"),
    shareStatus: document.getElementById("shareStatus"),
    whyBtn: document.getElementById("whyBtn"),
    whyText: document.getElementById("whyText"),
    whyStripBtn: document.getElementById("whyStripBtn"),
    textNormalBtn: document.getElementById("textNormalBtn"),
    textLargeBtn: document.getElementById("textLargeBtn"),
    contrastOffBtn: document.getElementById("contrastOffBtn"),
    contrastOnBtn: document.getElementById("contrastOnBtn")
  };

  // ---------------------------
  // UI helpers
  // ---------------------------
  function minutesLabel(val) {
    const v = Number(val);
    if (v === 0) return "Just now";
    if (v <= 30) return "~" + v + " minutes ago";
    const hours = Math.round(v / 60 * 10) / 10;
    if (hours < 1) return "~" + v + " minutes ago";
    return "~" + hours + " hours ago";
  }

  function renderFoods(filterText = "") {
    const root = elements.foodList;
    root.innerHTML = "";
    const term = filterText.trim().toLowerCase();

    mealCategories.forEach(cat => {
      const filteredItems = cat.items.filter(item => {
        if (!term) return true;
        const hay = (item.name + " " + (item.tag || "")).toLowerCase();
        return hay.includes(term);
      });

      if (filteredItems.length === 0) return;

      const catDiv = document.createElement("div");
      catDiv.className = "food-category";

      const title = document.createElement("div");
      title.className = "food-category-title";
      title.textContent = cat.name;
      catDiv.appendChild(title);

      filteredItems.forEach(item => {
        const row = document.createElement("div");
        row.className = "food-row";
        row.dataset.mealId = item.id;

        const emojiSpan = document.createElement("div");
        emojiSpan.className = "food-emoji";
        emojiSpan.textContent = item.emoji;
        row.appendChild(emojiSpan);

        const mainDiv = document.createElement("div");
        mainDiv.className = "food-main";

        const nameDiv = document.createElement("div");
        nameDiv.className = "food-name";
        nameDiv.textContent = item.name;
        mainDiv.appendChild(nameDiv);

        const metaDiv = document.createElement("div");
        metaDiv.className = "food-meta";
        metaDiv.textContent = `${item.carbs} g carbs ‚Ä¢ ${item.tag}`;
        mainDiv.appendChild(metaDiv);

        row.appendChild(mainDiv);

        const tagSpan = document.createElement("span");
        tagSpan.className = "food-tag";
        tagSpan.textContent = item.tag;
        row.appendChild(tagSpan);

        row.addEventListener("click", () => {
          selectedMealId = item.id;
          // clear active first
          document.querySelectorAll(".food-row").forEach(r => r.classList.remove("active"));
          row.classList.add("active");
          updateScore();
        });

        catDiv.appendChild(row);
      });

      root.appendChild(catDiv);
    });
  }

  function getSelectedMeal() {
    for (const cat of mealCategories) {
      for (const item of cat.items) {
        if (item.id === selectedMealId) return item;
      }
    }
    return null;
  }

  // ---------------------------
  // Core math model
  // ---------------------------
  function computeRisk() {
    const timeMin = Number(elements.timeRange.value);
    const sensitivity = Number(elements.sensitivitySelect.value);

    const useAdvanced = elements.advancedPanel.style.display !== "none";

    let carbs = 0;
    let sugar = 0;
    let caffeine = 0;
    let fiber = 0;
    let fatLevel = 0;

    if (useAdvanced) {
      carbs = Number(document.getElementById("advCarbs").value || 0);
      sugar = Number(document.getElementById("advSugar").value || 0);
      caffeine = Number(document.getElementById("advCaffeine").value || 0);
      fiber = Number(document.getElementById("advFiber").value || 0);
      fatLevel = Number(document.getElementById("advFat").value || 0);
    } else {
      const meal = getSelectedMeal();
      if (meal) {
        carbs = meal.carbs;
        fiber = meal.fiber || 0;
        fatLevel = meal.fatLevel || 0;
        sugar = (meal.sugarBase || 0);
      }
      const extraSugar = elements.simpleSugarExact.value !== "" ? Number(elements.simpleSugarExact.value) : simpleSugarExtra;
      if (!isNaN(extraSugar)) sugar += extraSugar;

      const extraCaf = elements.simpleCafExact.value !== "" ? Number(elements.simpleCafExact.value) : simpleCaffeine;
      caffeine = isNaN(extraCaf) ? 0 : extraCaf;
    }

    // Clamp basics
    carbs = Math.max(0, Math.min(carbs, 200));
    sugar = Math.max(0, Math.min(sugar, 200));
    caffeine = Math.max(0, Math.min(caffeine, 500));

    // Base points (before timing and sensitivity)
    const carbPoints = Math.min(40, carbs * 0.5);          // 80 g ~ 40
    const sugarPoints = Math.min(40, sugar * 0.7);         // ~57 g caps at 40
    const caffeinePoints = Math.min(20, caffeine * 0.07);  // 285 mg ~ 20

    // Timing curve: peak around 90 minutes, fades after ~3 hours
    const t = Math.max(0, Math.min(timeMin, 240));
    const center = 90;
    const spread = 70; // controls width of peak
    const timingFactor = Math.exp(-Math.pow(t - center, 2) / (2 * spread * spread));
    // map timing factor to something like 0.2‚Äì1.1 (never truly zero)
    const timingMultiplier = 0.2 + timingFactor * 0.9;

    // Fiber softens sugar/carbs impact slightly
    const fiberEffect = 1 - Math.min(0.25, fiber * 0.02); // up to 25% reduction
    // Fat delays a bit: we will shift effective time by adding minutes
    const fatDelayMinutes = fatLevel * 20;
    const effectiveTime = Math.max(0, Math.min(timeMin + fatDelayMinutes, 240));
    const t2 = effectiveTime;
    const timingFactor2 = Math.exp(-Math.pow(t2 - center, 2) / (2 * spread * spread));
    const timingMultiplierDelayed = 0.2 + timingFactor2 * 0.9;

    // Combine:
    const baseSum = carbPoints + sugarPoints + caffeinePoints;
    let rawScore = baseSum * timingMultiplierDelayed * sensitivity * fiberEffect;

    // Clip 0‚Äì100
    rawScore = Math.max(0, Math.min(100, rawScore));

    // Contribution percentages
    const contributions = { carbs: 0, sugar: 0, caffeine: 0, timing: 0 };
    const baseTotal = carbPoints + sugarPoints + caffeinePoints;
    if (baseTotal > 0) {
      contributions.carbs = (carbPoints / baseTotal) * 100;
      contributions.sugar = (sugarPoints / baseTotal) * 100;
      contributions.caffeine = (caffeinePoints / baseTotal) * 100;
    }
    // timing / sensitivity lumped as "timing/sensitivity"
    contributions.timing = 100 - (contributions.carbs + contributions.sugar + contributions.caffeine);

    return {
      score: rawScore,
      carbs,
      sugar,
      caffeine,
      timeMin,
      effectiveTime,
      contributions
    };
  }

  function riskLabel(score) {
    if (score < 20) return "Very low";
    if (score < 40) return "Low";
    if (score < 60) return "Moderate";
    if (score < 80) return "High";
    return "Very high";
  }

  function riskChipClass(score) {
    if (score < 40) return "risk-chip risk-low";
    if (score < 75) return "risk-chip risk-moderate";
    return "risk-chip risk-high";
  }

  function windowLabel(timeMin, effectiveTime) {
    if (timeMin === 0) return "‚è±Ô∏è Just ate this meal";
    const t = effectiveTime;
    if (t < 40) return "‚è±Ô∏è Early digestion, spike building";
    if (t <= 140) return "‚ö° Crash / anxiety window is active";
    if (t <= 200) return "üå´Ô∏è Late crash / slump window";
    return "üåô Probably in recovery phase now";
  }

  function updateScore() {
    const result = computeRisk();
    const s = Math.round(result.score);

    // Main + strip
    elements.scoreMainNumber.textContent = s;
    const label = riskLabel(s);
    elements.scoreMainLabel.textContent = label;
    elements.stripScoreNumber.textContent = s;
    elements.stripScoreLabel.textContent = label;

    // Gauge marker (0‚Äì100)
    const markerPos = Math.max(0, Math.min(100, s));
    elements.gaugeMarker.style.left = markerPos + "%";

    // Risk chip
    elements.riskChip.className = riskChipClass(s);
    if (s === 0) {
      elements.riskChip.textContent = "Waiting for meal + sugar / caffeine";
    } else {
      elements.riskChip.textContent = label + " spike right now";
    }

    // Strip window label
    elements.stripWindowLabel.textContent = windowLabel(result.timeMin, result.effectiveTime);

    // Breakdown
    const c = result.contributions;
    elements.breakdownRow.innerHTML = "";
    const chips = [
      { label: "Carbs", val: c.carbs },
      { label: "Sugar", val: c.sugar },
      { label: "Caffeine", val: c.caffeine },
      { label: "Timing / sensitivity", val: c.timing }
    ];
    chips.forEach(ch => {
      const span = document.createElement("span");
      span.className = "breakdown-chip";
      span.textContent = `${ch.label}: ${Math.round(ch.val)}%`;
      elements.breakdownRow.appendChild(span);
    });

    // Time labels
    elements.timeLabel.textContent = minutesLabel(result.timeMin);

    // Timeline marker: map 0‚Äì240 min to 0‚Äì100%
    const tPercent = (Math.max(0, Math.min(result.effectiveTime, 240)) / 240) * 100;
    elements.timelineMarkerLine.style.left = tPercent + "%";

    // Reset symptom text hint
    elements.symptomText.textContent = "Tap one that fits and we‚Äôll tell you whether it matches the predicted crash window.";
  }

  // Symptom analysis
  function analyzeSymptom(symptom) {
    const result = computeRisk();
    const s = Math.round(result.score);
    const t = result.effectiveTime;
    let text = "";

    const inCrashWindow = t >= 40 && t <= 150;
    const lateCrash = t > 150 && t <= 210;

    if (symptom === "jittery" || symptom === "warmChest" || symptom === "randomAdrenaline") {
      if (inCrashWindow && s >= 40) {
        text = "That wired, buzzy feeling lines up with your predicted crash window. Your biology is loud right now; it does not mean anything is wrong with your character.";
      } else if (lateCrash) {
        text = "This could be a late wave from the same meal, but you are slightly past the main crash window. Still very likely biology, especially with carbs + sugar + caffeine in the mix.";
      } else {
        text = "This does not perfectly line up with the strongest crash window, but your nervous system may still be echoing earlier spikes, especially if today was a heavy carb / sugar day.";
      }
    } else if (symptom === "flat") {
      if (lateCrash || (inCrashWindow && s >= 30)) {
        text = "Feeling flat, blank or tired fits a post-spike slump. Your system may be in the ‚Äòcoming down‚Äô part of the wave after the earlier peak.";
      } else {
        text = "This might be more of a general fatigue rather than a sharp post-meal crash, but today‚Äôs load can still be keeping you lower than your baseline.";
      }
    } else if (symptom === "gutBuzz") {
      if (inCrashWindow) {
        text = "Gut buzzing during the crash window is classic visceral sensitivity. Your gut nerves are amplifying normal digestion into loud body noise.";
      } else {
        text = "You are outside the main crash window, but with visceral sensitivity, gut noise can linger. It still points more to biology than to ‚Äòrandom‚Äô anxiety.";
      }
    } else if (symptom === "headache") {
      if (lateCrash || inCrashWindow) {
        text = "Headaches can trade places with gut symptoms. This timing fits with blood sugar swings + tension. It is likely part of the same body-driven pattern.";
      } else {
        text = "This may be more of a general tension or dehydration headache. Today‚Äôs carbs and sugar can still make it easier to tip into discomfort.";
      }
    }

    if (!text) {
      text = "This tool cannot perfectly label every sensation, but based on your timing and score, biology is playing a big role here.";
    }

    elements.symptomText.textContent = text;
  }

  // Share text
  function buildShareText() {
    const r = computeRisk();
    const s = Math.round(r.score);
    const label = riskLabel(s);
    const sensitivityLabel = {
      "0.8": "low",
      "1": "medium",
      "1.3": "high"
    }[elements.sensitivitySelect.value] || "medium";

    const meal = getSelectedMeal();
    const mealName = meal ? meal.name : "Meal not specified";
    const parts = [];
    parts.push(`Post-meal anxiety spike estimate: ${s}/100 (${label}).`);
    parts.push(`Meal: ${mealName}. Approx carbs: ~${Math.round(r.carbs)} g, sugar: ~${Math.round(r.sugar)} g, caffeine: ~${Math.round(r.caffeine)} mg.`);
    parts.push(`Time since meal: ${minutesLabel(r.timeMin)}. Sensitivity level: ${sensitivityLabel}.`);
    parts.push(`Tool: darkstar747.github.io (free, no login, biology-based timing calculator).`);
    return parts.join(" ");
  }

  async function copyShareText() {
    const text = buildShareText();
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(text);
        elements.shareStatus.textContent = "Copied! You can paste this into Reddit, a note, or a chat.";
      } else {
        // Fallback
        elements.shareStatus.textContent = "Copy failed: clipboard unavailable in this browser.";
        alert(text);
      }
    } catch (err) {
      elements.shareStatus.textContent = "Copy failed. Your browser may be blocking clipboard access.";
    }
  }

  // ---------------------------
  // Event wiring
  // ---------------------------
  function initEvents() {
    // Simple vs advanced mode
    elements.simpleModeBtn.addEventListener("click", () => {
      elements.simpleModeBtn.classList.add("active");
      elements.advancedModeBtn.classList.remove("active");
      elements.simplePanel.style.display = "";
      elements.advancedPanel.style.display = "none";
      updateScore();
    });

    elements.advancedModeBtn.addEventListener("click", () => {
      elements.advancedModeBtn.classList.add("active");
      elements.simpleModeBtn.classList.remove("active");
      elements.simplePanel.style.display = "none";
      elements.advancedPanel.style.display = "";
      updateScore();
    });

    // Time since meal
    elements.timeRange.addEventListener("input", () => {
      elements.timeLabel.textContent = minutesLabel(elements.timeRange.value);
      updateScore();
    });

    // Sensitivity
    elements.sensitivitySelect.addEventListener("change", updateScore);

    // Food search
    elements.foodSearch.addEventListener("input", (e) => {
      renderFoods(e.target.value);
    });

    elements.clearFoodBtn.addEventListener("click", () => {
      elements.foodSearch.value = "";
      selectedMealId = null;
      renderFoods("");
      updateScore();
    });

    // Sugar quick buttons
    document.querySelectorAll('[data-sugar]').forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll('[data-sugar]').forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        simpleSugarExtra = Number(btn.dataset.sugar || 0);
        elements.simpleSugarExact.value = "";
        updateScore();
      });
    });

    // Sugar exact input
    elements.simpleSugarExact.addEventListener("input", () => {
      document.querySelectorAll('[data-sugar]').forEach(b => b.classList.remove("active"));
      updateScore();
    });

    // Caffeine quick buttons
    document.querySelectorAll('[data-caf]').forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll('[data-caf]').forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        simpleCaffeine = Number(btn.dataset.caf || 0);
        elements.simpleCafExact.value = "";
        updateScore();
      });
    });

    // Caffeine exact input
    elements.simpleCafExact.addEventListener("input", () => {
      document.querySelectorAll('[data-caf]').forEach(b => b.classList.remove("active"));
      updateScore();
    });

    // Advanced inputs
    ["advCarbs", "advSugar", "advCaffeine", "advFiber", "advFat"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.addEventListener("input", updateScore);
      if (el && el.tagName === "SELECT") el.addEventListener("change", updateScore);
    });

    // Info icons
    document.querySelectorAll(".info-icon-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const targetId = btn.getAttribute("data-info-target");
        if (!targetId) return;
        const info = document.getElementById(targetId);
        if (!info) return;
        info.classList.toggle("visible");
      });
    });

    // Symptom buttons
    document.querySelectorAll(".symptom-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const s = btn.getAttribute("data-symptom");
        analyzeSymptom(s);
      });
    });

    // Share
    elements.shareBtn.addEventListener("click", copyShareText);
    elements.shareStripBtn.addEventListener("click", copyShareText);

    // Why blocks
    function toggleWhy() {
      const visible = elements.whyText.style.display === "block";
      elements.whyText.style.display = visible ? "none" : "block";
    }
    elements.whyBtn.addEventListener("click", toggleWhy);
    elements.whyStripBtn.addEventListener("click", toggleWhy);

    // Text size
    elements.textNormalBtn.addEventListener("click", () => {
      document.body.classList.remove("large-text");
      elements.textNormalBtn.classList.add("active");
      elements.textLargeBtn.classList.remove("active");
    });
    elements.textLargeBtn.addEventListener("click", () => {
      document.body.classList.add("large-text");
      elements.textLargeBtn.classList.add("active");
      elements.textNormalBtn.classList.remove("active");
    });

    // Contrast
    elements.contrastOffBtn.addEventListener("click", () => {
      document.body.classList.remove("high-contrast");
      elements.contrastOffBtn.classList.add("active");
      elements.contrastOnBtn.classList.remove("active");
    });
    elements.contrastOnBtn.addEventListener("click", () => {
      document.body.classList.add("high-contrast");
      elements.contrastOnBtn.classList.add("active");
      elements.contrastOffBtn.classList.remove("active");
    });
  }

  // Init
  renderFoods("");
  initEvents();
  updateScore();
</script>
</body>
</html>
