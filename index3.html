<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Carb / Sugar Anxiety Timing Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg-main: #020617;
      --bg-card: #020b1f;
      --bg-card-soft: #020b1f;
      --border-subtle: rgba(148, 163, 184, 0.4);
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --pill-bg: #020617;
      --pill-border: rgba(148, 163, 184, 0.7);
      --pill-active-bg: #0f172a;
      --pill-active-border: #22c55e;
      --pill-active-text: #e5e7eb;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, -system-ui,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #020617 0, #000 55%, #020617 100%);
      color: var(--text-main);
    }

    .page-wrap {
      max-width: 1220px;
      margin: 0 auto;
      padding: 18px 12px 32px;
    }

    .app-title {
      font-size: 22px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .app-subtitle {
      font-size: 13px;
      color: var(--text-soft);
      max-width: 720px;
      line-height: 1.4;
      margin-bottom: 16px;
    }

    .app-grid {
      margin-top: 12px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
      gap: 10px;
      align-items: flex-start;
    }

    @media (max-width: 960px) {
      .app-grid {
        grid-template-columns: minmax(0, 1fr);
      }
      #right-column {
        position: static;
      }
    }

    #right-column {
      position: sticky;
      top: 8px;
      align-self: flex-start;
      height: fit-content;
    }

    .card,
    .score-card,
    .crash-window {
      background: radial-gradient(circle at top left, #0b1120 0, #020617 52%, #000 100%);
      border-radius: 18px;
      padding: 12px 12px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 18px 38px rgba(0, 0, 0, 0.75);
    }

    .card-tight {
      padding-top: 8px;
      padding-bottom: 10px;
    }

    .card-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      margin-bottom: 4px;
    }

    .card-subtitle {
      font-size: 12px;
      color: var(--text-soft);
      margin: 0 0 8px;
    }

    .input-label {
      display: block;
      font-size: 12px;
      margin: 6px 0 2px;
    }

    input[type="time"],
    input[type="number"],
    .search-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text-main);
      padding: 7px 11px;
      font-size: 13px;
      outline: none;
    }

    input[type="time"]:focus,
    input[type="number"]:focus,
    .search-input:focus {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
    }

    input[type="range"] {
      width: 100%;
    }

    .search-row {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-bottom: 4px;
    }

    .clear-btn {
      border-radius: 999px;
      padding: 7px 14px;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text-main);
      font-size: 12px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .clear-btn:hover {
      border-color: #e5e7eb;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .pill {
      border-radius: 999px;
      padding: 6px 11px;
      font-size: 12px;
      border: 1px solid var(--pill-border);
      background: var(--pill-bg);
      color: var(--text-main);
      cursor: pointer;
      white-space: nowrap;
    }

    .pill.active {
      background: var(--pill-active-bg);
      border-color: var(--pill-active-border);
      color: var(--pill-active-text);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
    }

    .food-grid {
      margin-top: 6px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(190px, 1fr));
      gap: 6px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .food-card {
      width: 100%;
      border-radius: 14px;
      padding: 7px 9px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      text-align: left;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .food-card-header {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      font-size: 12px;
    }

    .food-card-emoji {
      font-size: 16px;
    }

    .food-card-meta {
      font-size: 11px;
      color: var(--text-soft);
    }

    .food-tag {
      display: inline-block;
      margin-top: 2px;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 118, 110, 0.3);
      border: 1px solid rgba(45, 212, 191, 0.7);
      color: #a5f3fc;
    }

    .food-card.selected {
      border-color: #22c55e;
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.35);
      background: radial-gradient(circle at top left, #064e3b 0, #020617 50%);
    }

    /* SCORE CARD / RISK GAUGE */
    .score-card {
      margin-bottom: 10px;
    }

    .risk-title {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      margin-bottom: 4px;
    }

    .risk-score {
      font-size: 36px;
      font-weight: 600;
      margin-top: 0;
      margin-bottom: 4px;
    }

    .risk-label {
      font-size: 12px;
      color: var(--text-soft);
      margin-bottom: 8px;
    }

    .risk-bar-container {
      position: relative;
      margin-top: 3px;
      padding-top: 4px;
    }

    .risk-bar-track {
      height: 11px;
      width: 100%;
      border-radius: 999px;
      background: linear-gradient(
        90deg,
        #16a34a 0,
        #eab308 50%,
        #f97316 75%,
        #dc2626 100%
      );
      opacity: 0.95;
    }

    .risk-bar-fill {
      position: absolute;
      left: 0;
      top: 4px;
      height: 11px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.2);
      pointer-events: none;
      width: 0%;
    }

    #markerLane {
      position: relative;
      margin-top: 4px;
      height: 14px;
    }

    #youAreHereMarker {
      position: absolute;
      top: 0;
      left: 0;
      transform: translateX(-50%);
      padding: 1px 7px;
      font-size: 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.8);
      white-space: nowrap;
    }

    /* TIMELINE */
    .timeline-card {
      margin-top: 10px;
    }

    .timeline-bar-shell {
      margin-top: 6px;
      position: relative;
    }

    .timeline-bar {
      height: 14px;
      width: 100%;
      border-radius: 999px;
      overflow: hidden;
      display: flex;
    }

    .timeline-seg-spike {
      flex: 0 0 37.5%;
      background: #eab308;
    }

    .timeline-seg-crash {
      flex: 0 0 25%;
      background: #f97316;
    }

    .timeline-seg-recov {
      flex: 1;
      background: #38bdf8;
    }

    .timeline-marker-line {
      position: absolute;
      top: -2px;
      width: 2px;
      height: 18px;
      background: #f9fafb;
      border-radius: 999px;
      pointer-events: none;
    }

    .timeline-marker-label {
      position: absolute;
      top: 18px;
      transform: translateX(-50%);
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid rgba(148, 163, 184, 0.8);
      white-space: nowrap;
    }

    .timeline-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 18px;
      font-size: 11px;
      color: var(--text-soft);
    }

    .legend-dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 999px;
      margin-right: 4px;
    }

    .legend-spike {
      background: #eab308;
    }

    .legend-crash {
      background: #f97316;
    }

    .legend-recov {
      background: #38bdf8;
    }

    .timeline-columns {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 10px;
    }

    @media (max-width: 640px) {
      .timeline-columns {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .timeline-heading {
      font-size: 12px;
      font-weight: 600;
    }

    .timeline-time {
      font-size: 12px;
      color: var(--text-soft);
      margin-top: 1px;
    }

    .crash-window {
      margin-top: 10px;
    }

    footer {
      margin-top: 16px;
      font-size: 11px;
      color: var(--text-soft);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <h1 class="app-title">CARB / SUGAR ANXIETY TIMING EXPLORER</h1>
    <p class="app-subtitle">
      Rough, biology-informed pattern explorer for people who notice waves of anxiety
      1â€“4 hours after carbs, sugar and caffeine. Not medical advice.
    </p>

    <div class="app-grid">
      <!-- LEFT COLUMN -->
      <div id="left-column">
        <!-- TIMING -->
        <div class="card">
          <div class="card-title">Timing</div>
          <p class="card-subtitle">
            The model assumes a ~4 hour (240 min) wave: spike â†’ crash â†’ recovery.
          </p>

          <label class="input-label">What time did you finish this meal?</label>
          <input id="mealTimeInput" type="time" />

          <label class="input-label" style="margin-top:12px;">
            Roughly how long has it been since you finished eating?
          </label>
          <input
            id="minutesSinceMealRange"
            type="range"
            min="0"
            max="240"
            value="0"
          />
          <div
            id="minutesSinceLabel"
            style="font-size:12px; color:var(--text-soft); margin-top:2px;"
          >
            0 minutes since meal.
          </div>
        </div>

        <!-- SIMPLE MEAL -->
        <div class="card">
          <div class="card-title">Simple: what did this meal look like?</div>
          <p class="card-subtitle">
            Start with a rough match. You can refine later with sugar and caffeine.
          </p>

          <div class="search-row">
            <input
              id="mealSearch"
              class="search-input"
              placeholder="Search: pasta, pizza, salad, rice bowl, burgerâ€¦"
            />
            <button id="clearSearch" class="clear-btn">Clear</button>
          </div>

          <div
            id="selectedMeal"
            style="font-size:12px; color:var(--text-soft); margin-bottom:6px;"
          >
            No meal selected yet.
          </div>

          <div id="foodGrid" class="food-grid"></div>
        </div>

        <!-- DESSERT / DRINKS -->
        <div class="card">
          <div class="card-title">Dessert and drinks</div>

          <label class="input-label">Did you add dessert?</label>
          <div class="pill-row">
            <button class="pill dessertBtn" data-dessert="0">No dessert</button>
            <button class="pill dessertBtn" data-dessert="10">Small (~10 g sugar)</button>
            <button class="pill dessertBtn" data-dessert="20">Medium (~20 g)</button>
            <button class="pill dessertBtn" data-dessert="35">Big (~35 g)</button>
          </div>

          <label class="input-label" style="margin-top:10px;">
            Sugary drink with this meal?
          </label>
          <div class="pill-row">
            <button class="pill sodaBtn" data-soda="0">No sugary drink</button>
            <button class="pill sodaBtn" data-soda="25">One soda</button>
            <button class="pill sodaBtn" data-soda="45">Large soda</button>
            <button class="pill sodaBtn" data-soda="60">Big or multiple drinks</button>
          </div>

          <label class="input-label" style="margin-top:10px;">
            Coffee or other caffeine?
          </label>
          <div class="pill-row">
            <button class="pill caffeineBtn" data-caf="0">No caffeine</button>
            <button class="pill caffeineBtn" data-caf="40">
              Small coffee or tea
            </button>
            <button class="pill caffeineBtn" data-caf="80">
              Regular coffee
            </button>
            <button class="pill caffeineBtn" data-caf="120">
              Strong coffee / energy drink
            </button>
          </div>
        </div>

        <!-- SENSITIVITY -->
        <div class="card">
          <div class="card-title">Sensitivity and day pattern</div>

          <label class="input-label">
            How carb-heavy has the rest of your day been?
          </label>
          <div class="pill-row">
            <button class="pill dayCarbBtn" data-daycarb="0">Low</button>
            <button class="pill dayCarbBtn active" data-daycarb="1">Medium</button>
            <button class="pill dayCarbBtn" data-daycarb="2">High</button>
          </div>

          <label class="input-label" style="margin-top:10px;">
            Visceral sensitivity (gut volume knob)
          </label>
          <div class="pill-row">
            <button class="pill viscBtn" data-visc="0">Low</button>
            <button class="pill viscBtn active" data-visc="1">Medium</button>
            <button class="pill viscBtn" data-visc="2">High</button>
          </div>

          <label class="input-label" style="margin-top:10px;">
            Anxiety system sensitivity
          </label>
          <div class="pill-row">
            <button class="pill anxBtn" data-anx="0">Low</button>
            <button class="pill anxBtn active" data-anx="1">Medium</button>
            <button class="pill anxBtn" data-anx="2">High</button>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div id="right-column">
        <div class="score-card">
          <div class="risk-title">Current projected score</div>
          <div id="riskScore" class="risk-score">0</div>
          <div id="riskLabel" class="risk-label">
            Very low wave activity right now.
          </div>
          <div class="risk-bar-container">
            <div class="risk-bar-track"></div>
            <div id="riskBarFill" class="risk-bar-fill"></div>
            <div id="markerLane">
              <div id="youAreHereMarker">You are here</div>
            </div>
          </div>
        </div>

        <div class="card timeline-card">
          <div class="card-title">Spike â†’ crash â†’ recovery timeline</div>
          <p class="card-subtitle">
            Shows where you are inside the 0â€“240 minute wave based on meal + sugar +
            caffeine.
          </p>

          <div class="timeline-bar-shell">
            <div class="timeline-bar">
              <div class="timeline-seg-spike"></div>
              <div class="timeline-seg-crash"></div>
              <div class="timeline-seg-recov"></div>
            </div>
            <div
              id="timelineMarkerLine"
              class="timeline-marker-line"
              style="left:0%;"
            ></div>
            <div
              id="timelineMarkerLabel"
              class="timeline-marker-label"
              style="left:0%;"
            >
              You are here
            </div>
          </div>

          <div class="timeline-legend">
            <span
              ><span class="legend-dot legend-spike"></span>Spike window</span
            >
            <span
              ><span class="legend-dot legend-crash"></span>Crash / anxiety
              window</span
            >
            <span
              ><span class="legend-dot legend-recov"></span>Recovery</span
            >
          </div>

          <div class="timeline-columns">
            <div>
              <div class="timeline-heading">Spike window</div>
              <div id="timelineSpikeClock" class="timeline-time">
                Add meal time to see spike window.
              </div>
            </div>
            <div>
              <div class="timeline-heading">Crash / anxiety window</div>
              <div id="timelineCrashClock" class="timeline-time">
                Add meal time to see crash window.
              </div>
            </div>
            <div>
              <div class="timeline-heading">Recovery trend</div>
              <div id="timelineRecoveryClock" class="timeline-time">
                Add meal time to see recovery.
              </div>
            </div>
          </div>
        </div>

        <div class="crash-window">
          <div class="card-title" style="margin-bottom:6px;">Crash window</div>
          <div id="crashWindowText">
            Once you add a meal and timing, this will show your likely crash /
            anxiety window in clock time.
          </div>
        </div>

        <div class="card" style="margin-top:10px;">
          <div class="card-title">Body snapshot</div>
          <p
            id="bodySnapshot"
            style="font-size:13px; color:var(--text-soft); line-height:1.45;"
          >
            Once you pick a meal and rough timing, this will summarize how carbs,
            sugar, caffeine and sensitivity are combining in your system.
          </p>
        </div>

        <div class="card" style="margin-top:10px;">
          <button
            id="whyBtn"
            style="
              width: 100%;
              padding: 12px 0;
              font-size: 14px;
              border-radius: 12px;
              border: 1px solid var(--border-subtle);
              background: rgba(15, 23, 42, 0.95);
              color: var(--text-main);
            "
          >
            Why am I feeling this way?
          </button>
          <p
            id="whyOutput"
            style="font-size:13px; margin-top:10px; color:var(--text-soft); line-height:1.45;"
          ></p>
        </div>
      </div>
    </div>

    <footer>
      Â© 2025 Darkstar747. Free for personal use and community sharing. Not for
      commercial sale, resale or paywalled distribution.
    </footer>
  </div>
    <script>
    // ---------- DATA ----------

    const presetMeals = [
  // BREAKFAST (about 18)

  { id: 'eggs_toast', label: 'ðŸ¥š Eggs + toast', carbs: 20, sugar: 2, category: 'breakfast' },
  { id: 'omelette', label: 'ðŸ³ Omelette (veggies/cheese)', carbs: 10, sugar: 2, category: 'breakfast' },
  { id: 'pancakes_syrup', label: 'ðŸ¥ž Pancakes + syrup', carbs: 65, sugar: 20, category: 'breakfast' },
  { id: 'waffles_syrup', label: 'ðŸ§‡ Waffles + syrup', carbs: 65, sugar: 20, category: 'breakfast' },
  { id: 'bagel_cream_cheese', label: 'ðŸ¥¯ Bagel + cream cheese', carbs: 60, sugar: 4, category: 'breakfast' },
  { id: 'cereal_milk', label: 'ðŸ¥£ Cereal + milk', carbs: 55, sugar: 15, category: 'breakfast' },
  { id: 'french_toast', label: 'ðŸž French toast', carbs: 50, sugar: 12, category: 'breakfast' },
  { id: 'bacon_eggs', label: 'ðŸ¥“ Bacon + eggs', carbs: 2, sugar: 0, category: 'breakfast' },
  { id: 'egg_cheese_biscuit', label: 'ðŸ§€ Egg & cheese biscuit', carbs: 40, sugar: 3, category: 'breakfast' },
  { id: 'breakfast_burrito', label: 'ðŸŒ¯ Breakfast burrito', carbs: 45, sugar: 3, category: 'breakfast' },
  { id: 'croissant_butter', label: 'ðŸ¥ Croissant w/ butter', carbs: 30, sugar: 4, category: 'breakfast' },
  { id: 'banana_pb', label: 'ðŸŒ Banana + peanut butter', carbs: 30, sugar: 14, category: 'breakfast' },
  { id: 'yogurt_fruit', label: 'ðŸ¨ Yogurt + fruit', carbs: 30, sugar: 18, category: 'breakfast' },
  { id: 'yogurt_granola', label: 'ðŸ¥£ Yogurt + granola', carbs: 40, sugar: 20, category: 'breakfast' },
  { id: 'instant_oatmeal', label: 'ðŸ¥£ Instant oatmeal', carbs: 35, sugar: 10, category: 'breakfast' },
  { id: 'avocado_toast', label: 'ðŸ¥‘ Avocado toast', carbs: 25, sugar: 2, category: 'breakfast' },
  { id: 'hash_browns', label: 'ðŸ¥” Hash browns', carbs: 25, sugar: 1, category: 'breakfast' },
  { id: 'ham_breakfast_sandwich', label: 'ðŸ¥ª Ham breakfast sandwich', carbs: 35, sugar: 4, category: 'breakfast' },

  // LUNCH â€“ LIGHT / COMMON (about 16)

  { id: 'turkey_sandwich', label: 'ðŸ¥ª Turkey sandwich', carbs: 35, sugar: 4, category: 'lunch_light' },
  { id: 'ham_cheese_sandwich', label: 'ðŸ¥ª Ham & cheese sandwich', carbs: 35, sugar: 4, category: 'lunch_light' },
  { id: 'blt_sandwich', label: 'ðŸ¥ª BLT sandwich', carbs: 30, sugar: 3, category: 'lunch_light' },
  { id: 'tuna_sandwich', label: 'ðŸ¥ª Tuna salad sandwich', carbs: 30, sugar: 3, category: 'lunch_light' },
  { id: 'chicken_caesar_salad', label: 'ðŸ¥— Chicken Caesar salad', carbs: 15, sugar: 3, category: 'lunch_light' },
  { id: 'garden_salad_chicken', label: 'ðŸ¥— Garden salad w/ chicken', carbs: 18, sugar: 4, category: 'lunch_light' },
  { id: 'grilled_cheese', label: 'ðŸ¥ª Grilled cheese', carbs: 28, sugar: 3, category: 'lunch_light' },
  { id: 'soup_bread', label: 'ðŸ² Soup + bread', carbs: 30, sugar: 3, category: 'lunch_light' },
  { id: 'sushi_light', label: 'ðŸ± Sushi (6â€“8 pcs, light sauce)', carbs: 45, sugar: 4, category: 'lunch_light' },
  { id: 'rice_veggies', label: 'ðŸ™ Rice + veggies', carbs: 50, sugar: 3, category: 'lunch_light' },
  { id: 'rotisserie_rice', label: 'ðŸ— Rotisserie chicken + rice', carbs: 45, sugar: 2, category: 'lunch_light' },
  { id: 'lentils_rice', label: 'ðŸ› Lentils + rice', carbs: 55, sugar: 3, category: 'lunch_light' },
  { id: 'baked_potato_loaded', label: 'ðŸ¥” Baked potato (loaded)', carbs: 50, sugar: 3, category: 'lunch_light' },
  { id: 'chicken_salad', label: 'ðŸ¥— Chicken salad (light croutons)', carbs: 20, sugar: 3, category: 'lunch_light' },
  { id: 'small_mac_cheese', label: 'ðŸ Mac & cheese (small bowl)', carbs: 40, sugar: 3, category: 'lunch_light' },
  { id: 'sushi_california_roll', label: 'ðŸ£ California roll', carbs: 35, sugar: 3, category: 'lunch_light' },

  // LUNCH â€“ HEAVIER / FAST FOOD (about 18)

  { id: 'cheeseburger', label: 'ðŸ” Cheeseburger', carbs: 40, sugar: 8, category: 'lunch_heavy' },
  { id: 'double_cheeseburger', label: 'ðŸ” Double cheeseburger', carbs: 45, sugar: 8, category: 'lunch_heavy' },
  { id: 'bacon_burger', label: 'ðŸ” Bacon burger', carbs: 45, sugar: 8, category: 'lunch_heavy' },
  { id: 'burger_fries_combo', label: 'ðŸ” Burger + fries combo', carbs: 75, sugar: 10, category: 'lunch_heavy' },
  { id: 'taco_combo_3', label: 'ðŸŒ® Taco combo (3)', carbs: 60, sugar: 5, category: 'lunch_heavy' },
  { id: 'burrito_rice_beans', label: 'ðŸŒ¯ Burrito (rice + beans)', carbs: 85, sugar: 5, category: 'lunch_heavy' },
  { id: 'big_burrito_chipotle', label: 'ðŸŒ¯ Big burrito (chipotle-style)', carbs: 95, sugar: 6, category: 'lunch_heavy' },
  { id: 'pizza_2_slices', label: 'ðŸ• Pizza (2 slices)', carbs: 60, sugar: 5, category: 'lunch_heavy' },
  { id: 'pizza_3_slices', label: 'ðŸ• Pizza (3 slices)', carbs: 90, sugar: 8, category: 'lunch_heavy' },
  { id: 'fried_chicken_2pc', label: 'ðŸ— Fried chicken (2 pieces)', carbs: 20, sugar: 1, category: 'lunch_heavy' },
  { id: 'chicken_tenders_5', label: 'ðŸ— Chicken tenders (5)', carbs: 30, sugar: 2, category: 'lunch_heavy' },
  { id: 'ramen_bowl', label: 'ðŸœ Ramen bowl', carbs: 65, sugar: 4, category: 'lunch_heavy' },
  { id: 'teriyaki_chicken_rice', label: 'ðŸ± Teriyaki chicken + rice', carbs: 75, sugar: 18, category: 'lunch_heavy' },
  { id: 'hibachi_chicken_rice', label: 'ðŸ± Hibachi chicken + rice', carbs: 70, sugar: 8, category: 'lunch_heavy' },
  { id: 'sub_12in', label: 'ðŸ¥– Sub sandwich (12")', carbs: 70, sugar: 7, category: 'lunch_heavy' },
  { id: 'quesadilla_rice', label: 'ðŸŒ¯ Quesadilla + rice', carbs: 70, sugar: 4, category: 'lunch_heavy' },
  { id: 'wings_6', label: 'ðŸ— Wings (6)', carbs: 12, sugar: 4, category: 'lunch_heavy' },
  { id: 'lo_mein_combo', label: 'ðŸœ Lo mein combo', carbs: 85, sugar: 10, category: 'lunch_heavy' },

  // DINNER â€“ HOME CLASSICS (about 18)

  { id: 'chicken_rice_veg', label: 'ðŸ— Chicken + rice + veg', carbs: 55, sugar: 4, category: 'dinner' },
  { id: 'baked_chicken_potatoes', label: 'ðŸ— Baked chicken + potatoes', carbs: 45, sugar: 3, category: 'dinner' },
  { id: 'steak_potatoes', label: 'ðŸ¥© Steak + potatoes', carbs: 40, sugar: 2, category: 'dinner' },
  { id: 'salmon_rice', label: 'ðŸŸ Salmon + rice', carbs: 45, sugar: 2, category: 'dinner' },
  { id: 'fish_veggies', label: 'ðŸŸ Baked fish + veggies', carbs: 20, sugar: 2, category: 'dinner' },
  { id: 'beef_stew', label: 'ðŸ² Beef stew', carbs: 35, sugar: 4, category: 'dinner' },
  { id: 'pork_chops_sides', label: 'ðŸ– Pork chops + sides', carbs: 35, sugar: 4, category: 'dinner' },
  { id: 'chili_cornbread', label: 'ðŸ› Chili + cornbread', carbs: 55, sugar: 6, category: 'dinner' },
  { id: 'stir_fry_rice', label: 'ðŸš Stir fry + rice', carbs: 65, sugar: 8, category: 'dinner' },
  { id: 'noodles_veggies', label: 'ðŸœ Noodles + veggies', carbs: 60, sugar: 4, category: 'dinner' },
  { id: 'lasagna', label: 'ðŸ Lasagna', carbs: 60, sugar: 6, category: 'dinner' },
  { id: 'pasta_marinara', label: 'ðŸ Pasta + marinara', carbs: 70, sugar: 8, category: 'dinner' },
  { id: 'pasta_meatballs', label: 'ðŸ Pasta + meatballs', carbs: 75, sugar: 8, category: 'dinner' },
  { id: 'taco_night_3', label: 'ðŸŒ® Taco night (3)', carbs: 60, sugar: 5, category: 'dinner' },
  { id: 'fajitas', label: 'ðŸŒ¯ Fajitas (tortillas + fillings)', carbs: 55, sugar: 4, category: 'dinner' },
  { id: 'bbq_ribs_sides', label: 'ðŸ– BBQ ribs + sides', carbs: 55, sugar: 18, category: 'dinner' },
  { id: 'meatloaf_potatoes', label: 'ðŸ— Meatloaf + potatoes', carbs: 45, sugar: 6, category: 'dinner' },
  { id: 'shepherd_pie', label: 'ðŸ¥˜ Shepherdâ€™s pie', carbs: 55, sugar: 4, category: 'dinner' },

  // ASIAN / INTERNATIONAL FAVORITES (about 15)

  { id: 'pho', label: 'ðŸœ Pho noodles', carbs: 60, sugar: 4, category: 'asian' },
  { id: 'udon', label: 'ðŸœ Udon bowl', carbs: 55, sugar: 4, category: 'asian' },
  { id: 'pad_thai', label: 'ðŸœ Pad Thai', carbs: 75, sugar: 18, category: 'asian' },
  { id: 'tom_yum', label: 'ðŸ² Tom yum soup', carbs: 20, sugar: 3, category: 'asian' },
  { id: 'thai_curry_rice', label: 'ðŸ› Thai curry + rice', carbs: 70, sugar: 6, category: 'asian' },
  { id: 'indian_curry_naan', label: 'ðŸ› Indian curry + naan', carbs: 80, sugar: 6, category: 'asian' },
  { id: 'dumplings_8', label: 'ðŸ¥Ÿ Dumplings (8)', carbs: 45, sugar: 3, category: 'asian' },
  { id: 'gyoza_6', label: 'ðŸ¥Ÿ Gyoza (6)', carbs: 30, sugar: 2, category: 'asian' },
  { id: 'fried_rice', label: 'ðŸš Fried rice (one plate)', carbs: 70, sugar: 4, category: 'asian' },
  { id: 'chicken_katsu_rice', label: 'ðŸš Chicken katsu + rice', carbs: 75, sugar: 6, category: 'asian' },
  { id: 'butter_chicken_rice', label: 'ðŸ› Butter chicken + rice', carbs: 70, sugar: 8, category: 'asian' },
  { id: 'butter_paneer_rice', label: 'ðŸ› Butter paneer + rice', carbs: 70, sugar: 8, category: 'asian' },
  { id: 'korean_bbq_plate', label: 'ðŸ¥˜ Korean BBQ plate (rice + sides)', carbs: 60, sugar: 10, category: 'asian' },
  { id: 'yakitori_skewers_rice', label: 'ðŸ¢ Yakitori chicken + rice', carbs: 50, sugar: 5, category: 'asian' },
  { id: 'tempura_shrimp_6', label: 'ðŸ¤ Tempura shrimp (6)', carbs: 35, sugar: 2, category: 'asian' },

  // AMERICAN HEAVY / SAUCY (about 10)

  { id: 'large_pizza_slice', label: 'ðŸ• Large pizza slice', carbs: 45, sugar: 4, category: 'american_heavy' },
  { id: 'meat_lovers_pizza_2', label: 'ðŸ• Meat lovers (2 slices)', carbs: 70, sugar: 6, category: 'american_heavy' },
  { id: 'alfredo_garlic_bread', label: 'ðŸ Alfredo + garlic bread', carbs: 90, sugar: 6, category: 'american_heavy' },
  { id: 'spaghetti_garlic_knots', label: 'ðŸ Spaghetti + garlic knots', carbs: 95, sugar: 8, category: 'american_heavy' },
  { id: 'hot_dog_chips', label: 'ðŸŒ­ Hot dog + chips', carbs: 45, sugar: 4, category: 'american_heavy' },
  { id: 'philly_cheesesteak', label: 'ðŸ¥ª Philly cheesesteak', carbs: 55, sugar: 6, category: 'american_heavy' },
  { id: 'buffalo_wings_8', label: 'ðŸ— Buffalo wings (8)', carbs: 15, sugar: 4, category: 'american_heavy' },
  { id: 'loaded_fries', label: 'ðŸŸ Loaded fries', carbs: 60, sugar: 3, category: 'american_heavy' },
  { id: 'chicken_fried_steak', label: 'ðŸ¥š Chicken fried steak + gravy', carbs: 55, sugar: 3, category: 'american_heavy' },
  { id: 'jambalaya', label: 'ðŸ¥˜ Jambalaya', carbs: 50, sugar: 4, category: 'american_heavy' },

  // SNACKS / SMALL EATS (about 12)

  { id: 'large_cookie', label: 'ðŸª Large cookie', carbs: 30, sugar: 20, category: 'snack' },
  { id: 'candy_bar', label: 'ðŸ« Candy bar', carbs: 35, sugar: 25, category: 'snack' },
  { id: 'donut', label: 'ðŸ© Donut', carbs: 30, sugar: 18, category: 'snack' },
  { id: 'chips_bag', label: 'ðŸ¥¨ Chips (snack bag)', carbs: 18, sugar: 1, category: 'snack' },
  { id: 'popcorn_butter', label: 'ðŸ¿ Popcorn (butter)', carbs: 25, sugar: 0, category: 'snack' },
  { id: 'soft_pretzel', label: 'ðŸ¥¨ Soft pretzel', carbs: 40, sugar: 4, category: 'snack' },
  { id: 'small_fries', label: 'ðŸŸ Small fries', carbs: 30, sugar: 0, category: 'snack' },
  { id: 'trail_mix', label: 'ðŸ¥œ Peanut trail mix', carbs: 20, sugar: 8, category: 'snack' },
  { id: 'banana_snack', label: 'ðŸŒ Banana (snack)', carbs: 27, sugar: 14, category: 'snack' },
  { id: 'apple_slices', label: 'ðŸŽ Apple slices', carbs: 20, sugar: 15, category: 'snack' },
  { id: 'taquito', label: 'ðŸŒ¯ Taquito', carbs: 20, sugar: 1, category: 'snack' },
  { id: 'rice_crispy', label: 'ðŸ° Rice crispy treat', carbs: 28, sugar: 16, category: 'snack' },

  // DESSERTS (about 12)

  { id: 'cheesecake_slice', label: 'ðŸ° Cheesecake slice', carbs: 40, sugar: 28, category: 'dessert' },
  { id: 'chocolate_cake', label: 'ðŸ° Chocolate cake', carbs: 45, sugar: 30, category: 'dessert' },
  { id: 'vanilla_cupcake', label: 'ðŸ§ Vanilla cupcake', carbs: 30, sugar: 24, category: 'dessert' },
  { id: 'apple_pie', label: 'ðŸ¥§ Apple pie slice', carbs: 40, sugar: 24, category: 'dessert' },
  { id: 'pumpkin_pie', label: 'ðŸ¥§ Pumpkin pie slice', carbs: 38, sugar: 22, category: 'dessert' },
  { id: 'ice_cream_bowl', label: 'ðŸ¦ Ice cream bowl', carbs: 30, sugar: 26, category: 'dessert' },
  { id: 'ice_cream_sundae', label: 'ðŸ¨ Ice cream sundae', carbs: 40, sugar: 32, category: 'dessert' },
  { id: 'brownie', label: 'ðŸ« Brownie', carbs: 35, sugar: 28, category: 'dessert' },
  { id: 'mochi_ice_cream', label: 'ðŸ¡ Mochi ice cream (2)', carbs: 30, sugar: 18, category: 'dessert' },
  { id: 'tiramisu', label: 'ðŸ° Tiramisu', carbs: 40, sugar: 26, category: 'dessert' },
  { id: 'cupcake_chocolate', label: 'ðŸ§ Chocolate cupcake', carbs: 32, sugar: 26, category: 'dessert' },
  { id: 'rice_pudding', label: 'ðŸ¥› Rice pudding', carbs: 35, sugar: 20, category: 'dessert' }
];

    const state = {
      selectedMealId: null,
      mealCarbs: 0,
      mealSugarBase: 0,
      caffeineMg: 0,
      dessertSugar: 0,
      sodaSugar: 0,
      dayCarbLevel: 1,
      viscSens: 1,
      anxSens: 1,
      minutesSince: 0,
      mealTime: null
    };

    function clamp(v, min, max) {
      return Math.max(min, Math.min(max, v));
    }

    // ---------- UI HELPERS ----------

    function buildFoodGrid(filter = "") {
      const grid = document.getElementById("foodGrid");
      grid.innerHTML = "";
      const query = filter.trim().toLowerCase();

      const list = mealPresets.filter((m) => {
        if (!query) return true;
        const hay = (m.name + " " + m.category + " " + m.tag).toLowerCase();
        return hay.includes(query);
      });

      list.forEach((m) => {
        const btn = document.createElement("button");
        btn.className = "food-card";
        btn.dataset.id = m.id;

        if (state.selectedMealId === m.id) {
          btn.classList.add("selected");
        }

        btn.innerHTML = `
          <div class="food-card-header">
            <span class="food-card-emoji">${m.emoji}</span>
            <span>${m.name}</span>
          </div>
          <div class="food-card-meta">
            ${m.category}<br>
            ~${m.carbs} g carbs Â· ~${m.sugarBase} g sugar
          </div>
          <span class="food-tag">${m.tag}</span>
        `;

        btn.addEventListener("click", () => {
          state.selectedMealId = m.id;
          state.mealCarbs = m.carbs;
          state.mealSugarBase = m.sugarBase;
          updateSelectedMealText();
          buildFoodGrid(document.getElementById("mealSearch").value);
          recompute();
        });

        grid.appendChild(btn);
      });
    }

    function updateSelectedMealText() {
      const div = document.getElementById("selectedMeal");
      if (!state.selectedMealId) {
        div.textContent = "No meal selected yet.";
        return;
      }
      const m = mealPresets.find((x) => x.id === state.selectedMealId);
      if (!m) {
        div.textContent = "No meal selected yet.";
        return;
      }
      div.textContent = `Selected meal: ${m.name}. Tap the closest match; you can still tweak sugar, caffeine and sensitivity below.`;
    }

    function setActiveInGroup(selector, target) {
      document.querySelectorAll(selector).forEach((btn) => {
        btn.classList.toggle("active", btn === target);
      });
    }

    // ---------- MATH MODEL ----------

    function timeFactor(minutes) {
      const t = clamp(minutes, 0, 240);
      if (t <= 20) return (t / 20) * 0.3;                // ramp up to 0.3
      if (t <= 90) return 0.3 + ((t - 20) / 70) * 0.5;   // up to 0.8
      if (t <= 150) return 0.8 + ((t - 90) / 60) * 0.2;  // peak around 1
      if (t <= 210) return 1.0 - ((t - 150) / 60) * 0.4; // back to 0.6
      if (t <= 240) return 0.6 - ((t - 210) / 30) * 0.6; // to 0
      return 0;
    }

    function computeScore() {
      if (!state.selectedMealId &&
          state.dessertSugar === 0 &&
          state.sodaSugar === 0 &&
          state.caffeineMg === 0) {
        return 0;
      }

      const totalCarbs = state.mealCarbs;
      const addedSugar = state.mealSugarBase + state.dessertSugar + state.sodaSugar;
      const caffeine = state.caffeineMg;

      const carbLoad = clamp((totalCarbs / 100) * 40, 0, 40);
      const sugarLoad = clamp((addedSugar / 40) * 30, 0, 30);
      const caffeineLoad = clamp((caffeine / 150) * 20, 0, 20);
      const stacking = state.dayCarbLevel * 5;

      let base = clamp(carbLoad + sugarLoad + caffeineLoad + stacking, 0, 100);

      const sensFactor = 1 + 0.25 * state.viscSens + 0.25 * state.anxSens;
      const tf = timeFactor(state.minutesSince);

      let score = Math.round(base * sensFactor * tf);
      score = clamp(score, 0, 100);
      return score;
    }

    function describeRisk(score) {
      if (score >= 75) return "High wave risk in this 1â€“4 hour window.";
      if (score >= 50) return "Moderate wave risk. This combo could make a crash noticeable.";
      if (score >= 25) return "Low to moderate wave. Many people would feel a mild dip.";
      return "Very low wave activity. Biology says this pattern should feel fairly stable for most people.";
    }

    // ---------- CLOCK HELPERS ----------

    function parseMealTime() {
      const input = document.getElementById("mealTimeInput").value;
      if (!input) return null;
      const [h, m] = input.split(":").map((x) => parseInt(x, 10));
      if (Number.isNaN(h) || Number.isNaN(m)) return null;
      const now = new Date();
      now.setHours(h, m, 0, 0);
      return now;
    }

    function addMinutesToDate(date, minutes) {
      const d = new Date(date.getTime());
      d.setMinutes(d.getMinutes() + minutes);
      return d;
    }

    function formatTime(d) {
      let h = d.getHours();
      const m = d.getMinutes();
      const ampm = h >= 12 ? "pm" : "am";
      h = h % 12;
      if (h === 0) h = 12;
      const mm = m.toString().padStart(2, "0");
      return `${h}:${mm} ${ampm}`;
    }

    function updateTimelineClocks() {
      const mealTime = state.mealTime;
      const spikeEl = document.getElementById("timelineSpikeClock");
      const crashEl = document.getElementById("timelineCrashClock");
      const recEl = document.getElementById("timelineRecoveryClock");
      const crashText = document.getElementById("crashWindowText");

      if (!mealTime) {
        spikeEl.textContent = "Add meal time to see spike window.";
        crashEl.textContent = "Add meal time to see crash window.";
        recEl.textContent = "Add meal time to see recovery.";
        crashText.textContent =
          "Once you add a meal and timing, this will show your likely crash / anxiety window in clock time.";
        return;
      }

      const spikeStart = addMinutesToDate(mealTime, 30);
      const spikeEnd = addMinutesToDate(mealTime, 90);
      const crashStart = addMinutesToDate(mealTime, 90);
      const crashEnd = addMinutesToDate(mealTime, 150);
      const recStart = addMinutesToDate(mealTime, 150);
      const recEnd = addMinutesToDate(mealTime, 240);

      spikeEl.textContent = `${formatTime(spikeStart)} â€“ ${formatTime(
        spikeEnd
      )}`;
      crashEl.textContent = `${formatTime(crashStart)} â€“ ${formatTime(
        crashEnd
      )}`;
      recEl.textContent = `${formatTime(recStart)} â€“ ${formatTime(recEnd)}`;

      crashText.textContent =
        `Your likely crash / anxiety window looks to be between ` +
        `${formatTime(crashStart)} and ${formatTime(crashEnd)} based on this model.`;
    }

    function updateMarkers(score) {
      const riskBarFill = document.getElementById("riskBarFill");
      const riskScoreEl = document.getElementById("riskScore");
      const riskLabelEl = document.getElementById("riskLabel");
      const marker = document.getElementById("youAreHereMarker");
      const timelineLine = document.getElementById("timelineMarkerLine");
      const timelineLabel = document.getElementById("timelineMarkerLabel");

      riskScoreEl.textContent = score;
      riskLabelEl.textContent = describeRisk(score);

      riskBarFill.style.width = `${score}%`;

      const x = score; // 0â€“100
      marker.style.left = `${x}%`;
      marker.style.transform = "translateX(-50%)";

      const pos = (state.minutesSince / 240) * 100;
      const clampedPos = clamp(pos, 0, 100);
      timelineLine.style.left = `${clampedPos}%`;
      timelineLabel.style.left = `${clampedPos}%`;
      timelineLabel.style.transform = "translateX(-50%)";
    }

    function updateBodySnapshot(score) {
      const el = document.getElementById("bodySnapshot");

      if (!state.selectedMealId) {
        el.textContent =
          "Once you pick a meal and rough timing, this will summarize how carbs, sugar, caffeine and sensitivity are combining in your system.";
        return;
      }

      const parts = [];

      if (score >= 75) {
        parts.push(
          "This is a heavy wave: big carb load plus added sugar and/or caffeine, on top of a sensitive gut or nervous system."
        );
      } else if (score >= 50) {
        parts.push(
          "This looks like a moderate wave. Many people in a sensitive phase would feel a clear dip or jitter here."
        );
      } else if (score >= 25) {
        parts.push(
          "This is a lighter wave. Biology says it is more of a gentle dip than a full crash for most people."
        );
      } else {
        parts.push(
          "This pattern is on the quiet side. Most people would feel fairly steady from a carb/sugar point of view."
        );
      }

      if (state.caffeineMg >= 80) {
        parts.push(
          "Caffeine is playing a big role; it can amplify both the spike and the later crash."
        );
      }

      if (state.dayCarbLevel === 2) {
        parts.push(
          "Earlier carbs today are stacking, which can make this wave louder than the same meal on an otherwise light day."
        );
      }

      el.textContent = parts.join(" ");
    }

    function recompute() {
      const score = computeScore();
      updateMarkers(score);
      updateBodySnapshot(score);
    }

    // ---------- EVENTS ----------

    document.addEventListener("DOMContentLoaded", () => {
      buildFoodGrid("");
      updateSelectedMealText();
      recompute();

      document
        .getElementById("mealSearch")
        .addEventListener("input", (e) => buildFoodGrid(e.target.value));

      document.getElementById("clearSearch").addEventListener("click", () => {
        document.getElementById("mealSearch").value = "";
        buildFoodGrid("");
      });

      document
        .getElementById("minutesSinceMealRange")
        .addEventListener("input", (e) => {
          const val = parseInt(e.target.value, 10) || 0;
          state.minutesSince = val;
          document.getElementById(
            "minutesSinceLabel"
          ).textContent = `${val} minutes since meal.`;
          recompute();
        });

      document.getElementById("mealTimeInput").addEventListener("change", () => {
        state.mealTime = parseMealTime();
        updateTimelineClocks();
      });

      document.querySelectorAll(".dessertBtn").forEach((btn) => {
        btn.addEventListener("click", () => {
          state.dessertSugar = parseInt(btn.dataset.dessert, 10) || 0;
          setActiveInGroup(".dessertBtn", btn);
          recompute();
        });
      });

      document.querySelectorAll(".sodaBtn").forEach((btn) => {
        btn.addEventListener("click", () => {
          state.sodaSugar = parseInt(btn.dataset.soda, 10) || 0;
          setActiveInGroup(".sodaBtn", btn);
          recompute();
        });
      });

      document.querySelectorAll(".caffeineBtn").forEach((btn) => {
        btn.addEventListener("click", () => {
          state.caffeineMg = parseInt(btn.dataset.caf, 10) || 0;
          setActiveInGroup(".caffeineBtn", btn);
          recompute();
        });
      });

      document.querySelectorAll(".dayCarbBtn").forEach((btn) => {
        btn.addEventListener("click", () => {
          state.dayCarbLevel = parseInt(btn.dataset.daycarb, 10) || 0;
          setActiveInGroup(".dayCarbBtn", btn);
          recompute();
        });
      });

      document.querySelectorAll(".viscBtn").forEach((btn) => {
        btn.addEventListener("click", () => {
          state.viscSens = parseInt(btn.dataset.visc, 10) || 0;
          setActiveInGroup(".viscBtn", btn);
          recompute();
        });
      });

      document.querySelectorAll(".anxBtn").forEach((btn) => {
        btn.addEventListener("click", () => {
          state.anxSens = parseInt(btn.dataset.anx, 10) || 0;
          setActiveInGroup(".anxBtn", btn);
          recompute();
        });
      });

      document.getElementById("whyBtn").addEventListener("click", () => {
        const score = computeScore();
        const out = document.getElementById("whyOutput");
        if (!state.selectedMealId) {
          out.textContent =
            "This tool works best once you pick a rough meal, add any dessert or drinks, and give it a sense of timing. Then it can line that up with the 0â€“240 minute spike â†’ crash â†’ recovery pattern.";
          return;
        }

        const parts = [];
        const m = mealPresets.find((x) => x.id === state.selectedMealId);
        if (m) {
          parts.push(
            `You logged a meal similar to â€œ${m.name}â€ (~${m.carbs} g carbs plus ~${m.sugarBase} g sugar).`
          );
        }

        if (state.dessertSugar + state.sodaSugar > 0) {
          parts.push(
            `On top of that there is about ${state.dessertSugar +
              state.sodaSugar} g of added sugar from dessert or drinks.`
          );
        }

        if (state.caffeineMg > 0) {
          parts.push(
            `There is also caffeine in the mix (~${state.caffeineMg} mg), which can sharpen the spike and then make the crash feel jittery or anxious.`
          );
        }

        parts.push(
          `Your sensitivity settings tell the model that both gut and anxiety systems are at level ${state.viscSens} and ${state.anxSens} on a 0â€“2 scale.`
        );

        parts.push(
          `Right now the calculator sees this as about ${score}/100 risk in this part of the 0â€“240 minute wave.`
        );

        out.textContent = parts.join(" ");
      });
    });
  </script>
</body>
</html>
  
