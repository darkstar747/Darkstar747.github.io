<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Carb / Sugar Anxiety Timing Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #05060a;
      --bg-elevated: #0b0d15;
      --bg-elevated-soft: #101321;
      --border-subtle: rgba(255, 255, 255, 0.08);
      --border-strong: rgba(255, 255, 255, 0.18);
      --text-main: #f4f5ff;
      --text-soft: #c2c7e0;
      --text-subtle: #8b90aa;
      --accent: #2dd4bf;
      --accent-soft: rgba(45, 212, 191, 0.14);
      --danger: #fb7185;
      --warning: #fbbf24;
      --ok: #4ade80;
    }

    * {
      box-sizing: border-box;
    }

    .hidden {
      display: none;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #10172f 0, #020617 55%);
      color: var(--text-main);
    }

    .app-shell {
      max-width: 1120px;
      margin: 0 auto;
      padding: 18px 12px 32px;
    }

    header.app-header {
      margin-bottom: 14px;
    }

    .title-row {
      display: flex;
      flex-wrap: wrap;
      align-items: baseline;
      gap: 8px;
    }

    .title-row h1 {
      margin: 0;
      font-size: 1.3rem;
      letter-spacing: 0.04em;
      text-transform: uppercase;
    }

    .title-pill {
      font-size: 0.7rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-subtle);
      background: rgba(15, 23, 42, 0.9);
      white-space: nowrap;
    }

    .subtitle {
      margin-top: 6px;
      font-size: 0.85rem;
      color: var(--text-subtle);
      max-width: 720px;
    }

    .mode-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      font-size: 0.78rem;
    }

    .mode-pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: #a5b4fc;
      background: rgba(15, 23, 42, 0.85);
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(0, 1.15fr) minmax(0, 1fr);
      gap: 12px;
    }

    @media (max-width: 880px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .panel {
      background: rgba(15, 23, 42, 0.9);
      border-radius: 18px;
      border: 1px solid var(--border-subtle);
      padding: 14px 14px 16px;
      box-shadow: 0 22px 55px rgba(0, 0, 0, 0.6);
    }

    .panel + .panel {
      margin-top: 10px;
    }

    .panel-header-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      margin-bottom: 8px;
    }

    .panel-header-row h2 {
      margin: 0;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-soft);
    }

    .mode-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      overflow: hidden;
    }

    .mode-toggle button {
      border: none;
      background: transparent;
      color: var(--text-subtle);
      padding: 4px 10px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .mode-toggle button.active {
      background: var(--accent-soft);
      color: #e0fffb;
    }

    .panel-subtitle {
      margin: 0 0 10px;
      font-size: 0.8rem;
      color: var(--text-subtle);
    }

    .card-section {
      padding: 10px 10px 10px;
      border-radius: 14px;
      background: radial-gradient(circle at top left, #111827, #020617);
      border: 1px solid var(--border-subtle);
      margin-bottom: 10px;
    }

    .card-section label {
      display: block;
      font-size: 0.86rem;
      margin-bottom: 4px;
      color: var(--text-main);
    }

    .hint {
      margin-top: 6px;
      font-size: 0.78rem;
      color: var(--text-subtle);
    }

    .food-search-row {
      display: flex;
      gap: 6px;
      margin-top: 6px;
    }

    .food-search-row input {
      flex: 1;
      padding: 7px 9px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text-main);
      font-size: 0.82rem;
    }

    .food-search-row input::placeholder {
      color: #6b7280;
    }

    .food-search-row button {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text-subtle);
      font-size: 0.8rem;
      padding: 0 10px;
      cursor: pointer;
    }

    .food-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(135px, 1fr));
      gap: 6px;
      margin-top: 8px;
      max-height: 260px;
      overflow: auto;
    }

    .food-card {
      border-radius: 12px;
      border: 1px solid var(--border-subtle);
      padding: 7px 8px;
      font-size: 0.78rem;
      background: #020617;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .food-card.selected {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #022c22;
    }

    .food-main-line {
      display: flex;
      justify-content: space-between;
      gap: 4px;
      align-items: center;
    }

    .food-name {
      font-weight: 500;
      color: var(--text-main);
    }

    .food-emoji {
      font-size: 1.05rem;
    }

    .food-meta {
      font-size: 0.72rem;
      color: var(--text-subtle);
    }

    .food-tag {
      margin-top: 2px;
      font-size: 0.7rem;
      color: #fde68a;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .chip-button {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text-soft);
      font-size: 0.78rem;
      padding: 5px 9px;
      cursor: pointer;
    }

    .chip-button.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: #e0fffb;
    }

    .slider-group {
      margin-top: 6px;
      padding-top: 6px;
      border-top: 1px solid rgba(148, 163, 184, 0.25);
    }

    .slider-group:first-of-type {
      border-top: none;
      padding-top: 2px;
    }

    .slider-group .label-main {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      font-size: 0.84rem;
      margin-bottom: 2px;
    }

    .slider-group .label-main span.right {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .slider-caption {
      margin-top: 4px;
      font-size: 0.75rem;
      color: var(--text-subtle);
    }

    input[type="range"] {
      width: 100%;
      margin-top: 4px;
    }

    .numeric-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 8px;
      margin-top: 6px;
    }

    .numeric-input-group label {
      display: block;
      font-size: 0.8rem;
      margin-bottom: 2px;
    }

    .numeric-input-group input {
      width: 100%;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text-main);
      font-size: 0.82rem;
    }

    .time-input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
      align-items: center;
    }

    .time-input-row input[type="time"] {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text-main);
      font-size: 0.82rem;
    }

    .time-input-row button {
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #020617;
      color: var(--text-subtle);
      font-size: 0.78rem;
      padding: 4px 10px;
      cursor: pointer;
    }

    .right-column-card {
      margin-bottom: 10px;
    }

    .risk-title-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }

    .risk-title-row h2 {
      margin: 0;
      font-size: 0.93rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--text-soft);
    }

    .risk-thresholds {
      font-size: 0.76rem;
      color: var(--text-subtle);
    }

    .gauge-shell {
      margin-top: 6px;
    }

    .gauge-track {
      position: relative;
      width: 100%;
      height: 16px;
      border-radius: 999px;
      background: linear-gradient(
        to right,
        #16a34a,
        #facc15,
        #fb923c,
        #ef4444
      );
      overflow: hidden;
    }

    .gauge-marker {
      position: absolute;
      top: -2px;
      width: 3px;
      height: 20px;
      background: #e5e7eb;
      border-radius: 999px;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.7);
    }

    .gauge-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.74rem;
      color: var(--text-subtle);
      margin-top: 4px;
    }

    .score-row {
      margin-top: 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      flex-wrap: wrap;
    }

    .score-pill {
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid var(--border-strong);
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 7px;
    }

    .score-pill span.level-badge {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: var(--ok);
      color: #022c22;
      font-weight: 600;
    }

    .recalc-row {
      margin-top: 8px;
      display: flex;
      justify-content: flex-end;
    }

    .recalc-btn {
      border-radius: 999px;
      border: 1px solid var(--accent);
      background: var(--accent-soft);
      color: #ecfeff;
      font-weight: 500;
      padding: 8px 16px;
      font-size: 0.86rem;
      cursor: pointer;
    }

    .timeline-header {
      margin-top: 2px;
      font-size: 0.85rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-soft);
    }

    .timeline-track {
      margin-top: 6px;
      width: 100%;
      height: 14px;
      border-radius: 999px;
      background: #020617;
      position: relative;
      overflow: hidden;
      border: 1px solid var(--border-subtle);
    }

    .timeline-segment {
      position: absolute;
      top: 0;
      bottom: 0;
    }

    .seg-spike {
      background: #fde047;
    }

    .seg-crash {
      background: #fb7185;
    }

    .seg-recovery {
      background: #38bdf8;
    }

    .timeline-legend {
      margin-top: 5px;
      font-size: 0.76rem;
      color: var(--text-subtle);
    }

    .timeline-legend span.swatch {
      display: inline-block;
      width: 10px;
      height: 8px;
      border-radius: 4px;
      margin-right: 3px;
    }

    .timeline-times {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--text-soft);
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 4px;
    }

    @media (min-width: 720px) {
      .timeline-times {
        grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      }
      .timeline-times .full-row {
        grid-column: 1 / -1;
      }
    }

    .timeline-times-title {
      font-weight: 600;
    }

    .summary-main {
      margin-top: 4px;
      font-size: 0.86rem;
      color: var(--text-main);
    }

    .summary-detail {
      margin-top: 6px;
      font-size: 0.8rem;
      color: var(--text-subtle);
    }

    .why-row {
      margin-top: 8px;
      display: flex;
      justify-content: flex-start;
    }

    .why-btn {
      font-size: 0.8rem;
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255, 255, 255, 0.22);
      background: rgba(255, 255, 255, 0.04);
      color: var(--text-soft);
      cursor: pointer;
    }

    .why-btn.active {
      border-color: var(--accent);
      background: var(--accent-soft);
      color: #e6fffb;
    }

    .why-panel {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 12px;
      background: #0a0b11;
      border: 1px solid rgba(255, 255, 255, 0.12);
      font-size: 0.8rem;
      color: var(--text-soft);
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="title-row">
        <h1>Carb / Sugar Anxiety Timing Explorer</h1>
        <span class="title-pill">Focus: post-meal hours, not psychology</span>
        <span class="title-pill">Built for sensitive gut / nervous system people</span>
      </div>
      <p class="subtitle">
        Rough, biology-informed estimate of when carbs, added sugar, and caffeine
        might create a spike ‚Üí crash ‚Üí anxiety window. Not medical advice, just a
        pattern explorer.
      </p>
      <div class="mode-row">
        <span class="mode-pill">Rough biological model, not a diagnosis</span>
        <span class="mode-pill">Helps you test timing patterns, not blame yourself</span>
      </div>
    </header>

    <div class="layout">
      <div>
        <div class="panel">
          <div class="panel-header-row">
            <h2>Meal and pattern</h2>
            <div class="mode-toggle">
              <button id="simpleModeBtn" class="active" type="button">Simple (pick a meal)</button>
              <button id="advancedModeBtn" type="button">Advanced (exact grams)</button>
            </div>
          </div>
          <p class="panel-subtitle">
            Fill this in and the gauge, timeline, and summary will adjust
            automatically.
          </p>

          <!-- SIMPLE MODE -->
          <div id="simpleModePanel">
            <div class="card-section">
              <label>What time did you eat this meal?</label>
              <div class="time-input-row">
                <input id="simpleMealTime" type="time" />
                <button id="simpleUseNowBtn" type="button">Use current time</button>
              </div>
              <div class="hint">
                If you skip this, the timeline uses ‚Äúnow‚Äù to estimate windows.
              </div>
            </div>

            <div class="card-section">
              <label>Simple: what did the meal look like?</label>
              <div class="food-search-row">
                <input
                  id="foodSearchInput"
                  type="text"
                  placeholder="Search (pizza, pasta, sushi, salad, soda...)"
                />
                <button id="foodSearchClearBtn" type="button">Clear</button>
              </div>
              <div id="foodGrid" class="food-grid"></div>
              <div class="hint">
                Tap the option that feels closest. You can still tweak sugar,
                caffeine, and sensitivity below.
              </div>
            </div>

            <div class="card-section">
              <label>Did you add dessert?</label>
              <div class="chip-row">
                <button
                  id="dessertNoneBtn"
                  class="chip-button active"
                  type="button"
                >
                  No dessert
                </button>
                <button id="dessertSmallBtn" class="chip-button" type="button">
                  Small dessert (~10 g sugar)
                </button>
                <button id="dessertBigBtn" class="chip-button" type="button">
                  Big dessert (~35 g sugar)
                </button>
              </div>
              <div class="hint">
                Big dessert might be a bowl of ice cream, a big slice of cake,
                or 2‚Äì3 cookies.
              </div>
            </div>

            <div class="card-section">
              <label>Coffee and sugary drink around this meal</label>
              <div class="chip-row" style="margin-bottom:4px;">
                <button id="cafNoneBtn" class="chip-button active" type="button">
                  No caffeine
                </button>
                <button id="cafSmallBtn" class="chip-button" type="button">
                  Small coffee or tea
                </button>
                <button id="cafStrongBtn" class="chip-button" type="button">
                  Strong coffee / energy drink
                </button>
              </div>
              <div class="chip-row">
                <button
                  id="drinkNoneBtn"
                  class="chip-button active"
                  type="button"
                >
                  No sugary drink
                </button>
                <button id="drinkSmallBtn" class="chip-button" type="button">
                  One soda or sweet drink
                </button>
                <button id="drinkBigBtn" class="chip-button" type="button">
                  Big or multiple sweet drinks
                </button>
              </div>
              <div class="hint">
                Think of drinks you had within a few hours of this plate.
              </div>
            </div>

            <div class="card-section">
              <div class="slider-group">
                <div class="label-main">
                  <span>How carb-heavy has the rest of your day been?</span>
                  <span class="right" id="dayCarbLabel">Medium</span>
                </div>
                <input id="dayCarbSlider" type="range" min="0" max="2" step="1" value="1" />
                <div class="slider-caption">
                  0 = mostly light / low carb so far, 2 = lots of bread, pasta,
                  sweets, snacks earlier.
                </div>
              </div>

              <div class="slider-group">
                <div class="label-main">
                  <span>Visceral sensitivity (gut volume knob)</span>
                  <span class="right" id="visceralLabel">Medium</span>
                </div>
                <input
                  id="visceralSlider"
                  type="range"
                  min="0"
                  max="2"
                  step="1"
                  value="1"
                />
                <div class="slider-caption">
                  0 = gut rarely complains, 2 = gut that feels every bubble and
                  stretch.
                </div>
              </div>

              <div class="slider-group">
                <div class="label-main">
                  <span>Anxiety system sensitivity</span>
                  <span class="right" id="anxietyLabel">Medium</span>
                </div>
                <input
                  id="anxietySlider"
                  type="range"
                  min="0"
                  max="2"
                  step="1"
                  value="1"
                />
                <div class="slider-caption">
                  0 = rarely anxious, 2 = nervous system that notices every
                  little crash.
                </div>
              </div>
            </div>
          </div>
                    <!-- ADVANCED MODE -->
          <div id="advancedModePanel" class="hidden">
            <div class="card-section">
              <label>Meal time</label>
              <div class="time-input-row">
                <input id="advMealTime" type="time" />
                <button id="advUseNowBtn" type="button">Use current time</button>
              </div>
              <div class="hint">
                Use this mode if you know your numbers. If not, stick to the
                simple presets.
              </div>
            </div>

            <div class="card-section">
              <label>Exact meal numbers (estimated is fine)</label>
              <div class="numeric-row">
                <div class="numeric-input-group">
                  <label for="advCarbs">Carbs (grams)</label>
                  <input id="advCarbs" type="number" min="0" max="300" />
                </div>
                <div class="numeric-input-group">
                  <label for="advSugar">Added sugar (grams)</label>
                  <input id="advSugar" type="number" min="0" max="200" />
                </div>
                <div class="numeric-input-group">
                  <label for="advCaffeine">Caffeine (mg)</label>
                  <input id="advCaffeine" type="number" min="0" max="600" />
                </div>
              </div>
              <div class="hint">
                If you are not sure, you can look up one example on a nutrition
                site once, then round to the nearest ‚Äúzone‚Äù next time.
              </div>
            </div>

            <div class="card-section">
              <div class="slider-group">
                <div class="label-main">
                  <span>How carb-heavy has the rest of your day been?</span>
                  <span class="right" id="advDayCarbLabel">Medium</span>
                </div>
                <input
                  id="advDayCarbSlider"
                  type="range"
                  min="0"
                  max="2"
                  step="1"
                  value="1"
                />
                <div class="slider-caption">
                  0 = mostly light / low carb so far, 2 = lots of bread, pasta,
                  sweets, snacks earlier.
                </div>
              </div>

              <div class="slider-group">
                <div class="label-main">
                  <span>Visceral sensitivity (gut volume knob)</span>
                  <span class="right" id="advVisceralLabel">Medium</span>
                </div>
                <input
                  id="advVisceralSlider"
                  type="range"
                  min="0"
                  max="2"
                  step="1"
                  value="1"
                />
                <div class="slider-caption">
                  0 = gut rarely complains, 2 = gut that feels every bubble and
                  stretch.
                </div>
              </div>

              <div class="slider-group">
                <div class="label-main">
                  <span>Anxiety system sensitivity</span>
                  <span class="right" id="advAnxietyLabel">Medium</span>
                </div>
                <input
                  id="advAnxietySlider"
                  type="range"
                  min="0"
                  max="2"
                  step="1"
                  value="1"
                />
                <div class="slider-caption">
                  0 = rarely anxious, 2 = nervous system that notices every
                  little crash.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT COLUMN -->
      <div>
        <div class="panel right-column-card">
          <div class="risk-title-row">
            <h2>Risk gauge</h2>
            <div class="risk-thresholds">
              0 to 49 Low, 50 to 74 Moderate, 75 plus High
            </div>
          </div>

          <div class="gauge-shell">
            <div class="gauge-track">
              <div id="gaugeMarker" class="gauge-marker"></div>
            </div>
            <div class="gauge-label-row">
              <span>Low</span>
              <span>25</span>
              <span>50</span>
              <span>75</span>
              <span>100</span>
            </div>
          </div>

          <div class="score-row">
            <div id="scorePill" class="score-pill">
              <span id="scoreText">Current score 0 of 100</span>
              <span id="scoreLevelBadge" class="level-badge">Low</span>
            </div>
            <div id="scoreNote" style="font-size:0.76rem;color:var(--text-subtle);">
              Biology says this pattern should feel fairly steady for most
              people.
            </div>
          </div>

          <div class="card-section" style="margin-top:10px;">
            <div class="timeline-header">Spike ‚Üí crash ‚Üí recovery timeline</div>
            <div class="timeline-track">
              <div id="segSpike" class="timeline-segment seg-spike"></div>
              <div id="segCrash" class="timeline-segment seg-crash"></div>
              <div id="segRecovery" class="timeline-segment seg-recovery"></div>
            </div>
            <div class="timeline-legend">
              <span class="swatch" style="background:#fde047;"></span>Spike
              window,
              <span class="swatch" style="background:#fb7185;"></span>Crash /
              anxiety window,
              <span class="swatch" style="background:#38bdf8;"></span>Recovery.
            </div>

            <div class="timeline-times">
              <div>
                <div class="timeline-times-title">Spike window</div>
                <div id="spikeTimeLabel">Set a meal time to see it.</div>
              </div>
              <div>
                <div class="timeline-times-title">Crash / anxiety window</div>
                <div id="crashTimeLabel">Set a meal time to see it.</div>
              </div>
              <div class="full-row">
                <div class="timeline-times-title">Recovery trend</div>
                <div id="recoveryTimeLabel">Set a meal time to see it.</div>
              </div>
            </div>
          </div>

          <div class="card-section">
            <div class="panel-header-row" style="margin-bottom:4px;">
              <h2>Quick summary</h2>
            </div>
            <div id="summaryMain" class="summary-main">
              Enter a meal to see a rough score.
            </div>
            <div id="summaryDetail" class="summary-detail">
              You will see how carbs, sugar, caffeine, and sensitivity stack to
              make an early-night or late-night worry window more likely. It is
              about timing and physiology, not personal weakness.
            </div>

            <div class="why-row">
              <button id="whyBtn" class="why-btn" type="button">
                Why am I feeling this way?
              </button>
            </div>
            <div id="whyPanel" class="why-panel hidden">
              <p style="margin-top:0;">
                This tool assumes that a big carb or sugar load pushes blood
                sugar up first, then insulin and gut hormones pull it back
                down. If your gut nerves are sensitive and your anxiety system
                is jumpy, that drop can feel like dread, shakiness, or a wave of
                ‚Äúsomething is wrong‚Äù.
              </p>
              <p>
                Nothing here means you are weak or broken. It is just a way to
                map ‚ÄúI feel weird‚Äù to timing: what was happening in your gut,
                your blood sugar, and your caffeine level in the last few
                hours.
              </p>
              <p style="margin-bottom:0;">
                If this ever feels intense or dangerous, or you are not sure
                what is going on, that is the moment to talk with a doctor or
                therapist. The goal is to make patterns less scary, not to
                replace real care.
              </p>
            </div>

            <div class="recalc-row">
              <button id="recalcBtn" class="recalc-btn" type="button">
                Recalculate now ‚Üª
              </button>
            </div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-header-row">
            <h2>What this is and is not</h2>
          </div>
          <p class="summary-detail" style="margin-top:0;">
            This is a rough timing model for people who notice that carbs, sugar,
            and caffeine can create waves of anxiety a couple of hours later,
            especially if they also have IBS or visceral hypersensitivity.
          </p>
          <p class="summary-detail">
            It is not a diagnosis. If you ever have chest pain, severe shortness
            of breath, or feel unsafe, that is an emergency issue for real-world
            care, not a timing calculator.
          </p>
        </div>
      </div>
    </div>
    <script>
      const $ = (id) => document.getElementById(id);

      // -----------------------------
      // Meal presets (you can extend later)
      // -----------------------------
      const mealPresets = [
        {
          id: "pastaPlate",
          emoji: "üçù",
          name: "Plate of pasta",
          category: "Dinner, Italian",
          carbs: 80,
          fiber: 3,
          fatLevel: 1,
          sugarBase: 3,
          tag: "High carb"
        },
        {
          id: "riceBowl",
          emoji: "üçö",
          name: "Rice bowl",
          category: "Lunch or dinner",
          carbs: 70,
          fiber: 2,
          fatLevel: 0,
          sugarBase: 2,
          tag: "High carb"
        },
        {
          id: "ramenBowl",
          emoji: "üçú",
          name: "Ramen or noodle bowl",
          category: "Dinner, noodles",
          carbs: 65,
          fiber: 3,
          fatLevel: 1,
          sugarBase: 3,
          tag: "High carb"
        },
        {
          id: "friedRice",
          emoji: "üçõ",
          name: "Fried rice",
          category: "Takeout, Chinese",
          carbs: 75,
          fiber: 3,
          fatLevel: 2,
          sugarBase: 3,
          tag: "High carb"
        },
        {
          id: "orangeChickenRice",
          emoji: "üçõ",
          name: "Orange chicken plus rice",
          category: "Takeout, Chinese",
          carbs: 85,
          fiber: 3,
          fatLevel: 2,
          sugarBase: 10,
          tag: "High carb and sugar"
        },
        {
          id: "pizza2",
          emoji: "üçï",
          name: "Pizza, 2 slices",
          category: "Dinner, pizza",
          carbs: 60,
          fiber: 3,
          fatLevel: 2,
          sugarBase: 3,
          tag: "High carb and fat"
        },
        {
          id: "burgerFries",
          emoji: "üçî",
          name: "Burger with fries",
          category: "Fast food",
          carbs: 70,
          fiber: 4,
          fatLevel: 2,
          sugarBase: 4,
          tag: "Heavy"
        },
        {
          id: "burgerOnly",
          emoji: "üçî",
          name: "Burger, no fries",
          category: "Fast food",
          carbs: 45,
          fiber: 2,
          fatLevel: 2,
          sugarBase: 2,
          tag: "Medium carb"
        },
        {
          id: "burrito",
          emoji: "üåØ",
          name: "Burrito",
          category: "Mexican",
          carbs: 75,
          fiber: 6,
          fatLevel: 2,
          sugarBase: 3,
          tag: "High carb"
        },
        {
          id: "tacos",
          emoji: "üåÆ",
          name: "Tacos, 2 to 3",
          category: "Mexican",
          carbs: 45,
          fiber: 4,
          fatLevel: 1,
          sugarBase: 2,
          tag: "Medium carb"
        },
        {
          id: "chipotleBowl",
          emoji: "ü•ó",
          name: "Burrito bowl",
          category: "Mexican bowl",
          carbs: 65,
          fiber: 7,
          fatLevel: 2,
          sugarBase: 3,
          tag: "High carb, higher fiber"
        },
        {
          id: "sushi12",
          emoji: "üç£",
          name: "Sushi, 12 pieces",
          category: "Dinner, lighter",
          carbs: 70,
          fiber: 3,
          fatLevel: 0,
          sugarBase: 2,
          tag: "High carb, low fat"
        },
        {
          id: "saladLowCarb",
          emoji: "ü•ó",
          name: "Salad, low carb",
          category: "Lighter meal",
          carbs: 18,
          fiber: 6,
          fatLevel: 1,
          sugarBase: 1,
          tag: "Light"
        },
        {
          id: "proteinMeal",
          emoji: "üçó",
          name: "Protein heavy, low carb",
          category: "Chicken, fish, meat",
          carbs: 20,
          fiber: 3,
          fatLevel: 1,
          sugarBase: 1,
          tag: "Lower carb"
        },
        {
          id: "sandwich",
          emoji: "ü•™",
          name: "Sandwich",
          category: "Lunch",
          carbs: 45,
          fiber: 4,
          fatLevel: 1,
          sugarBase: 2,
          tag: "Medium carb"
        },
        {
          id: "breakfastCombo",
          emoji: "ü•ì",
          name: "Breakfast combo",
          category: "Eggs, hash browns, toast",
          carbs: 55,
          fiber: 3,
          fatLevel: 2,
          sugarBase: 2,
          tag: "Medium carb and fat"
        },
        {
          id: "cerealBowl",
          emoji: "ü•£",
          name: "Cereal bowl",
          category: "Breakfast",
          carbs: 55,
          fiber: 3,
          fatLevel: 0,
          sugarBase: 8,
          tag: "Sugary"
        },
        {
          id: "bagelCreamCheese",
          emoji: "ü•Ø",
          name: "Bagel with cream cheese",
          category: "Breakfast or snack",
          carbs: 60,
          fiber: 3,
          fatLevel: 2,
          sugarBase: 4,
          tag: "High carb"
        },
        {
          id: "smoothie",
          emoji: "ü•§",
          name: "Fruit smoothie",
          category: "Drink or snack",
          carbs: 55,
          fiber: 4,
          fatLevel: 0,
          sugarBase: 30,
          tag: "High sugar"
        },
        {
          id: "iceCreamBowl",
          emoji: "üç®",
          name: "Ice cream bowl",
          category: "Dessert",
          carbs: 45,
          fiber: 1,
          fatLevel: 2,
          sugarBase: 28,
          tag: "High sugar"
        },
        {
          id: "dessertOnly",
          emoji: "üç∞",
          name: "Dessert only",
          category: "Cake, pastry etc",
          carbs: 55,
          fiber: 1,
          fatLevel: 1,
          sugarBase: 30,
          tag: "High sugar"
        },
        {
          id: "snackPlate",
          emoji: "üßÄ",
          name: "Snack plate",
          category: "Cheese, crackers, nuts",
          carbs: 25,
          fiber: 3,
          fatLevel: 2,
          sugarBase: 3,
          tag: "Medium carb"
        },
        {
          id: "soupBread",
          emoji: "üç≤",
          name: "Soup with bread",
          category: "Lunch or dinner",
          carbs: 45,
          fiber: 3,
          fatLevel: 1,
          sugarBase: 2,
          tag: "Medium carb"
        },
        {
          id: "otherHeavyDinner",
          emoji: "üçΩÔ∏è",
          name: "Other heavy carb dinner",
          category: "General",
          carbs: 75,
          fiber: 3,
          fatLevel: 1,
          sugarBase: 3,
          tag: "Heavy"
        }
      ];

      // -----------------------------
      // State
      // -----------------------------
      let currentMode = "simple";
      let selectedMealId = "pastaPlate";
      let dessertExtraSugar = 0;
      let simpleCaffeineMg = 0;
      let drinkExtraSugar = 0;

      // -----------------------------
      // Utility helpers
      // -----------------------------
      function formatSliderLabel(value) {
        if (value <= 0) return "Low";
        if (value >= 2) return "High";
        return "Medium";
      }

      function formatScoreLevel(score) {
        if (score >= 75) return "High";
        if (score >= 50) return "Moderate";
        return "Low";
      }

      function formatTime(date) {
        if (!date) return "";
        let h = date.getHours();
        const m = date.getMinutes();
        const ampm = h >= 12 ? "pm" : "am";
        h = h % 12;
        if (h === 0) h = 12;
        const mm = m.toString().padStart(2, "0");
        return `${h}:${mm} ${ampm}`;
      }

      function minutesToDate(min) {
        const now = new Date();
        const base = new Date(
          now.getFullYear(),
          now.getMonth(),
          now.getDate(),
          0,
          0,
          0,
          0
        );
        return new Date(base.getTime() + min * 60 * 1000);
      }

      function timeInputToMinutes(inputEl) {
        const v = inputEl.value;
        if (!v) return null;
        const [h, m] = v.split(":").map((x) => parseInt(x, 10));
        if (Number.isNaN(h) || Number.isNaN(m)) return null;
        return h * 60 + m;
      }

      function setTimeInputToNow(inputEl) {
        const now = new Date();
        const hh = now.getHours().toString().padStart(2, "0");
        const mm = now.getMinutes().toString().padStart(2, "0");
        inputEl.value = `${hh}:${mm}`;
      }

      // -----------------------------
      // Rendering: foods
      // -----------------------------
      function renderFoodGrid(filterText) {
        const grid = $("foodGrid");
        grid.innerHTML = "";
        const q = (filterText || "").toLowerCase();

        mealPresets
          .filter((m) => {
            if (!q) return true;
            return (
              m.name.toLowerCase().includes(q) ||
              m.category.toLowerCase().includes(q) ||
              (m.tag || "").toLowerCase().includes(q)
            );
          })
          .forEach((meal) => {
            const card = document.createElement("button");
            card.type = "button";
            card.className =
              "food-card" + (meal.id === selectedMealId ? " selected" : "");
            card.dataset.mealId = meal.id;

            card.innerHTML = `
              <div class="food-main-line">
                <span class="food-name">${meal.name}</span>
                <span class="food-emoji">${meal.emoji}</span>
              </div>
              <div class="food-meta">
                ${meal.category}
              </div>
              <div class="food-meta">
                ~${meal.carbs} g carbs ¬∑ ~${meal.sugarBase} g sugar
              </div>
              <div class="food-tag">${meal.tag || ""}</div>
            `;

            card.addEventListener("click", () => {
              selectedMealId = meal.id;
              renderFoodGrid($("foodSearchInput").value);
              recalcAll();
            });

            grid.appendChild(card);
          });

        if (!grid.children.length) {
          const empty = document.createElement("div");
          empty.style.fontSize = "0.8rem";
          empty.style.color = "var(--text-subtle)";
          empty.textContent = "No presets match that search yet.";
          grid.appendChild(empty);
        }
      }

      // -----------------------------
      // Simple / advanced mode meal lookup
      // -----------------------------
      function getMealFromSimple() {
        if (!selectedMealId) return null;
        const preset = mealPresets.find((m) => m.id === selectedMealId);
              // ---- DOM wiring and initial setup ----
      document.addEventListener("DOMContentLoaded", () => {
        // Mode toggle
        const simpleBtn = document.getElementById("modeSimpleBtn");
        const advBtn = document.getElementById("modeAdvancedBtn");
        const simplePanel = document.getElementById("simplePanel");
        const advPanel = document.getElementById("advancedPanel");

        if (simpleBtn && advBtn && simplePanel && advPanel) {
          simpleBtn.addEventListener("click", () => setMode("simple"));
          advBtn.addEventListener("click", () => setMode("advanced"));
        }

        // Meal time
        const mealTimeInput = document.getElementById("mealTime");
        if (mealTimeInput) {
          mealTimeInput.addEventListener("change", recalcAll);
          mealTimeInput.addEventListener("input", recalcAll);
        }

        // Simple search box
        const mealSearchInput = document.getElementById("mealSearch");
        if (mealSearchInput) {
          mealSearchInput.addEventListener("input", (e) => {
            renderFoodGrid(e.target.value || "");
          });
        }

        // Dessert chips
        const dessertNone = document.getElementById("dessertNoneBtn");
        const dessertSmall = document.getElementById("dessertSmallBtn");
        const dessertBig = document.getElementById("dessertBigBtn");

        if (dessertNone && dessertSmall && dessertBig) {
          dessertNone.addEventListener("click", () => setDessert("none"));
          dessertSmall.addEventListener("click", () => setDessert("small"));
          dessertBig.addEventListener("click", () => setDessert("big"));
        }

        // Caffeine quick picks
        const cafNone = document.getElementById("cafNoneBtn");
        const cafSmall = document.getElementById("cafSmallBtn");
        const cafStrong = document.getElementById("cafStrongBtn");

        if (cafNone && cafSmall && cafStrong) {
          cafNone.addEventListener("click", () => setCaffeine("none"));
          cafSmall.addEventListener("click", () => setCaffeine("small"));
          cafStrong.addEventListener("click", () => setCaffeine("strong"));
        }

        // Sugary drink quick picks
        const drinkNone = document.getElementById("drinkNoneBtn");
        const drinkSmall = document.getElementById("drinkSmallBtn");
        const drinkBig = document.getElementById("drinkBigBtn");

        if (drinkNone && drinkSmall && drinkBig) {
          drinkNone.addEventListener("click", () => setDrink("none"));
          drinkSmall.addEventListener("click", () => setDrink("small"));
          drinkBig.addEventListener("click", () => setDrink("big"));
        }

        // Advanced numeric inputs
        const advCarbs = document.getElementById("advCarbs");
        const advSugar = document.getElementById("advSugar");
        const advCaffeine = document.getElementById("advCaffeine");
        const advFiber = document.getElementById("advFiber");
        const advFat = document.getElementById("advFat");

        [advCarbs, advSugar, advCaffeine, advFiber, advFat].forEach((el) => {
          if (el) {
            el.addEventListener("input", recalcAll);
            el.addEventListener("change", recalcAll);
          }
        });

        // Sliders and labels
        const dayCarbSlider = document.getElementById("dayCarbSlider");
        const visceralSlider = document.getElementById("visceralSlider");
        const anxietySlider = document.getElementById("anxietySlider");

        const dayCarbLabel = document.getElementById("dayCarbLabel");
        const visceralLabel = document.getElementById("visceralLabel");
        const anxietyLabel = document.getElementById("anxietyLabel");

        function sliderLabel(val) {
          const n = Number(val);
          if (n <= 0.3) return "Low";
          if (n <= 0.7) return "Medium";
          return "High";
        }

        function updateSliderLabels() {
          if (dayCarbSlider && dayCarbLabel) {
            dayCarbLabel.textContent = sliderLabel(dayCarbSlider.value);
          }
          if (visceralSlider && visceralLabel) {
            visceralLabel.textContent = sliderLabel(visceralSlider.value);
          }
          if (anxietySlider && anxietyLabel) {
            anxietyLabel.textContent = sliderLabel(anxietySlider.value);
          }
        }

        [dayCarbSlider, visceralSlider, anxietySlider].forEach((el) => {
          if (el) {
            el.addEventListener("input", () => {
              updateSliderLabels();
              recalcAll();
            });
          }
        });

        // "Why am I feeling this way?" toggle
        const whyBtn = document.getElementById("whyBtn");
        const whyPanel = document.getElementById("whyPanel");
        if (whyBtn && whyPanel) {
          whyBtn.addEventListener("click", () => {
            const hidden = whyPanel.classList.contains("hidden");
            whyPanel.classList.toggle("hidden", !hidden);
            whyBtn.classList.toggle("active", hidden);
          });
        }

        // Recalculate button (bigger, front and center)
        const recalcBtn = document.getElementById("recalcBtn");
        if (recalcBtn) {
          recalcBtn.addEventListener("click", recalcAll);
        }

        // Default selections so the UI does not look empty
        try {
          if (typeof setMode === "function") setMode("simple");
          if (typeof setDessert === "function") setDessert("none");
          if (typeof setCaffeine === "function") setCaffeine("none");
          if (typeof setDrink === "function") setDrink("none");
          if (typeof renderFoodGrid === "function") renderFoodGrid("");
        } catch (e) {
          console.warn("Init helper error:", e);
        }

        updateSliderLabels();
        recalcAll();
      });
