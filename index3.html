<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Carb / Sugar Anxiety Timing Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      font-size: 18px;
      --bg: #020617;
      --bg-soft: #020817;
      --card: #0b1220;
      --card-soft: #0f172a;
      --border-subtle: rgba(148, 163, 184, 0.45);
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --text-subtle: #6b7280;
      --accent: #38bdf8;
      --accent-soft: #1d4ed8;
      --accent-green: #22c55e;
      --accent-yellow: #eab308;
      --accent-red: #ef4444;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 20px 10px 36px;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 55%);
      color: var(--text-main);
    }

    .shell {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      font-size: 1.6rem;
      margin: 0 0 4px;
      letter-spacing: 0.13em;
      text-transform: uppercase;
    }

    h2 {
      font-size: 1.12rem;
      margin: 0 0 6px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    h3 {
      font-size: 0.96rem;
      margin: 12px 0 4px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    p {
      margin: 4px 0;
      font-size: 0.9rem;
      color: var(--text-soft);
    }

    .tagline {
      font-size: 0.85rem;
      color: var(--text-subtle);
      margin-bottom: 10px;
    }

    .focus-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 12px;
    }

    .pill {
      font-size: 0.78rem;
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-subtle);
      background: rgba(15, 23, 42, 0.95);
      white-space: nowrap;
    }

    .app-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 10px;
    }

    @media (max-width: 950px) {
      .app-grid {
        grid-template-columns: minmax(0, 1fr);
      }
          /* Make the right column float / stay visible while scrolling */
    #right-column {
      position: sticky;
      top: 10px;          /* distance from top of the screen */
      align-self: flex-start;
      height: fit-content;
    }

    /* Turn off sticky on smaller screens so it does not act weird */
    @media (max-width: 950px) {
      #right-column {
        position: static;
      }
    }
    }

    .card {
      background: radial-gradient(circle at top left, #111827, #020617);
      border-radius: 18px;
      padding: 12px 14px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.75);
    }

    .card-tight {
      padding-top: 9px;
      padding-bottom: 10px;
    }

    .section-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--text-subtle);
      margin-bottom: 8px;
    }

    .subtext {
      font-size: 0.8rem;
      color: var(--text-subtle);
    }

    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
    }

    .row-wrap {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .mode-toggle {
      display: inline-flex;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 2px;
      background: #020617;
    }

    .mode-toggle button {
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: 0.78rem;
      padding: 4px 10px;
      border-radius: 999px;
    }

    .mode-toggle button.active {
      background: var(--accent);
      color: #000;
      font-weight: 600;
    }

    .field-label {
      font-size: 0.82rem;
      color: var(--text-main);
      margin-top: 6px;
      margin-bottom: 4px;
    }

    input[type="time"],
    input[type="number"],
    input[type="text"] {
      width: 100%;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: #020617;
      padding: 6px 10px;
      color: var(--text-main);
      font-size: 0.86rem;
      outline: none;
    }

    input[type="number"] {
      border-radius: 10px;
    }

    input::placeholder {
      color: var(--text-subtle);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .chip {
      border-radius: 999px;
      font-size: 0.8rem;
      padding: 4px 9px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: #020617;
      color: var(--text-soft);
      cursor: pointer;
      white-space: nowrap;
    }

    .chip.selected {
      background: var(--accent);
      color: #000;
      border-color: transparent;
      font-weight: 600;
    }

    .chip-soft {
      background: #020617;
      border-style: dashed;
    }

    .chips-3 {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }
        .chip-3 {
      flex: 1;
      text-align: center;
    }

    .chip-3 button {
      width: 100%;
      border-radius: 999px;
      padding: 5px 6px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: #020617;
      color: var(--text-soft);
      font-size: 0.78rem;
    }

    .chip-3 button.selected {
      background: var(--accent);
      color: #000;
      border-color: transparent;
      font-weight: 600;
    }

    .preset-grid {
      margin-top: 6px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 6px;
    }

    .preset-card {
      border-radius: 12px;
      background: #020617;
      border: 1px solid rgba(148, 163, 184, 0.7);
      padding: 6px 8px 7px;
      font-size: 0.78rem;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .preset-card.selected {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent);
      background: radial-gradient(circle at top left, #0f172a, #020617);
    }

    .preset-title {
      font-weight: 600;
      color: var(--text-main);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .preset-meta {
      color: var(--text-subtle);
    }

    .preset-tag {
      font-size: 0.7rem;
      color: var(--accent-yellow);
    }

    .pill-small {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-subtle);
    }

    .divider {
      height: 1px;
      margin: 8px 0;
      background: radial-gradient(circle at left, rgba(148, 163, 184, 0.8), transparent);
      opacity: 0.7;
    }

    .badge-green {
      background: var(--accent-green);
      color: #000;
      border-radius: 999px;
      padding: 3px 10px;
      font-size: 0.8rem;
      font-weight: 600;
      display: inline-block;
    }

    .gauge-bar {
      position: relative;
      height: 14px;
      border-radius: 999px;
      background: linear-gradient(to right, #22c55e, #eab308, #ef4444);
      margin-top: 6px;
      margin-bottom: 2px;
    }

    .gauge-marker {
      position: absolute;
      top: -2px;
      width: 2px;
      bottom: -2px;
      background: #e5e7eb;
      box-shadow: 0 0 0 2px rgba(15, 23, 42, 0.8);
    }

    .gauge-label-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.72rem;
      color: var(--text-subtle);
      margin-bottom: 4px;
    }

    .big-score {
      font-size: 1.7rem;
      font-weight: 700;
      margin: 4px 0 2px;
    }

    .timeline-bar {
      position: relative;
      height: 14px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.6);
      margin-top: 4px;
    }

    .segment {
      position: absolute;
      top: 0;
      bottom: 0;
    }

    .seg-spike {
      background: #eab308;
    }

    .seg-crash {
      background: #f97316;
    }

    .seg-recover {
      background: #38bdf8;
    }

    .timeline-legend {
      margin-top: 5px;
      font-size: 0.78rem;
      color: var(--text-subtle);
    }

    .timeline-legend span {
      margin-right: 12px;
      white-space: nowrap;
    }

    .dot {
      display: inline-block;
      width: 9px;
      height: 9px;
      border-radius: 999px;
      margin-right: 3px;
    }

    .dot-yellow { background: #eab308; }
    .dot-orange { background: #f97316; }
    .dot-blue { background: #38bdf8; }

    .summary-text {
      font-size: 0.86rem;
      color: var(--text-soft);
    }

    .summary-text strong {
      color: #e5e7eb;
    }

    .why-btn {
      margin-top: 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: #020617;
      color: var(--text-main);
      padding: 7px 12px;
      font-size: 0.82rem;
      cursor: pointer;
    }

    .why-btn:hover {
      border-color: var(--accent);
    }

    footer {
      margin-top: 10px;
      font-size: 0.7rem;
      color: var(--text-subtle);
      text-align: left;
    }
  </style>
</head>

<body>
  <div class="shell">
    <header style="margin-bottom: 10px;">
      <h1>CARB / SUGAR ANXIETY TIMING EXPLORER</h1>
      <div class="tagline">
        Rough, biology-informed estimate of when carbs, added sugar, caffeine, and sensitivity
        might create a spike ‚Üí crash ‚Üí anxiety window. Not medical advice; just a pattern explorer.
      </div>
      <div class="focus-pills">
        <span class="pill">Focus: post-meal hours, not psychology</span>
        <span class="pill">Built for sensitive gut / nervous system people</span>
      </div>
    </header>

    <div class="app-grid">
      <!-- LEFT SIDE: INPUTS -->
      <div id="left-column">
        <div class="card card-tight">
          <div class="row">
            <div class="section-label">Meal and pattern</div>
            <div class="mode-toggle" id="modeToggle">
              <button type="button" data-mode="simple" class="active">Simple (pick a meal)</button>
              <button type="button" data-mode="advanced">Advanced (exact grams)</button>
            </div>
          </div>

          <div class="field-label">What time did you eat this meal?</div>
          <input type="time" id="mealTime" />

          <div id="simpleMode">
            <div class="field-label" style="margin-top: 8px;">
              Simple: what did the meal look like?
            </div>
            <input type="text" id="mealSearch" placeholder="Search (pizza, pasta, sushi, salad, soda...)" />
            <div class="preset-grid" id="presetGrid"></div>
            <p class="subtext" id="selectedMealText">No meal selected yet.</p>
          </div>

          <div id="advancedMode" style="display:none; margin-top: 6px;">
            <div class="field-label">Rough grams for this meal</div>
            <div class="row" style="gap:8px;">
              <div style="flex:1;">
                <span class="subtext">Carbs (g)</span>
                <input type="number" id="advCarbs" min="0" max="200" value="60" />
              </div>
              <div style="flex:1;">
                <span class="subtext">Added sugar (g)</span>
                <input type="number" id="advSugar" min="0" max="150" value="10" />
              </div>
              <div style="flex:1;">
                <span class="subtext">Caffeine (mg)</span>
                <input type="number" id="advCaff" min="0" max="400" value="0" />
              </div>
            </div>
            <p class="subtext">
              These do not have to be perfect. Rough guesses are fine; the model is meant for patterns,
              not precise lab values.
            </p>
          </div>
        </div>
                <div class="card card-tight" style="margin-top: 8px;">
          <div class="section-label">Did you add dessert?</div>
          <div class="chip-row" id="dessertGroup">
            <button type="button" class="chip selected" data-dessert="none">No dessert</button>
            <button type="button" class="chip" data-dessert="small">Small dessert (~10 g sugar)</button>
            <button type="button" class="chip" data-dessert="big">Big dessert (~35 g sugar)</button>
          </div>
          <p class="subtext">
            Big dessert might be a bowl of ice cream, a big slice of cake, or 2-3 cookies.
          </p>
        </div>

        <div class="card card-tight" style="margin-top: 8px;">
          <div class="section-label">Coffee and sugary drink around this meal</div>

          <div class="field-label" style="margin-top:0;">Caffeine or strong drink?</div>
          <div class="chip-row" id="caffeineGroup">
            <button type="button" class="chip selected" data-caff="none">No caffeine</button>
            <button type="button" class="chip" data-caff="small">Small coffee or tea</button>
            <button type="button" class="chip" data-caff="strong">Strong coffee / energy drink</button>
          </div>

          <div class="field-label" style="margin-top:8px;">Sugary drink with or after this meal?</div>
          <div class="chip-row" id="drinkSugarGroup">
            <button type="button" class="chip selected" data-drink="none">No sugary drink</button>
            <button type="button" class="chip" data-drink="one">One soda or sweet drink</button>
            <button type="button" class="chip" data-drink="big">Big or multiple sweet drinks</button>
          </div>

          <p class="subtext">
            Think of drinks you had within a few hours of this plate.
          </p>
        </div>

        <div class="card card-tight" style="margin-top: 8px;">
          <div class="section-label">Rest of day and sensitivity</div>

          <div class="field-label">How carb-heavy has the rest of your day been?</div>
          <div class="chips-3" id="restCarbGroup">
            <div class="chip-3">
              <button type="button" data-val="0">Low</button>
            </div>
            <div class="chip-3">
              <button type="button" data-val="1" class="selected">Medium</button>
            </div>
            <div class="chip-3">
              <button type="button" data-val="2">High</button>
            </div>
          </div>
          <p class="subtext">
            0 = mostly light / low carb so far, 2 = lots of bread, pasta, sweets, snacks earlier.
          </p>

          <div class="field-label" style="margin-top:6px;">Visceral sensitivity (gut volume knob)</div>
          <div class="chips-3" id="visceralGroup">
            <div class="chip-3">
              <button type="button" data-val="0">Low</button>
            </div>
            <div class="chip-3">
              <button type="button" data-val="1" class="selected">Medium</button>
            </div>
            <div class="chip-3">
              <button type="button" data-val="2">High</button>
            </div>
          </div>
          <p class="subtext">
            0 = gut rarely complains, 2 = gut feels every bubble and stretch.
          </p>

          <div class="field-label" style="margin-top:6px;">Anxiety system sensitivity</div>
          <div class="chips-3" id="anxietyGroup">
            <div class="chip-3">
              <button type="button" data-val="0">Low</button>
            </div>
            <div class="chip-3">
              <button type="button" data-val="1" class="selected">Medium</button>
            </div>
            <div class="chip-3">
              <button type="button" data-val="2">High</button>
            </div>
          </div>
          <p class="subtext">
            0 = rarely anxious, 2 = nervous system that notices every little crash.
          </p>
        </div>
      </div>
            <!-- RIGHT SIDE: OUTPUTS -->
      <div id="right-column">
        <div class="card card-tight">
          <div class="row">
            <div class="section-label">Risk gauge</div>
            <div class="subtext">0 to 49 Low, 50 to 74 Moderate, 75 plus High</div>
          </div>

          <div class="gauge-label-row">
            <span>Low</span>
            <span>25</span>
            <span>50</span>
            <span>75</span>
            <span>100</span>
          </div>
          <div class="gauge-bar">
            <div id="gaugeMarker" class="gauge-marker" style="left:0%;"></div>
          </div>

          <div class="big-score" id="bigScore">0 / 100</div>
          <div class="row-wrap" style="margin-top:2px;">
            <span id="scoreLine" class="subtext">Current score 0 of 100</span>
            <span id="scoreBadge" class="badge-green">Low</span>
          </div>

          <p id="biologyLine">
            Biology says this pattern should feel fairly steady for most people.
          </p>
        </div>

        <div class="card card-tight" style="margin-top: 8px;">
          <h2>Spike ‚Üí crash ‚Üí recovery timeline</h2>
          <div class="timeline-bar">
            <div id="segSpike" class="segment seg-spike"></div>
            <div id="segCrash" class="segment seg-crash"></div>
            <div id="segRecover" class="segment seg-recover"></div>
          </div>
          <div class="timeline-legend">
            <span><span class="dot dot-yellow"></span>Spike window</span>
            <span><span class="dot dot-orange"></span>Crash / anxiety window</span>
            <span><span class="dot dot-blue"></span>Recovery</span>
          </div>

          <div class="divider"></div>

          <div class="row-wrap" style="font-size:0.86rem; margin-top:4px;">
            <div style="flex:1; min-width:160px;">
              <strong>Spike window</strong>
              <div id="spikeText" class="subtext">-</div>
            </div>
            <div style="flex:1; min-width:160px;">
              <strong>Crash / anxiety window</strong>
              <div id="crashText" class="subtext">-</div>
            </div>
          </div>
          <div style="margin-top:6px;">
            <strong style="font-size:0.86rem;">Recovery trend</strong>
            <div id="recoveryText" class="subtext">-</div>
          </div>
        </div>

        <div class="card card-tight" style="margin-top: 8px;">
          <h2>Quick summary</h2>
          <p id="quickSummary" class="summary-text">
            0/100 risk in the 1 to 4 hour window after this meal.
          </p>
          <p class="summary-text" id="quickBody">
            No meal selected yet. Once you choose a plate or enter grams, the tool will show how carb load,
            sugar, caffeine, and your sensitivity pattern might add up.
          </p>
          <button type="button" class="why-btn" id="whyBtn">Why am I feeling this way?</button>
          <p id="whyText" class="summary-text" style="margin-top:8px; display:none;">
            Many people are never told that blood sugar drops, gut nerve signals, and adrenaline chemistry
            can combine to feel like a mental health crisis. This tool is here to give language to that body
            pattern so you can separate the wave from your identity.
          </p>
        </div>

        <div class="card card-tight" style="margin-top: 8px;">
          <h2>What this is and is not</h2>
          <p class="summary-text">
            This is a rough timing model for people who notice that carbs, sugar, and caffeine can create
            waves of anxiety a couple of hours later, especially if they also have IBS or visceral
            hypersensitivity.
          </p>
          <p class="summary-text">
            It is not a diagnosis. If you ever have chest pain, severe shortness of breath, or feel unsafe,
            that is an emergency issue for real-world care, not a timing calculator.
          </p>
        </div>
      </div>
    </div>

    <footer>
      ¬© 2025 Darkstar747. Free for personal use and community sharing. Not for commercial use, resale, or
      paywalled distribution. Do not repurpose this work for any product or service that charges money.
    </footer>
  </div>
  <script>
  // ----- STATE -----
  const state = {
    mode: "simple",
    mealId: null,
    advCarbs: 60,
    advSugar: 10,
    advCaff: 0,
    dessert: "none",
    caffeine: "none",
    drinkSugar: "none",
    restCarb: 1,
    visceral: 1,
    anxiety: 1,
    mealTimeMinutes: null
  };

  // ----- MEAL PRESETS (compact but broad coverage) -----
  const mealPresets = [
    { id: "pastaPlate", emoji: "üçù", name: "Plate of pasta", category: "Dinner, Italian", carbs: 80, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
    { id: "pastaRed", emoji: "üçù", name: "Pasta with tomato sauce", category: "Italian dinner", carbs: 80, fiber: 4, fatLevel: 1, sugarBase: 4, tag: "High carb" },
    { id: "pastaAlfredo", emoji: "üçù", name: "Pasta with Alfredo sauce", category: "Italian, creamy", carbs: 80, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "High carb and fat" },
    { id: "lasagna", emoji: "üçù", name: "Lasagna", category: "Italian, baked", carbs: 70, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "High carb and fat" },

    { id: "riceBowl", emoji: "üçö", name: "Rice bowl", category: "Lunch or dinner", carbs: 70, fiber: 2, fatLevel: 0, sugarBase: 2, tag: "High carb" },
    { id: "friedRice", emoji: "üçõ", name: "Fried rice", category: "Takeout, Chinese", carbs: 75, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "High carb" },
    { id: "orangeChickenRice", emoji: "üçõ", name: "Orange chicken plus rice", category: "Takeout, Chinese", carbs: 85, fiber: 3, fatLevel: 2, sugarBase: 10, tag: "High carb and sugar" },
    { id: "ramen", emoji: "üçú", name: "Ramen or noodle bowl", category: "Dinner, noodles", carbs: 65, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
    { id: "pho", emoji: "üçú", name: "Pho bowl", category: "Vietnamese soup", carbs: 60, fiber: 3, fatLevel: 1, sugarBase: 2, tag: "High carb" },

    { id: "pizza2", emoji: "üçï", name: "Pizza, 2 slices", category: "Dinner, pizza", carbs: 60, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "High carb and fat" },
    { id: "pizza3", emoji: "üçï", name: "Pizza, 3 slices", category: "Pizza dinner", carbs: 90, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "Very high carb and fat" },
    { id: "burgerFries", emoji: "üçî", name: "Burger with fries", category: "Fast food", carbs: 70, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "Heavy" },
    { id: "burgerOnly", emoji: "üçî", name: "Burger, no fries", category: "Fast food", carbs: 45, fiber: 2, fatLevel: 2, sugarBase: 2, tag: "Medium carb" },
    { id: "burrito", emoji: "üåØ", name: "Burrito", category: "Mexican style", carbs: 75, fiber: 6, fatLevel: 2, sugarBase: 3, tag: "High carb" },
    { id: "tacos3", emoji: "üåÆ", name: "Tacos, 2-3", category: "Mexican style", carbs: 45, fiber: 4, fatLevel: 1, sugarBase: 2, tag: "Medium carb" },
    { id: "chipotleBowl", emoji: "ü•ó", name: "Burrito bowl", category: "Mexican bowl", carbs: 65, fiber: 7, fatLevel: 2, sugarBase: 3, tag: "High carb, higher fiber" },

    { id: "sushi12", emoji: "üç£", name: "Sushi, 12 pieces", category: "Dinner, lighter", carbs: 70, fiber: 3, fatLevel: 0, sugarBase: 2, tag: "High carb, low fat" },
    { id: "pokeBowl", emoji: "üçö", name: "Poke bowl", category: "Rice bowl", carbs: 60, fiber: 4, fatLevel: 1, sugarBase: 4, tag: "High carb" },

    { id: "saladLow", emoji: "ü•ó", name: "Salad, low carb", category: "Lighter meal", carbs: 18, fiber: 6, fatLevel: 1, sugarBase: 1, tag: "Light" },
    { id: "proteinPlate", emoji: "üçó", name: "Protein heavy, low carb", category: "Chicken, fish, meat", carbs: 20, fiber: 3, fatLevel: 1, sugarBase: 1, tag: "Lower carb" },
    { id: "steakPotato", emoji: "ü•©", name: "Steak with potato", category: "Dinner plate", carbs: 50, fiber: 4, fatLevel: 2, sugarBase: 1, tag: "Medium carb, high fat" },

    { id: "breakfastCombo", emoji: "ü•ì", name: "Breakfast combo", category: "Eggs, hash browns, toast", carbs: 55, fiber: 3, fatLevel: 2, sugarBase: 2, tag: "Medium carb and fat" },
    { id: "oatmealFruit", emoji: "ü•£", name: "Oatmeal with fruit", category: "Breakfast, warm", carbs: 45, fiber: 6, fatLevel: 0, sugarBase: 8, tag: "Medium carb, higher fiber" },
    { id: "cerealBowl", emoji: "ü•£", name: "Cereal bowl", category: "Breakfast", carbs: 55, fiber: 3, fatLevel: 0, sugarBase: 8, tag: "Sugary" },
    { id: "bagelCream", emoji: "ü•Ø", name: "Bagel with cream cheese", category: "Breakfast or snack", carbs: 60, fiber: 3, fatLevel: 2, sugarBase: 4, tag: "High carb" },

    { id: "smoothie", emoji: "ü•§", name: "Fruit smoothie", category: "Drink or snack", carbs: 55, fiber: 4, fatLevel: 0, sugarBase: 30, tag: "High sugar" },
    { id: "iceCream", emoji: "üç®", name: "Ice cream bowl", category: "Dessert", carbs: 45, fiber: 1, fatLevel: 2, sugarBase: 28, tag: "High sugar" },
    { id: "dessertPlate", emoji: "üç∞", name: "Dessert plate", category: "Cake, pastry, etc", carbs: 55, fiber: 1, fatLevel: 1, sugarBase: 30, tag: "High sugar" },

    { id: "snackPlate", emoji: "üßÄ", name: "Snack plate", category: "Cheese, crackers, nuts", carbs: 25, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "Medium carb" },
    { id: "chipsBag", emoji: "üçü", name: "Bag of chips", category: "Snack", carbs: 30, fiber: 2, fatLevel: 2, sugarBase: 1, tag: "Medium carb, high fat" },
    { id: "popcorn", emoji: "üçø", name: "Bowl of popcorn", category: "Snack", carbs: 25, fiber: 4, fatLevel: 1, sugarBase: 1, tag: "Medium carb" },

    { id: "sodaCan", emoji: "ü•§", name: "Soda, 12 oz can", category: "Sugary drink", carbs: 39, fiber: 0, fatLevel: 0, sugarBase: 39, tag: "High sugar" },
    { id: "sodaLarge", emoji: "ü•§", name: "Soda, large", category: "Sugary drink", carbs: 60, fiber: 0, fatLevel: 0, sugarBase: 60, tag: "Very high sugar" },
    { id: "sweetTea", emoji: "ü•§", name: "Sweet tea", category: "Sugary drink", carbs: 35, fiber: 0, fatLevel: 0, sugarBase: 35, tag: "High sugar" },

    { id: "blackCoffee", emoji: "‚òïÔ∏è", name: "Black coffee", category: "Coffee, no sugar", carbs: 0, fiber: 0, fatLevel: 0, sugarBase: 0, tag: "No sugar" },
    { id: "latte", emoji: "‚òïÔ∏è", name: "Latte drink", category: "Coffee drink", carbs: 18, fiber: 0, fatLevel: 1, sugarBase: 15, tag: "Medium sugar" },

    { id: "otherHeavy", emoji: "üçΩÔ∏è", name: "Other heavy carb dinner", category: "General", carbs: 75, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "Heavy" },
    { id: "otherLight", emoji: "ü•ó", name: "Other lighter plate", category: "General", carbs: 25, fiber: 4, fatLevel: 1, sugarBase: 2, tag: "Light to medium carb" }
  ];

  // ----- HELPERS -----
  function clamp(v, min, max) {
    return Math.max(min, Math.min(max, v));
  }

  function scoreToLabel(score) {
    if (score < 25) return "Low";
    if (score < 50) return "Mild";
    if (score < 75) return "Moderate";
    if (score < 90) return "High";
    return "Very high";
  }

  function labelColor(label) {
    if (label === "Low" || label === "Mild") return "#22c55e";
    if (label === "Moderate") return "#eab308";
    if (label === "High") return "#f97316";
    return "#ef4444";
  }

  function parseTimeToMinutes(timeStr) {
    if (!timeStr) return null;
    const [hStr, mStr] = timeStr.split(":");
    const h = parseInt(hStr, 10);
    const m = parseInt(mStr, 10);
    if (Number.isNaN(h) || Number.isNaN(m)) return null;
    return h * 60 + m;
  }

  function formatMinutesAsTime(minutes) {
    if (minutes == null) return "-";
    const mins = ((minutes % 1440) + 1440) % 1440;
    let h = Math.floor(mins / 60);
    const m = mins % 60;
    const ampm = h >= 12 ? "pm" : "am";
    h = h % 12;
    if (h === 0) h = 12;
    const mStr = m.toString().padStart(2, "0");
    return `${h}:${mStr} ${ampm}`;
  }

  function describeBiology(score) {
    if (score < 25) {
      return "Biology says this pattern should feel fairly steady for most people.";
    } else if (score < 50) {
      return "Biology says this pattern might create a light wave, but many people will ride it out without much drama.";
    } else if (score < 75) {
      return "Biology says this pattern could produce a noticeable wave in the 1-3 hour window after this meal.";
    } else {
      return "Biology says this pattern is heavy on carbs, sugar, and/or stimulants. Sensitive guts and nervous systems may feel this strongly.";
    }
  }
      // ----- RENDER PRESETS -----
  const presetGrid = document.getElementById("presetGrid");
  const mealSearch = document.getElementById("mealSearch");
  const selectedMealText = document.getElementById("selectedMealText");

  function renderPresets() {
    const q = mealSearch.value.trim().toLowerCase();
    presetGrid.innerHTML = "";
    mealPresets
      .filter(m => {
        if (!q) return true;
        return (
          m.name.toLowerCase().includes(q) ||
          m.category.toLowerCase().includes(q) ||
          (m.tag && m.tag.toLowerCase().includes(q))
        );
      })
      .forEach(m => {
        const div = document.createElement("div");
        div.className = "preset-card" + (state.mealId === m.id ? " selected" : "");
        div.dataset.id = m.id;
        div.innerHTML = `
          <div class="preset-title">
            <span>${m.emoji} ${m.name}</span>
            <span class="pill-small">${m.tag}</span>
          </div>
          <div class="preset-meta">${m.category}</div>
          <div class="preset-meta">~${m.carbs} g carbs ‚Ä¢ ~${m.sugarBase} g sugar</div>
        `;
        presetGrid.appendChild(div);
      });
  }

  mealSearch.addEventListener("input", renderPresets);
  presetGrid.addEventListener("click", (e) => {
    const card = e.target.closest(".preset-card");
    if (!card) return;
    state.mealId = card.dataset.id;
    renderPresets();
    const meal = mealPresets.find(m => m.id === state.mealId);
    if (meal) {
      selectedMealText.textContent = `Selected meal: ${meal.name}. Tap the option that feels closest. You can still tweak sugar, caffeine, and sensitivity below.`;
    }
    computeAndUpdate();
  });

  // ----- MODE TOGGLE -----
  const simpleMode = document.getElementById("simpleMode");
  const advancedMode = document.getElementById("advancedMode");
  document.getElementById("modeToggle").addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-mode]");
    if (!btn) return;
    const mode = btn.dataset.mode;
    state.mode = mode;

    document.querySelectorAll("#modeToggle button").forEach(b => {
      b.classList.toggle("active", b.dataset.mode === mode);
    });

    if (mode === "simple") {
      simpleMode.style.display = "";
      advancedMode.style.display = "none";
    } else {
      simpleMode.style.display = "none";
      advancedMode.style.display = "";
    }
    computeAndUpdate();
  });

  // ----- SIMPLE GROUP HELPERS -----
  function attachChipGroup(groupId, key, attrName) {
    const group = document.getElementById(groupId);
    group.addEventListener("click", (e) => {
      const chip = e.target.closest(".chip");
      if (!chip) return;
      const val = chip.getAttribute(attrName);
      state[key] = val;
      group.querySelectorAll(".chip").forEach(c => c.classList.remove("selected"));
      chip.classList.add("selected");
      computeAndUpdate();
    });
  }

  attachChipGroup("dessertGroup", "dessert", "data-dessert");
  attachChipGroup("caffeineGroup", "caffeine", "data-caff");
  attachChipGroup("drinkSugarGroup", "drinkSugar", "data-drink");

  function attachThreeButtons(groupId, key) {
    const group = document.getElementById(groupId);
    group.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-val]");
      if (!btn) return;
      const v = parseInt(btn.dataset.val, 10);
      state[key] = v;
      group.querySelectorAll("button[data-val]").forEach(b => {
        b.classList.toggle("selected", b === btn);
      });
      computeAndUpdate();
    });
  }

  attachThreeButtons("restCarbGroup", "restCarb");
  attachThreeButtons("visceralGroup", "visceral");
  attachThreeButtons("anxietyGroup", "anxiety");

  // ----- TIME AND ADVANCED INPUTS -----
  const mealTimeInput = document.getElementById("mealTime");
  mealTimeInput.addEventListener("change", () => {
    state.mealTimeMinutes = parseTimeToMinutes(mealTimeInput.value);
    computeAndUpdate();
  });

  document.getElementById("advCarbs").addEventListener("input", (e) => {
    state.advCarbs = parseFloat(e.target.value) || 0;
    computeAndUpdate();
  });
  document.getElementById("advSugar").addEventListener("input", (e) => {
    state.advSugar = parseFloat(e.target.value) || 0;
    computeAndUpdate();
  });
  document.getElementById("advCaff").addEventListener("input", (e) => {
    state.advCaff = parseFloat(e.target.value) || 0;
    computeAndUpdate();
  });

  // ----- WHY BUTTON -----
  const whyBtn = document.getElementById("whyBtn");
  const whyText = document.getElementById("whyText");
  whyBtn.addEventListener("click", () => {
    const showing = whyText.style.display === "block";
    whyText.style.display = showing ? "none" : "block";
  });

  // ----- CORE MATH -----
  function getMealNumbers() {
    let carbs = 0;
    let sugar = 0;

    if (state.mode === "simple") {
      const meal = mealPresets.find(m => m.id === state.mealId);
      if (meal) {
        carbs = meal.carbs;
        sugar = meal.sugarBase;
      }
    } else {
      carbs = state.advCarbs || 0;
      sugar = state.advSugar || 0;
    }

    // Dessert sugar
    if (state.dessert === "small") sugar += 10;
    else if (state.dessert === "big") sugar += 35;

    // Drink sugar
    if (state.drinkSugar === "one") sugar += 35;
    else if (state.drinkSugar === "big") sugar += 60;

    // Caffeine mg estimate
    let caffMg = 0;
    if (state.mode === "advanced") {
      caffMg = state.advCaff || 0;
    } else {
      if (state.caffeine === "small") caffMg = 80; // one coffee or tea
      else if (state.caffeine === "strong") caffMg = 160; // big coffee or energy drink
    }

    return { carbs, sugar, caffMg };
  }

  function computeScore() {
    const { carbs, sugar, caffMg } = getMealNumbers();

    // Carbs contribute up to 60 points
    const carbScore = clamp(carbs * 0.6, 0, 60);

    // Added sugar contributes up to 25 points
    const sugarScore = clamp(sugar * 0.8, 0, 25);

    // Caffeine contributes up to 15 points
    const caffScore = clamp(caffMg * 0.1, 0, 15);

    // Day carb stacking, visceral, and anxiety sensitivity
    const restScore = state.restCarb * 7;     // 0-14
    const viscScore = state.visceral * 8;     // 0-16
    const anxScore = state.anxiety * 10;      // 0-20

    let raw = carbScore + sugarScore + caffScore + restScore + viscScore + anxScore;

    // Normalize a bit: heavy meals can push above 100
    raw = clamp(raw, 0, 120);
    const finalScore = clamp(Math.round(raw * (100 / 120)), 0, 100);
    return finalScore;
  }

  function computeTimeline() {
    let base = state.mealTimeMinutes;
    if (base == null) {
      // Use "now" as a placeholder if no time entered
      const now = new Date();
      base = now.getHours() * 60 + now.getMinutes();
    }
    // Simple model: spike 30-75 min, crash 75-150, recovery 150-300
    const spikeStart = base + 30;
    const spikeEnd = base + 75;
    const crashStart = spikeEnd;
    const crashEnd = base + 150;
    const recStart = crashEnd;
    const recEnd = base + 300;
    return { spikeStart, spikeEnd, crashStart, crashEnd, recStart, recEnd };
  }

  // ----- UPDATE UI -----
  function computeAndUpdate() {
    const score = computeScore();
    const label = scoreToLabel(score);

    const bigScoreEl = document.getElementById("bigScore");
    const scoreLine = document.getElementById("scoreLine");
    const scoreBadge = document.getElementById("scoreBadge");
    const gaugeMarker = document.getElementById("gaugeMarker");
    const biologyLine = document.getElementById("biologyLine");

    bigScoreEl.textContent = `${score} / 100`;
    scoreLine.textContent = `Current score ${score} of 100`;
    scoreBadge.textContent = label;
    scoreBadge.style.background = labelColor(label);
    gaugeMarker.style.left = `${clamp(score, 0, 100)}%`;
    biologyLine.textContent = describeBiology(score);

    // Timeline
    const { spikeStart, spikeEnd, crashStart, crashEnd, recStart, recEnd } = computeTimeline();
    document.getElementById("spikeText").textContent =
      `${formatMinutesAsTime(spikeStart)} - ${formatMinutesAsTime(spikeEnd)}`;
    document.getElementById("crashText").textContent =
      `${formatMinutesAsTime(crashStart)} - ${formatMinutesAsTime(crashEnd)}`;
    document.getElementById("recoveryText").textContent =
      `${formatMinutesAsTime(recStart)} - ${formatMinutesAsTime(recEnd)}`;

    // Timeline bar percentages
    const total = recEnd - spikeStart;
    const spikePct = ((spikeEnd - spikeStart) / total) * 100;
    const crashPct = ((crashEnd - crashStart) / total) * 100;
    const recPct = ((recEnd - recStart) / total) * 100;

    const segSpike = document.getElementById("segSpike");
    const segCrash = document.getElementById("segCrash");
    const segRecover = document.getElementById("segRecover");

    segSpike.style.left = "0%";
    segSpike.style.width = `${spikePct}%`;

    segCrash.style.left = `${spikePct}%`;
    segCrash.style.width = `${crashPct}%`;

    segRecover.style.left = `${spikePct + crashPct}%`;
    segRecover.style.width = `${recPct}%`;

    // Quick summary text
    const quickSummary = document.getElementById("quickSummary");
    const quickBody = document.getElementById("quickBody");

    quickSummary.textContent =
      `${score}/100 risk in the 1 to 4 hour window after this meal.`;

    const { carbs, sugar, caffMg } = getMealNumbers();
    const pieces = [];

    if (carbs >= 70) pieces.push("heavy carb plate");
    else if (carbs >= 40) pieces.push("medium carb plate");
    else if (carbs > 0) pieces.push("lighter carb plate");

    if (sugar >= 35) pieces.push("high sugar hit");
    else if (sugar >= 15) pieces.push("moderate sugar");

    if (caffMg >= 150) pieces.push("strong caffeine");
    else if (caffMg >= 60) pieces.push("moderate caffeine");

    const stackDesc = pieces.length ? pieces.join(", plus ") : "light intake";

    quickBody.textContent =
      `${stackDesc}, adjusted by how carb heavy the rest of the day is and how sensitive your gut and anxiety system are. This is not a diagnosis; it is just a timing map to explain how a wave can show up even when the day felt mentally fine.`;
  }

  // ----- INIT -----
  renderPresets();
  computeAndUpdate();
</script>
</body>
</html>
    
