<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Carb / Sugar Anxiety Timing Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Free timing calculator that turns carbs, sugar, caffeine and sensitivity into a rough spike ‚Üí crash ‚Üí anxiety timeline. Built for IBS / visceral sensitivity and nervous system people." />
  <style>
    :root {
      --bg: #05070b;
      --bg-card: #09101b;
      --bg-card-deeper: #050b14;
      --border-subtle: rgba(180, 210, 255, 0.4);
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.16);
      --accent-strong: #22c55e;
      --text-main: #e5f0ff;
      --text-soft: #a8b3c9;
      --danger: #fb7185;
      --warning: #facc15;
      --radius-lg: 18px;
      --radius-md: 12px;
      --shadow-card: 0 26px 50px rgba(0, 0, 0, 0.85);
      --font-base: 18px;
      --font-small: 15px;
      --font-xs: 13px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: radial-gradient(circle at top left, #0b1220, #020617 55%, #000 100%);
      color: var(--text-main);
      font-size: var(--font-base);
    }

    .page-wrap {
      max-width: 1180px;
      margin: 0 auto 40px auto;
    }

    h1 {
      margin: 0 0 4px 0;
      font-size: 26px;
      letter-spacing: 0.06em;
    }

    .subline {
      color: var(--text-soft);
      font-size: var(--font-small);
      max-width: 760px;
      margin-bottom: 6px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 14px;
    }

    .top-chip {
      font-size: var(--font-xs);
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.12), rgba(15, 23, 42, 0.98));
      color: var(--text-soft);
    }

    .app-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: minmax(0, 1.25fr) minmax(0, 1fr);
      gap: 14px;
      align-items: flex-start;
    }

    /* right column sticky on larger screens */
    #right-column {
      position: sticky;
      top: 12px;
      align-self: flex-start;
      height: fit-content;
    }

    /* disable sticky on small screens */
    @media (max-width: 960px) {
      .app-grid {
        grid-template-columns: minmax(0, 1fr);
      }
      #right-column {
        position: static;
      }
    }

    .card {
      background: radial-gradient(circle at top left, #111827, #020617 55%);
      border-radius: var(--radius-lg);
      padding: 14px 14px 16px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-card);
      margin-bottom: 10px;
    }

    .card-tight {
      padding-top: 8px;
      padding-bottom: 10px;
    }

    .card-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      margin-bottom: 6px;
    }

    .card-title {
      font-size: 14px;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .card-sub {
      font-size: var(--font-xs);
      color: var(--text-soft);
    }

    .label-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 4px;
      font-size: var(--font-xs);
      color: var(--text-soft);
    }

    .input-label {
      font-size: var(--font-small);
      margin-bottom: 3px;
    }

    .helper-text {
      font-size: var(--font-xs);
      color: var(--text-soft);
      margin-top: 2px;
    }

    input,
    select {
      font-family: inherit;
      font-size: var(--font-small);
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
      padding: 6px 10px;
      outline: none;
    }

    input:focus,
    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
    }

    .time-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 4px;
    }

    .time-row input[type="time"] {
      padding-inline: 8px;
      min-width: 130px;
    }

    /* thicker range slider */
    input[type="range"] {
      -webkit-appearance: none;
      width: 100%;
      height: 12px;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #facc15 50%, #fb7185 100%);
      outline: none;
      margin: 2px 0 4px 0;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #e5f0ff;
      border: 2px solid #0f172a;
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.5);
      cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #e5f0ff;
      border: 2px solid #0f172a;
      box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.5);
      cursor: pointer;
    }

    .mode-toggle {
      display: inline-flex;
      border-radius: 999px;
      padding: 2px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.7);
      margin-top: 4px;
    }

    .mode-btn {
      border-radius: 999px;
      padding: 4px 10px;
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: var(--font-xs);
      cursor: pointer;
      white-space: nowrap;
    }

    .mode-btn.active {
      background: linear-gradient(135deg, rgba(56, 189, 248, 0.16), rgba(37, 99, 235, 0.6));
      color: #e5f0ff;
    }

    .mode-btn:hover {
      background: rgba(15, 23, 42, 0.9);
    }

    .pill-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .pill {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
      font-size: var(--font-xs);
      padding: 4px 10px;
      cursor: pointer;
    }

    .pill.active {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.26), rgba(15, 23, 42, 0.98));
      color: #e5f0ff;
      border-color: var(--accent);
    }

    .pill.primary {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.26), rgba(15, 23, 42, 0.98));
      border-color: var(--accent);
      color: #e5f0ff;
    }

    .input-row-inline {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
      align-items: center;
    }

    .input-row-inline input[type="number"] {
      width: 90px;
    }

    .section-spacer {
      height: 6px;
    }

    /* food list scrollable */
    .food-search-row {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
      flex-wrap: wrap;
      align-items: center;
    }

    .food-search-row input {
      flex: 1;
      min-width: 160px;
    }

    .food-list {
      max-height: 210px;
      overflow-y: auto;
      padding-right: 4px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top left, #020617, #020617 55%, #000 100%);
      margin-top: 4px;
    }

    .food-category {
      padding: 6px 8px 4px 8px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
    }

    .food-category:last-child {
      border-bottom: none;
    }

    .food-category-title {
      font-size: var(--font-xs);
      text-transform: uppercase;
      color: rgba(148, 163, 184, 0.9);
      margin-bottom: 4px;
    }

    .food-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 6px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.12s ease, border-color 0.12s ease;
      border: 1px solid transparent;
    }

    .food-row:hover {
      background: rgba(15, 23, 42, 0.9);
      border-color: rgba(148, 163, 184, 0.5);
    }

    .food-row.active {
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.22), rgba(15, 23, 42, 0.98));
      border-color: var(--accent);
    }

    .food-emoji {
      font-size: 20px;
      width: 24px;
      text-align: center;
    }

    .food-main {
      flex: 1;
      min-width: 0;
    }

    .food-name {
      font-size: 15px;
      color: #e5e7eb;
    }

    .food-meta {
      font-size: var(--font-xs);
      color: var(--text-soft);
    }

    .food-tag {
      font-size: var(--font-xs);
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: rgba(226, 232, 240, 0.9);
      white-space: nowrap;
    }

    .data-warning {
      font-size: var(--font-xs);
      color: #facc15;
      margin-top: 4px;
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <header style="margin-bottom: 6px;">
      <h1>CARB / SUGAR ANXIETY TIMING EXPLORER</h1>
      <div class="subline">
        Rough, biology informed estimate of when carbs, added sugar, caffeine and sensitivity might create a spike ‚Üí crash ‚Üí anxiety window. Free, anonymous, just a pattern explorer.
      </div>
      <div class="chip-row">
        <div class="top-chip">Focus: post-meal hours, not psychology</div>
        <div class="top-chip">Built for IBS / visceral sensitivity and nervous system people</div>
        <div class="top-chip">Free, no login, no data leaves your browser</div>
      </div>
    </header>

    <main class="app-grid">
      <!-- LEFT COLUMN: inputs -->
      <section id="left-column">
        <!-- Basic timing and sensitivity -->
        <div class="card">
          <div class="card-title-row">
            <div>
              <div class="card-title">Main spike estimate</div>
              <div class="card-sub" id="scoreMeaning">Waiting for meal + sugar / caffeine.</div>
            </div>
            <div class="card-sub" id="scoreMainLabel">Very low</div>
          </div>

          <div class="label-row" style="margin-bottom: 2px;">
            <span>Time since you started eating</span>
            <span id="timeSinceMealLabel">Just now</span>
          </div>
          <input id="timeSinceMealRange" type="range" min="0" max="240" step="5" value="0" />

          <div class="time-row">
            <div style="flex: 1; min-width: 140px;">
              <div class="input-label">What time did you start this meal?</div>
              <input id="mealClockTime" type="time" />
              <div class="helper-text">Optional. Helps map the crash window into real clock time.</div>
            </div>
            <div style="flex: 0 0 180px;">
              <div class="input-label">How sensitive is your system today?</div>
              <select id="sensitivitySelect">
                <option value="0.8">Calmer than usual</option>
                <option value="1" selected>Typical</option>
                <option value="1.3">Extra sensitive</option>
              </select>
              <div class="helper-text">This is your nervous system ‚Äúvolume knob‚Äù.</div>
            </div>
          </div>
        </div>

        <!-- Mode toggle -->
        <div class="card card-tight">
          <div class="card-title-row">
            <div class="card-title">Meal and pattern</div>
            <div class="mode-toggle">
              <button id="simpleModeBtn" class="mode-btn active">Simple (pick foods)</button>
              <button id="advancedModeBtn" class="mode-btn">Advanced (enter numbers)</button>
            </div>
          </div>

          <!-- SIMPLE PANEL -->
          <div id="simplePanel">
            <div class="input-label">Simple: what did this meal look like?</div>
            <div class="food-search-row">
              <input id="foodSearch" type="text" placeholder="Search: pasta, pizza, salad, soda..." />
              <button id="clearFoodBtn" class="pill">Clear</button>
            </div>
            <div class="helper-text">
              These are rough presets. Tap the closest match to what you actually ate.
            </div>

            <div id="foodList" class="food-list"></div>

            <div class="section-spacer"></div>

            <!-- Dessert -->
            <div class="input-label">Extra dessert / sweets</div>
            <div class="pill-buttons">
              <button class="pill" data-sugar="0">None</button>
              <button class="pill" data-sugar="10">Small treat (~10 g sugar)</button>
              <button class="pill" data-sugar="20">Medium dessert (~20 g)</button>
              <button class="pill" data-sugar="35">Big dessert (~35 g)</button>
            </div>
            <div class="helper-text">
              Examples: 2 cookies ‚âà 18 g, typical candy bar ‚âà 25 g, big dessert plate ‚âà 30‚Äì40 g, pint of ice cream can be 60+ g.
            </div>
            <div class="input-row-inline">
              <span class="helper-text">Or enter sugar directly in grams:</span>
              <input id="simpleSugarExact" type="number" min="0" max="120" step="1" placeholder="g sugar" />
            </div>

            <div class="section-spacer"></div>

            <!-- Soda / sugary drink -->
            <div class="input-label">Soda / sugary drink with this meal</div>
            <div class="pill-buttons">
              <button class="pill active" data-soda-sugar="0" data-soda-caf="0">No sugary drink</button>
              <button class="pill" data-soda-sugar="39" data-soda-caf="0">1 can soda, no caffeine</button>
              <button class="pill" data-soda-sugar="39" data-soda-caf="35">1 can soda, caffeinated</button>
              <button class="pill" data-soda-sugar="60" data-soda-caf="60">Large / multiple sodas</button>
            </div>
            <div class="helper-text">
              This adds sugar and (if caffeinated) caffeine into the spike calculation.
            </div>

            <div class="section-spacer"></div>

            <!-- Coffee / caffeine -->
            <div class="input-label">Coffee or energy drink around this meal</div>
            <div class="pill-buttons">
              <button class="pill active" data-caf="0">No caffeine</button>
              <button class="pill" data-caf="80">Small coffee / tea (~80 mg)</button>
              <button class="pill" data-caf="140">Large coffee (~140 mg)</button>
              <button class="pill" data-caf="200">Strong coffee / energy drink (200+ mg)</button>
            </div>
            <div class="input-row-inline">
              <span class="helper-text">Or enter caffeine directly in mg:</span>
              <input id="simpleCafExact" type="number" min="0" max="500" step="5" placeholder="mg caffeine" />
            </div>

            <div class="section-spacer"></div>

            <div id="dataWarning" class="data-warning"></div>
          </div>

          <!-- ADVANCED PANEL -->
          <div id="advancedPanel" style="display:none;">
            <div class="input-label">Advanced: enter approximate numbers</div>
            <div class="helper-text">
              This is for nutrition nerds who know their grams. You can keep it rough; the goal is pattern, not perfection.
            </div>
            <div class="input-row-inline" style="margin-top:6px;">
              <label>Carbs (g)
                <input id="advCarbs" type="number" min="0" max="200" step="5" />
              </label>
              <label>Sugar (g)
                <input id="advSugar" type="number" min="0" max="200" step="2" />
              </label>
              <label>Caffeine (mg)
                <input id="advCaffeine" type="number" min="0" max="500" step="5" />
              </label>
            </div>
            <div class="input-row-inline" style="margin-top:6px;">
              <label>Fiber (g)
                <input id="advFiber" type="number" min="0" max="40" step="1" />
              </label>
              <label>Fat level
                <select id="advFat">
                  <option value="0">Low fat</option>
                  <option value="1" selected>Medium fat</option>
                  <option value="2">Heavy / fried</option>
                </select>
              </label>
            </div>
          </div>
        </div>

        <!-- Sensitivity / rest of day -->
        <div class="card card-tight">
          <div class="card-title-row">
            <div class="card-title">Rest of day and sensitivity</div>
          </div>

          <div class="input-label">How carb-heavy has the rest of your day been?</div>
          <div class="pill-buttons">
            <button class="pill active" data-rest="0">Low</button>
            <button class="pill" data-rest="1">Medium</button>
            <button class="pill" data-rest="2">High</button>
          </div>
          <div class="helper-text">
            0 = mostly light / low carb so far, 2 = lots of bread, pasta, sweets, snacks earlier.
          </div>

          <div class="section-spacer"></div>

          <div class="input-label">Visceral sensitivity (gut volume knob)</div>
          <div class="pill-buttons">
            <button class="pill" data-visceral="0.8">Calmer gut</button>
            <button class="pill active" data-visceral="1">Typical</button>
            <button class="pill" data-visceral="1.3">Super sensitive</button>
          </div>
          <div class="helper-text">
            0.8 = gut rarely complains, 1.3 = gut feels every bubble and stretch.
          </div>

          <div class="section-spacer"></div>

          <div class="input-label">Anxiety system sensitivity</div>
          <div class="pill-buttons">
            <button class="pill" data-ax="0.8">Rarely anxious</button>
            <button class="pill active" data-ax="1">Medium</button>
            <button class="pill" data-ax="1.3">Notices every little crash</button>
          </div>
          <div class="helper-text">
            This is the brain side. It makes each spike feel quieter or louder, but does not change the timing.
          </div>
        </div>
      </section>
            <!-- RIGHT COLUMN: score, gauge, explanation -->
      <section id="right-column">
        <!-- floating strip for quick view -->
        <div class="card card-tight" style="margin-bottom: 8px;">
          <div class="card-title-row">
            <div class="card-title">Risk gauge</div>
            <div class="card-sub">0 to 49 Low, 50 to 74 Moderate, 75+ High</div>
          </div>

          <div style="margin-bottom:4px; font-size:var(--font-xs); display:flex; justify-content:space-between; color:var(--text-soft);">
            <span>Low</span>
            <span>25</span>
            <span>50</span>
            <span>75</span>
            <span>100</span>
          </div>

          <div style="position:relative; margin-bottom:8px;">
            <div style="height:14px; border-radius:999px; background:linear-gradient(90deg,#22c55e,#eab308,#fb7185); box-shadow:0 0 0 1px rgba(15,23,42,0.9);"></div>
            <div id="gaugeMarker" style="position:absolute; top:-4px; width:2px; height:22px; background:white; border-radius:999px; left:0%;">
            </div>
            <div style="position:absolute; top:20px; transform:translateX(-50%); font-size:11px; color:var(--text-soft);" id="gaugeMarkerLabel">
              You are here
            </div>
          </div>

          <div style="text-align:center; margin: 4px 0 6px 0;">
            <div id="scoreMainNumber" style="font-size:34px; font-weight:600;">0</div>
            <div id="stripScoreLabel" style="font-size:var(--font-small); color:var(--text-soft);">Very low</div>
          </div>

          <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px; margin-bottom:6px;">
            <div id="riskChip" class="risk-chip risk-low">Waiting for meal + sugar / caffeine</div>
            <div style="font-size:var(--font-xs); color:var(--text-soft);" id="stripWindowLabel">
              Just ate this meal.
            </div>
          </div>

          <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
            <button id="shareStripBtn" class="pill primary">Copy summary</button>
            <div id="shareStatus" class="helper-text" style="flex:1; text-align:right;"></div>
          </div>
        </div>

        <!-- Score meaning + biology + confidence -->
        <div class="card card-tight">
          <div class="card-title-row">
            <div class="card-title">What this number means</div>
          </div>
          <div id="biologyLine" class="helper-text" style="margin-bottom:6px;">
            Biology: waiting for inputs. Add a meal, sugar, caffeine and timing to see how loud the spike is.
          </div>
          <div id="confidenceLine" class="helper-text">
            Confidence: very low (no data yet). The more you enter, the better this lines up with reality.
          </div>
        </div>

        <!-- Crash timeline -->
        <div class="card">
          <div class="card-title-row">
            <div class="card-title">Spike ‚Üí crash ‚Üí recovery timeline</div>
          </div>

          <div id="clockWindowLabel" class="helper-text" style="margin-bottom:6px;">
            Add a rough meal time to see your crash window in clock time.
          </div>

          <div style="position:relative; margin: 10px 0 4px 0;">
            <div style="display:flex; height:16px; border-radius:999px; overflow:hidden; box-shadow:0 0 0 1px rgba(15,23,42,0.9);">
              <div style="flex:1; background:#facc15;"></div>
              <div style="flex:1; background:#fb7185;"></div>
              <div style="flex:2; background:#38bdf8;"></div>
            </div>
            <div id="timelineMarkerLine" style="position:absolute; top:-2px; width:2px; height:24px; background:white; border-radius:999px; left:0%;"></div>
            <div id="timelineMarkerLabel" style="position:absolute; top:22px; transform:translateX(-50%); font-size:11px; color:var(--text-soft);">
              You are here
            </div>
          </div>

          <div style="display:flex; gap:12px; font-size:var(--font-xs); margin-bottom:4px; color:var(--text-soft); flex-wrap:wrap;">
            <span>üü° Spike window</span>
            <span>üî¥ Crash / anxiety window</span>
            <span>üîµ Recovery</span>
          </div>

          <div id="timelineHelper" class="helper-text" style="margin-bottom:4px;">
            Add meal, sugar / caffeine and timing to see where you sit in the 0‚Äì240 minute wave.
          </div>

          <div style="margin-top:6px;">
            <div style="display:grid; grid-template-columns:1.1fr 1.1fr; gap:10px; font-size:var(--font-small);">
              <div>
                <div style="font-weight:600;">Spike window</div>
                <div id="spikeClockLabel" class="helper-text">Waiting for time and meal.</div>
              </div>
              <div>
                <div style="font-weight:600;">Crash / anxiety window</div>
                <div id="crashClockLabel" class="helper-text">Waiting for time and meal.</div>
              </div>
            </div>
            <div style="margin-top:6px;">
              <div style="font-weight:600; font-size:var(--font-small);">Recovery trend</div>
              <div id="recoveryClockLabel" class="helper-text">Waiting for time and meal.</div>
            </div>
          </div>
        </div>

        <!-- Quick summary + why card -->
        <div class="card">
          <div class="card-title-row">
            <div class="card-title">Quick summary</div>
          </div>
          <div id="quickSummaryText" class="helper-text" style="margin-bottom:8px;">
            Waiting for enough data to give a summary. Add a meal, sugar or dessert, caffeine and timing.
          </div>

          <button id="whyBtn" class="pill primary" style="margin-bottom:8px;">Why am I feeling this way?</button>
          <div id="whyText" class="helper-text" style="display:none;">
            For people with IBS, visceral hypersensitivity or a very alert nervous system, carbs, sugar and caffeine can create waves of body noise 1‚Äì4 hours after eating. This can feel like ‚Äúpure anxiety‚Äù even when life is calm, because the body signal is loud and the brain tries to explain it.
          </div>
        </div>

        <!-- What this is / is not -->
        <div class="card">
          <div class="card-title-row">
            <div class="card-title">What this is and is not</div>
          </div>
          <div class="helper-text" style="margin-bottom:6px;">
            This is a rough timing model for people who notice that carbs, sugar and caffeine can create waves of anxiety a couple of hours later, especially if they also have IBS or visceral hypersensitivity.
          </div>
          <div class="helper-text">
            It is not a diagnosis. If you ever have chest pain, severe shortness of breath, or feel unsafe, that is an emergency issue for real-world care, not a timing calculator.
          </div>
        </div>

        <!-- Symptom checker -->
        <div class="card card-tight">
          <div class="card-title-row">
            <div class="card-title">Body snapshot</div>
          </div>
          <div class="helper-text">Tap what feels closest right now:</div>
          <div class="pill-buttons" style="margin-top:6px;">
            <button class="pill symptom-btn" data-symptom="jittery">Jittery / wired / inner buzz</button>
            <button class="pill symptom-btn" data-symptom="warmChest">Warm chest / adrenaline rush</button>
            <button class="pill symptom-btn" data-symptom="gutBuzz">Gut buzzing / bloating</button>
            <button class="pill symptom-btn" data-symptom="flat">Flat / tired / drained</button>
            <button class="pill symptom-btn" data-symptom="headache">Headache instead of gut pain</button>
          </div>
          <div id="symptomText" class="helper-text" style="margin-top:8px;">
            We will compare your pick to the predicted crash window and show whether biology is likely driving it.
          </div>
        </div>

        <!-- Footer -->
        <div class="card card-tight" style="margin-top:4px;">
          <div class="helper-text">
            ¬© 2025 Darkstar747. Free for personal use and community sharing. Not for commercial resale or paywalled distribution. Do not repurpose this work for any product or service that charges money.
          </div>
          <div class="helper-text" style="margin-top:4px;">
            Tool version: real-time update, right-column float, thicker sliders, clock window labels restored.
          </div>
        </div>
      </section>
    </main>
  </div>
    <style>
    .risk-chip {
      font-size: var(--font-xs);
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text-soft);
      white-space: nowrap;
    }

    .risk-low {
      border-color: #22c55e;
      background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.26), rgba(15, 23, 42, 0.98));
      color: #bbf7d0;
    }

    .risk-moderate {
      border-color: #facc15;
      background: radial-gradient(circle at top left, rgba(250, 204, 21, 0.26), rgba(15, 23, 42, 0.98));
      color: #fef9c3;
    }

    .risk-high {
      border-color: #fb7185;
      background: radial-gradient(circle at top left, rgba(248, 113, 113, 0.26), rgba(15, 23, 42, 0.98));
      color: #fee2e2;
    }

    .breakdown-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .breakdown-chip {
      font-size: var(--font-xs);
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: rgba(226, 232, 240, 0.95);
    }

    .info-icon-btn {
      border: none;
      background: transparent;
      color: var(--text-soft);
      font-size: 16px;
      cursor: pointer;
      padding: 0 2px;
    }

    .info-text {
      display: none;
      font-size: var(--font-xs);
      color: var(--text-soft);
      margin-top: 4px;
    }

    .info-text.visible {
      display: block;
    }

    .symptom-btn {
      font-size: var(--font-xs);
    }

    @media (max-width: 600px) {
      body {
        font-size: 16px;
      }
      .card {
        padding: 12px 12px 14px 12px;
      }
      h1 {
        font-size: 22px;
      }
      .food-list {
        max-height: 190px;
      }
      input,
      select {
        font-size: 14px;
      }
    }
  </style>
    <script>
    // ---------------------------
    // Food presets (grouped)
    // ---------------------------
    const mealCategories = [
      {
        name: "Pasta / rice / bowls",
        id: "pastaRice",
        items: [
          { id: "pasta", emoji: "üçù", name: "Plate of pasta", carbs: 80, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
          { id: "riceBowl", emoji: "üçö", name: "Rice bowl", carbs: 70, fiber: 2, fatLevel: 0, sugarBase: 2, tag: "High carb" },
          { id: "ramen", emoji: "üçú", name: "Ramen or noodle bowl", carbs: 65, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
          { id: "chipotleBowl", emoji: "ü•ó", name: "Burrito bowl", carbs: 65, fiber: 7, fatLevel: 2, sugarBase: 3, tag: "High carb, higher fiber" }
        ]
      },
      {
        name: "Pizza / fast food",
        id: "pizzaFast",
        items: [
          { id: "pizza2", emoji: "üçï", name: "Pizza, 2 slices", carbs: 60, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "High carb and fat" },
          { id: "pizza3", emoji: "üçï", name: "Pizza, 3 slices", carbs: 90, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "Very high carb and fat" },
          { id: "burgerFries", emoji: "üçî", name: "Burger with fries", carbs: 70, fiber: 4, fatLevel: 2, sugarBase: 4, tag: "Heavy" },
          { id: "burgerOnly", emoji: "üçî", name: "Burger, no fries", carbs: 45, fiber: 2, fatLevel: 2, sugarBase: 2, tag: "Medium carb" }
        ]
      },
      {
        name: "Lighter plates",
        id: "lightPlates",
        items: [
          { id: "saladLowCarb", emoji: "ü•ó", name: "Green salad, low carb", carbs: 18, fiber: 6, fatLevel: 1, sugarBase: 1, tag: "Light" },
          { id: "chickenVeg", emoji: "üçó", name: "Grilled chicken with vegetables", carbs: 20, fiber: 4, fatLevel: 1, sugarBase: 1, tag: "Lower carb" },
          { id: "salmonVeg", emoji: "üêü", name: "Salmon with vegetables", carbs: 15, fiber: 4, fatLevel: 2, sugarBase: 1, tag: "Lower carb" },
          { id: "snackPlate", emoji: "üßÄ", name: "Snack plate (cheese, crackers, nuts)", carbs: 25, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "Medium carb" }
        ]
      },
      {
        name: "Desserts",
        id: "desserts",
        items: [
          { id: "iceCream", emoji: "üç®", name: "Ice cream bowl", carbs: 45, fiber: 1, fatLevel: 2, sugarBase: 28, tag: "High sugar" },
          { id: "cakeSlice", emoji: "üç∞", name: "Slice of cake", carbs: 45, fiber: 1, fatLevel: 2, sugarBase: 28, tag: "High sugar" },
          { id: "cookie2", emoji: "üç™", name: "Cookies, a couple", carbs: 30, fiber: 1, fatLevel: 2, sugarBase: 18, tag: "High sugar" }
        ]
      }
    ];

    let selectedMealId = null;
    let simpleSugarExtra = 0;
    let simpleCaffeine = 0;
    let simpleSodaSugar = 0;
    let simpleSodaCaf = 0;

    const elements = {
      simpleModeBtn: document.getElementById("simpleModeBtn"),
      advancedModeBtn: document.getElementById("advancedModeBtn"),
      simplePanel: document.getElementById("simplePanel"),
      advancedPanel: document.getElementById("advancedPanel"),

      timeRange: document.getElementById("timeSinceMealRange"),
      timeLabel: document.getElementById("timeSinceMealLabel"),
      sensitivitySelect: document.getElementById("sensitivitySelect"),
      mealClockTime: document.getElementById("mealClockTime"),
      clockWindowLabel: document.getElementById("clockWindowLabel"),

      foodList: document.getElementById("foodList"),
      foodSearch: document.getElementById("foodSearch"),
      clearFoodBtn: document.getElementById("clearFoodBtn"),
      dataWarning: document.getElementById("dataWarning"),

      simpleSugarExact: document.getElementById("simpleSugarExact"),
      simpleCafExact: document.getElementById("simpleCafExact"),

      scoreMainNumber: document.getElementById("scoreMainNumber"),
      scoreMainLabel: document.getElementById("scoreMainLabel"),
      scoreMeaning: document.getElementById("scoreMeaning"),
      biologyLine: document.getElementById("biologyLine"),
      confidenceLine: document.getElementById("confidenceLine"),

      riskChip: document.getElementById("riskChip"),
      gaugeMarker: document.getElementById("gaugeMarker"),
      stripScoreLabel: document.getElementById("stripScoreLabel"),
      stripWindowLabel: document.getElementById("stripWindowLabel"),

      timelineMarkerLine: document.getElementById("timelineMarkerLine"),
      timelineMarkerLabel: document.getElementById("timelineMarkerLabel"),
      timelineHelper: document.getElementById("timelineHelper"),

      spikeClockLabel: document.getElementById("spikeClockLabel"),
      crashClockLabel: document.getElementById("crashClockLabel"),
      recoveryClockLabel: document.getElementById("recoveryClockLabel"),

      quickSummaryText: document.getElementById("quickSummaryText"),

      symptomText: document.getElementById("symptomText"),

      shareBtn: document.getElementById("shareBtn"),
      shareStripBtn: document.getElementById("shareStripBtn") || document.getElementById("shareStripBtn"),
      shareStatus: document.getElementById("shareStatus"),

      whyBtn: document.getElementById("whyBtn"),
      whyText: document.getElementById("whyText")
    };

    function minutesLabel(val) {
      const v = Number(val);
      if (v === 0) return "Just now";
      if (v <= 30) return "~" + v + " minutes ago";
      const hours = Math.round((v / 60) * 10) / 10;
      if (hours < 1) return "~" + v + " minutes ago";
      return "~" + hours + " hours ago";
    }

    function formatClock(mins) {
      let m = ((mins % 1440) + 1440) % 1440;
      const h = Math.floor(m / 60);
      const mm = m % 60;
      const suffix = h >= 12 ? "pm" : "am";
      let displayH = h % 12;
      if (displayH === 0) displayH = 12;
      return `${displayH}:${mm.toString().padStart(2, "0")} ${suffix}`;
    }

    function renderFoods(filterText = "") {
      const root = elements.foodList;
      root.innerHTML = "";
      const term = filterText.trim().toLowerCase();

      mealCategories.forEach(cat => {
        const filtered = cat.items.filter(item => {
          if (!term) return true;
          const hay = (item.name + " " + (item.tag || "")).toLowerCase();
          return hay.includes(term);
        });
        if (!filtered.length) return;

        const catDiv = document.createElement("div");
        catDiv.className = "food-category";

        const title = document.createElement("div");
        title.className = "food-category-title";
        title.textContent = cat.name;
        catDiv.appendChild(title);

        filtered.forEach(item => {
          const row = document.createElement("div");
          row.className = "food-row";
          row.dataset.mealId = item.id;

          const emoji = document.createElement("div");
          emoji.className = "food-emoji";
          emoji.textContent = item.emoji;
          row.appendChild(emoji);

          const main = document.createElement("div");
          main.className = "food-main";

          const name = document.createElement("div");
          name.className = "food-name";
          name.textContent = item.name;
          main.appendChild(name);

          const meta = document.createElement("div");
          meta.className = "food-meta";
          meta.textContent = `${item.carbs} g carbs ‚Ä¢ ${item.tag}`;
          main.appendChild(meta);

          row.appendChild(main);

          const tag = document.createElement("span");
          tag.className = "food-tag";
          tag.textContent = item.tag;
          row.appendChild(tag);

          row.addEventListener("click", () => {
            selectedMealId = item.id;
            document.querySelectorAll(".food-row").forEach(r => r.classList.remove("active"));
            row.classList.add("active");
            updateScore();
          });

          catDiv.appendChild(row);
        });

        root.appendChild(catDiv);
      });
    }

    function getSelectedMeal() {
      for (const cat of mealCategories) {
        for (const item of cat.items) {
          if (item.id === selectedMealId) return item;
        }
      }
      return null;
    }

    function computeRisk() {
      const timeMin = Number(elements.timeRange.value);
      const sensBase = Number(elements.sensitivitySelect.value);

      let carbs = 0;
      let sugar = 0;
      let caffeine = 0;
      let fiber = 0;
      let fatLevel = 0;

      const useAdvanced = elements.advancedPanel.style.display !== "none";

      if (useAdvanced) {
        carbs = Number(document.getElementById("advCarbs").value || 0);
        sugar = Number(document.getElementById("advSugar").value || 0);
        caffeine = Number(document.getElementById("advCaffeine").value || 0);
        fiber = Number(document.getElementById("advFiber").value || 0);
        fatLevel = Number(document.getElementById("advFat").value || 0);
      } else {
        const meal = getSelectedMeal();
        if (meal) {
          carbs = meal.carbs;
          fiber = meal.fiber || 0;
          fatLevel = meal.fatLevel || 0;
          sugar = meal.sugarBase || 0;
        }
        const dessertExtra = elements.simpleSugarExact.value !== ""
          ? Number(elements.simpleSugarExact.value)
          : simpleSugarExtra;
        if (!isNaN(dessertExtra)) sugar += dessertExtra;

        sugar += simpleSodaSugar;

        const extraCaf = elements.simpleCafExact.value !== ""
          ? Number(elements.simpleCafExact.value)
          : simpleCaffeine;
        if (!isNaN(extraCaf)) caffeine += extraCaf;
        caffeine += simpleSodaCaf;
      }

      carbs = Math.max(0, Math.min(carbs, 200));
      sugar = Math.max(0, Math.min(sugar, 200));
      caffeine = Math.max(0, Math.min(caffeine, 500));
      fiber = Math.max(0, Math.min(fiber, 40));

      const carbPoints = Math.min(40, carbs * 0.5);
      const sugarPoints = Math.min(40, sugar * 0.7);
      const caffeinePoints = Math.min(20, caffeine * 0.07);

      const tRaw = Math.max(0, Math.min(timeMin, 240));
      const fatDelayMinutes = fatLevel * 20;
      const effectiveTime = Math.max(0, Math.min(tRaw + fatDelayMinutes, 240));

      const center = 90;
      const spread = 70;
      const timingFactor = Math.exp(-Math.pow(effectiveTime - center, 2) / (2 * spread * spread));
      const timingMultiplier = 0.2 + timingFactor * 0.9;

      const fiberEffect = 1 - Math.min(0.25, fiber * 0.02);

      const restPills = document.querySelectorAll("[data-rest].active");
      const visPills = document.querySelectorAll("[data-visceral].active");
      const axPills = document.querySelectorAll("[data-ax].active");

      let restFactor = 1;
      if (restPills.length) {
        const val = Number(restPills[0].dataset.rest || 0);
        restFactor = 1 + val * 0.12;
      }

      let visceralFactor = sensBase;
      if (visPills.length) {
        visceralFactor = Number(visPills[0].dataset.visceral || sensBase);
      }

      let axFactor = 1;
      if (axPills.length) {
        axFactor = Number(axPills[0].dataset.ax || 1);
      }

      const sensitivityFactor = visceralFactor * axFactor * restFactor;

      const baseSum = carbPoints + sugarPoints + caffeinePoints;
      let rawScore = baseSum * timingMultiplier * sensitivityFactor * fiberEffect;
      rawScore = Math.max(0, Math.min(100, rawScore));

      const contributions = { carbs: 0, sugar: 0, caffeine: 0, timing: 0 };
      if (baseSum > 0) {
        contributions.carbs = (carbPoints / baseSum) * 100;
        contributions.sugar = (sugarPoints / baseSum) * 100;
        contributions.caffeine = (caffeinePoints / baseSum) * 100;
        contributions.timing = 100 - (contributions.carbs + contributions.sugar + contributions.caffeine);
      }

      return {
        score: rawScore,
        carbs,
        sugar,
        caffeine,
        timeMin,
        effectiveTime,
        contributions,
        hasMeal: !!getSelectedMeal(),
        hasSugar: sugar > 0,
        hasCaffeine: caffeine > 0,
        fatLevel
      };
    }

    function riskLabel(score) {
      if (score < 20) return "Very low";
      if (score < 40) return "Low";
      if (score < 60) return "Moderate";
      if (score < 80) return "High";
      return "Very high";
    }

    function riskChipClass(score) {
      if (score < 40) return "risk-chip risk-low";
      if (score < 75) return "risk-chip risk-moderate";
      return "risk-chip risk-high";
    }

    function scoreMeaningText(score) {
      if (score < 5) {
        return "Add a rough meal type, sugar or caffeine and timing to see a real spike estimate.";
      }
      if (score < 20) {
        return "Biology is pretty quiet. This is probably not a strong food or caffeine driven episode.";
      }
      if (score < 40) {
        return "Mild spike. Your load might be nudging you, but something else may also be involved.";
      }
      if (score < 60) {
        return "Moderate spike. Your gut and blood sugar are likely contributing to how you feel.";
      }
      if (score < 80) {
        return "High spike. This timing and load strongly fit a crash window for sensitive people.";
      }
      return "Very high spike. This is classic body driven anxiety territory for sensitive systems.";
    }

    function biologyLineText(score) {
      if (score < 20) {
        return "Biology: low. If you feel awful, it may be less about food timing and more about stress, thoughts or something else.";
      }
      if (score < 40) {
        return "Biology: mild. Your body is involved, but it is not screaming. Thoughts, context and posture still matter a lot here.";
      }
      if (score < 60) {
        return "Biology: moderate. This is likely biology first, thoughts second, especially if you are already sensitive.";
      }
      if (score < 80) {
        return "Biology: strong. For most sensitive people this level of load and timing can feel like ‚Äúpure anxiety‚Äù even when life is calm.";
      }
      return "Biology: very strong. This is the kind of spike that can convince anyone something is terribly wrong, even when it is mostly timing and chemistry.";
    }

    function confidenceText(result) {
      const { hasMeal, hasSugar, hasCaffeine, timeMin } = result;

      if (!hasMeal && !hasSugar && !hasCaffeine) {
        return "Confidence: very low (no meal, sugar or caffeine entered yet).";
      }
      if (!hasMeal && (hasSugar || hasCaffeine)) {
        return "Confidence: low (you entered sugar or caffeine, but no meal type; add a rough meal to tighten this up).";
      }
      if (hasMeal && (!hasSugar && !hasCaffeine)) {
        if (timeMin === 0) {
          return "Confidence: low (meal selected but timing is set to just now; slide the time since you started eating).";
        }
        return "Confidence: medium (meal and timing entered; sugar and caffeine left at zero).";
      }
      if (hasMeal && (hasSugar || hasCaffeine)) {
        if (timeMin === 0) {
          return "Confidence: medium (good load info, but timing is still at ‚Äújust now‚Äù; slide it closer to reality).";
        }
        return "Confidence: high (you entered meal, timing and at least some sugar or caffeine).";
      }
      return "Confidence: medium (partial data; the more you enter, the better this will line up with reality).";
    }

    function windowLabel(timeMin, effectiveTime) {
      if (timeMin === 0) return "Just ate this meal.";
      const t = effectiveTime;
      if (t < 40) return "Early digestion; spike is still building.";
      if (t <= 140) return "Crash / anxiety window is active.";
      if (t <= 200) return "Late crash / slump window.";
      return "Probably in the recovery phase now.";
    }

    function updateClockWindow(result) {
      const input = elements.mealClockTime.value;
      if (!input) {
        elements.clockWindowLabel.textContent = "Add a rough meal time to see your crash window in clock time.";
        elements.spikeClockLabel.textContent = "Waiting for meal time.";
        elements.crashClockLabel.textContent = "Waiting for meal time.";
        elements.recoveryClockLabel.textContent = "Waiting for meal time.";
        return;
      }
      const [hhStr, mmStr] = input.split(":");
      const hh = Number(hhStr);
      const mm = Number(mmStr);
      if (isNaN(hh) || isNaN(mm)) {
        elements.clockWindowLabel.textContent = "Meal time looks invalid. Try re-entering it.";
        return;
      }
      const mealStart = hh * 60 + mm;
      const spikeStart = mealStart + 20;
      const spikeEnd = mealStart + 75;
      const crashStart = mealStart + 75;
      const crashEnd = mealStart + 165;
      const recoveryStart = crashEnd;
      const recoveryEnd = recoveryStart + 150;

      const currentPoint = mealStart + result.effectiveTime;

      elements.spikeClockLabel.textContent = `${formatClock(spikeStart)} ‚Äì ${formatClock(spikeEnd)}`;
      elements.crashClockLabel.textContent = `${formatClock(crashStart)} ‚Äì ${formatClock(crashEnd)}`;
      elements.recoveryClockLabel.textContent = `${formatClock(recoveryStart)} ‚Äì ${formatClock(recoveryEnd)}`;
      elements.clockWindowLabel.textContent =
        `If you started eating around ${formatClock(mealStart)}, your main crash window is roughly ${formatClock(crashStart)} to ${formatClock(crashEnd)}. Right now you are around ${formatClock(currentPoint)}.`;
    }

    function updateQuickSummary(result) {
      const s = Math.round(result.score);
      if (s === 0) {
        elements.quickSummaryText.textContent =
          "Waiting for enough data to give a summary. Add a meal, sugar or dessert, caffeine and timing.";
        return;
      }
      const label = riskLabel(s);
      const pieces = [];
      pieces.push(`${s}/100 risk in the 1 to 4 hour window after this meal.`);
      const meal = getSelectedMeal();
      if (meal) {
        pieces.push(`Meal base: ${meal.name.toLowerCase()} (~${Math.round(result.carbs)} g carbs).`);
      } else {
        pieces.push(`Meal base: carbs ~${Math.round(result.carbs)} g.`);
      }
      if (result.sugar > 0) {
        pieces.push(`Sugar load: ~${Math.round(result.sugar)} g.`);
      }
      if (result.caffeine > 0) {
        pieces.push(`Caffeine: ~${Math.round(result.caffeine)} mg.`);
      }
      pieces.push(`Overall pattern: ${label.toLowerCase()} biological spike; this is meant to explain why a wave can show up even when the day felt mentally fine.`);
      elements.quickSummaryText.textContent = pieces.join(" ");
    }

    function updateScore() {
      const result = computeRisk();
      const s = Math.round(result.score);

      elements.timeLabel.textContent = minutesLabel(result.timeMin);

      elements.scoreMainNumber.textContent = s;
      const label = riskLabel(s);
      elements.scoreMainLabel.textContent = label;
      elements.stripScoreLabel.textContent = label;

      elements.scoreMeaning.textContent = scoreMeaningText(s);
      elements.biologyLine.textContent = biologyLineText(s);
      elements.confidenceLine.textContent = confidenceText(result);

      const markerPos = Math.max(0, Math.min(100, s));
      elements.gaugeMarker.style.left = markerPos + "%";

      elements.riskChip.className = riskChipClass(s);
      if (s === 0) {
        elements.riskChip.textContent = "Waiting for meal + sugar / caffeine";
      } else {
        elements.riskChip.textContent = label + " spike right now";
      }

      elements.stripWindowLabel.textContent = windowLabel(result.timeMin, result.effectiveTime);

      const tPercent = (Math.max(0, Math.min(result.effectiveTime, 240)) / 240) * 100;
      elements.timelineMarkerLine.style.left = tPercent + "%";
      elements.timelineMarkerLabel.style.left = tPercent + "%";

      if (s === 0) {
        elements.timelineHelper.textContent =
          "Add meal, sugar / caffeine and timing to see where you sit in the 0‚Äì240 minute wave.";
      } else {
        elements.timelineHelper.textContent =
          "This shows roughly where your body is in the spike ‚Üí crash ‚Üí recovery cycle for this meal.";
      }

      if (!result.hasMeal && (result.hasSugar || result.hasCaffeine)) {
        elements.dataWarning.textContent =
          "Tip: you entered sugar or caffeine but no meal type. Pick a rough meal above to tighten the estimate.";
      } else {
        elements.dataWarning.textContent = "";
      }

      updateClockWindow(result);
      updateQuickSummary(result);
    }

    function analyzeSymptom(symptom) {
      const result = computeRisk();
      const s = Math.round(result.score);
      const t = result.effectiveTime;

      let text = "";
      const inCrashWindow = t >= 40 && t <= 150;
      const lateCrash = t > 150 && t <= 210;

      if (symptom === "jittery" || symptom === "warmChest" || symptom === "randomAdrenaline") {
        if (inCrashWindow && s >= 40) {
          text = "That wired, buzzy feeling lines up with your predicted crash window. Your biology is loud right now; it does not mean anything is wrong with your character.";
        } else if (lateCrash) {
          text = "This could be a late wave from the same meal, but you are slightly past the main crash window. Still very likely biology, especially with carbs + sugar + caffeine in the mix.";
        } else {
          text = "This does not perfectly line up with the strongest crash window, but your nervous system may still be echoing earlier spikes, especially if today was a heavy carb or sugar day.";
        }
      } else if (symptom === "flat") {
        if (lateCrash || (inCrashWindow && s >= 30)) {
          text = "Feeling flat, blank or tired fits a post-spike slump. Your system may be in the ‚Äúcoming down‚Äù part of the wave after the earlier peak.";
        } else {
          text = "This might be more of a general fatigue rather than a sharp post-meal crash, but today‚Äôs load can still be keeping you lower than your baseline.";
        }
      } else if (symptom === "gutBuzz") {
        if (inCrashWindow) {
          text = "Gut buzzing during the crash window is classic visceral sensitivity. Your gut nerves are amplifying normal digestion into loud body noise.";
        } else {
          text = "You are outside the main crash window, but with visceral sensitivity, gut noise can linger. It still points more to biology than to ‚Äúrandom‚Äù anxiety.";
        }
      } else if (symptom === "headache") {
        if (lateCrash || inCrashWindow) {
          text = "Headaches can trade places with gut symptoms. This timing fits with blood sugar swings plus tension. It is likely part of the same body-driven pattern.";
        } else {
          text = "This may be more of a general tension or dehydration headache. Today‚Äôs carbs and sugar can still make it easier to tip into discomfort.";
        }
      }

      if (!text) {
        text = "This tool cannot perfectly label every sensation, but based on your timing and score, biology is playing a big role here.";
      }

      elements.symptomText.textContent = text;
    }

    function buildShareText() {
      const r = computeRisk();
      const s = Math.round(r.score);
      const label = riskLabel(s);
      const meal = getSelectedMeal();
      const mealName = meal ? meal.name : "Meal not specified";

      const parts = [];
      parts.push(`Post-meal anxiety spike estimate: ${s}/100 (${label}).`);
      parts.push(`Meal: ${mealName}. Approx carbs: ~${Math.round(r.carbs)} g, sugar: ~${Math.round(r.sugar)} g, caffeine: ~${Math.round(r.caffeine)} mg.`);
      parts.push(`Time since meal: ${minutesLabel(r.timeMin)}.`);
      parts.push(`Tool: darkstar747.github.io (free, no login, biology-based timing calculator).`);
      return parts.join(" ");
    }

    async function copyShareText() {
      const text = buildShareText();
      try {
        if (navigator.clipboard && navigator.clipboard.writeText) {
          await navigator.clipboard.writeText(text);
          elements.shareStatus.textContent = "Copied. You can paste this into Reddit, a note or a chat.";
        } else {
          elements.shareStatus.textContent = "Copy failed: clipboard API not available.";
          alert(text);
        }
      } catch {
        elements.shareStatus.textContent = "Copy failed. Your browser may be blocking clipboard access.";
      }
    }

    function initEvents() {
      elements.simpleModeBtn.addEventListener("click", () => {
        elements.simpleModeBtn.classList.add("active");
        elements.advancedModeBtn.classList.remove("active");
        elements.simplePanel.style.display = "";
        elements.advancedPanel.style.display = "none";
        updateScore();
      });

      elements.advancedModeBtn.addEventListener("click", () => {
        elements.advancedModeBtn.classList.add("active");
        elements.simpleModeBtn.classList.remove("active");
        elements.simplePanel.style.display = "none";
        elements.advancedPanel.style.display = "";
        updateScore();
      });

      elements.timeRange.addEventListener("input", updateScore);
      elements.mealClockTime.addEventListener("input", updateScore);
      elements.sensitivitySelect.addEventListener("change", updateScore);

      elements.foodSearch.addEventListener("input", e => {
        renderFoods(e.target.value);
      });

      elements.clearFoodBtn.addEventListener("click", () => {
        elements.foodSearch.value = "";
        selectedMealId = null;
        renderFoods("");
        updateScore();
      });

      document.querySelectorAll("[data-sugar]").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("[data-sugar]").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          simpleSugarExtra = Number(btn.dataset.sugar || 0);
          elements.simpleSugarExact.value = "";
          updateScore();
        });
      });

      elements.simpleSugarExact.addEventListener("input", () => {
        document.querySelectorAll("[data-sugar]").forEach(b => b.classList.remove("active"));
        updateScore();
      });

      document.querySelectorAll("[data-soda-sugar]").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("[data-soda-sugar]").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          simpleSodaSugar = Number(btn.dataset.sodaSugar || 0);
          simpleSodaCaf = Number(btn.dataset.sodaCaf || 0);
          updateScore();
        });
      });

      document.querySelectorAll("[data-caf]").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("[data-caf]").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          simpleCaffeine = Number(btn.dataset.caf || 0);
          elements.simpleCafExact.value = "";
          updateScore();
        });
      });

      elements.simpleCafExact.addEventListener("input", () => {
        document.querySelectorAll("[data-caf]").forEach(b => b.classList.remove("active"));
        updateScore();
      });

      ["advCarbs", "advSugar", "advCaffeine", "advFiber", "advFat"].forEach(id => {
        const el = document.getElementById(id);
        if (!el) return;
        const handler = updateScore;
        if (el.tagName === "SELECT") {
          el.addEventListener("change", handler);
        } else {
          el.addEventListener("input", handler);
        }
      });

      document.querySelectorAll("[data-rest]").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("[data-rest]").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          updateScore();
        });
      });

      document.querySelectorAll("[data-visceral]").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("[data-visceral]").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          updateScore();
        });
      });

      document.querySelectorAll("[data-ax]").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("[data-ax]").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          updateScore();
        });
      });

      document.querySelectorAll(".symptom-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          analyzeSymptom(btn.dataset.symptom);
        });
      });

      const stripButton = document.getElementById("shareStripBtn");
      if (stripButton) stripButton.addEventListener("click", copyShareText);

      if (elements.shareBtn) {
        elements.shareBtn.addEventListener("click", copyShareText);
      }

      elements.whyBtn.addEventListener("click", () => {
        const visible = elements.whyText.style.display === "block";
        elements.whyText.style.display = visible ? "none" : "block";
      });
    }

    renderFoods("");
    initEvents();
    updateScore();
  </script>
</body>
</html>
      
