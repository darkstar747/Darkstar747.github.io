<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Carb / Sugar Anxiety Timing Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Free, browser-only carb / sugar / caffeine timing calculator for post-meal anxiety and visceral hypersensitivity patterns." />
  <style>
    :root {
      --bg: #050816;
      --bg-elevated: #050b16;
      --bg-card: radial-gradient(circle at top left, #111827, #020617);
      --border-strong: rgba(148, 163, 184, 0.6);
      --border-subtle: rgba(30, 64, 175, 0.7);
      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --accent: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.15);
      --pill-bg: rgba(15, 23, 42, 0.8);
      --pill-border: rgba(75, 85, 99, 0.85);
      --pill-selected-bg: rgba(59, 130, 246, 0.25);
      --pill-selected-border: #38bdf8;
      --font-base: 18px;
      --font-sm: 15px;
      --font-xs: 13px;
      --radius-lg: 18px;
      --radius-pill: 999px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        Segoe UI, Roboto, sans-serif;
      background: radial-gradient(circle at top, #020617, #02040a 45%, #000 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    .app-shell {
      max-width: 1200px;
      margin: 0 auto 40px auto;
    }

    .app-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
    }

    .app-title {
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .tagline {
      font-size: var(--font-xs);
      color: var(--text-soft);
    }

    .top-pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 8px;
      font-size: var(--font-xs);
    }

    .top-pill {
      padding: 3px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.85);
      color: var(--text-soft);
      white-space: nowrap;
    }

    .app-grid {
      margin-top: 10px;
      display: grid;
      grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr);
      gap: 10px;
    }

    @media (max-width: 960px) {
      .app-grid {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    #right-column {
      position: sticky;
      top: 10px;
      align-self: flex-start;
      height: fit-content;
    }

    @media (max-width: 960px) {
      #right-column {
        position: static;
      }
    }

    .card {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      padding: 14px 14px 12px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.75);
      margin-bottom: 10px;
    }

    .card-tight {
      padding-top: 9px;
      padding-bottom: 9px;
    }

    .card-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      margin-bottom: 4px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.18em;
      text-transform: uppercase;
    }

    .card-sub {
      font-size: var(--font-xs);
      color: var(--text-soft);
    }

    .input-label {
      font-size: var(--font-sm);
      font-weight: 500;
      margin-bottom: 4px;
    }

    .helper-text {
      font-size: var(--font-xs);
      color: var(--text-soft);
      line-height: 1.4;
    }

    .pill-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 6px;
    }

    .pill {
      padding: 4px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid var(--pill-border);
      background: var(--pill-bg);
      color: var(--text-soft);
      font-size: var(--font-xs);
      cursor: pointer;
      transition: background 0.12s ease, border-color 0.12s ease,
        color 0.12s ease, box-shadow 0.12s ease;
      white-space: nowrap;
    }

    .pill.selected {
      background: var(--pill-selected-bg);
      color: #e5f2ff;
      border-color: var(--pill-selected-border);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
    }

    .pill.ghost {
      background: transparent;
      border-style: dashed;
    }

    input[type="range"] {
      width: 100%;
      accent-color: #38bdf8;
      cursor: pointer;
    }

    .time-row {
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 4px;
    }

    .time-row input[type="time"] {
      background: #020617;
      border-radius: 10px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      padding: 5px 8px;
      color: var(--text-main);
      font-size: var(--font-sm);
    }

    .time-row input[type="number"] {
      width: 80px;
      background: #020617;
      border-radius: 10px;
      border: 1px solid rgba(75, 85, 99, 0.9);
      padding: 4px 6px;
      color: var(--text-main);
      font-size: var(--font-sm);
    }

    .search-row {
      display: flex;
      gap: 6px;
      margin-top: 4px;
      margin-bottom: 6px;
    }

    .search-row input {
      flex: 1;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: #020617;
      padding: 6px 10px;
      color: var(--text-main);
      font-size: var(--font-sm);
    }

    .search-row button {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(75, 85, 99, 0.9);
      background: #020617;
      padding: 6px 12px;
      color: var(--text-soft);
      font-size: var(--font-xs);
      cursor: pointer;
    }

    .meal-grid-wrapper {
      max-height: 215px;
      overflow-y: auto;
      padding-right: 3px;
      margin-top: 4px;
      border-radius: 14px;
      border: 1px solid rgba(31, 41, 55, 0.9);
      background: radial-gradient(circle at top left, #020617, #02040a);
    }

    .meal-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 6px;
      padding: 6px;
    }

    .meal-card {
      border-radius: 14px;
      border: 1px solid rgba(55, 65, 81, 0.9);
      padding: 7px 8px 6px 8px;
      background: rgba(15, 23, 42, 0.95);
      font-size: var(--font-xs);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 2px;
      transition: border-color 0.12s ease, box-shadow 0.12s ease,
        background 0.12s ease;
    }

    .meal-card.selected {
      border-color: var(--pill-selected-border);
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.5);
      background: radial-gradient(circle at top left, #0b1120, #020617);
    }

    .meal-title-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 4px;
    }

    .meal-name {
      font-weight: 500;
      color: #e5e7eb;
    }

    .meal-tag {
      font-size: 11px;
      color: #f97316;
      white-space: nowrap;
    }

    .meal-meta {
      color: var(--text-soft);
      font-size: 11px;
    }

    .risk-bar-shell {
      margin-top: 4px;
      margin-bottom: 8px;
    }

    .risk-bar-gradient {
      width: 100%;
      height: 16px;
      border-radius: 999px;
      background: linear-gradient(
        90deg,
        #22c55e 0%,
        #facc15 45%,
        #fb923c 65%,
        #ef4444 100%
      );
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 0 1px var(--border-strong);
    }

    .risk-marker-line {
      position: absolute;
      top: -2px;
      width: 2px;
      height: 24px;
      background: #f9fafb;
      border-radius: 999px;
    }

    .risk-label-row {
      display: flex;
      justify-content: space-between;
      font-size: var(--font-xs);
      color: var(--text-soft);
      margin-top: 3px;
    }

    .big-score {
      font-size: 34px;
      font-weight: 700;
      text-align: center;
      margin: 2px 0;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(34, 197, 94, 0.7);
      background: rgba(22, 163, 74, 0.2);
      font-size: var(--font-xs);
      color: #bbf7d0;
    }

    .status-pill.mod {
      border-color: rgba(234, 179, 8, 0.8);
      background: rgba(234, 179, 8, 0.22);
      color: #fef3c7;
    }

    .status-pill.high {
      border-color: rgba(239, 68, 68, 0.85);
      background: rgba(239, 68, 68, 0.26);
      color: #fee2e2;
    }

    .right-score-row {
      display: flex;
      justify-content: center;
      gap: 8px;
      align-items: center;
      margin-bottom: 4px;
    }

    .timeline-bar-shell {
      margin: 10px 0 4px 0;
    }

    .timeline-bar {
      display: flex;
      height: 16px;
      border-radius: 999px;
      overflow: hidden;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.9);
    }

    .timeline-seg-spike {
      flex: 1;
      background: #facc15;
    }

    .timeline-seg-crash {
      flex: 1;
      background: #fb7185;
    }

    .timeline-seg-recov {
      flex: 2;
      background: #38bdf8;
    }

    .timeline-marker-line {
      position: absolute;
      top: -2px;
      width: 2px;
      height: 24px;
      background: #f9fafb;
      border-radius: 999px;
    }

    .timeline-legend {
      display: flex;
      gap: 12px;
      font-size: var(--font-xs);
      margin-top: 10px;
      margin-bottom: 4px;
      color: var(--text-soft);
      flex-wrap: wrap;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      display: inline-block;
      margin-right: 4px;
    }

    .dot-yellow {
      background: #facc15;
    }

    .dot-red {
      background: #fb7185;
    }

    .dot-blue {
      background: #38bdf8;
    }

    .footer {
      font-size: var(--font-xs);
      color: var(--text-soft);
      margin-top: 10px;
      text-align: left;
    }

    .copy-btn {
      border-radius: var(--radius-pill);
      padding: 4px 10px;
      font-size: var(--font-xs);
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-soft);
      cursor: pointer;
    }

    .copy-btn.success {
      border-color: rgba(22, 163, 74, 0.9);
      color: #bbf7d0;
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div>
        <div class="app-title">Carb / sugar anxiety timing explorer</div>
        <div class="tagline">
          Rough biology model for post-meal anxiety spikes. Free, anonymous, no login.
        </div>
      </div>
      <button id="copySummaryBtn" class="copy-btn">Copy summary</button>
    </header>

    <div class="top-pill-row">
      <div class="top-pill">Focus: post-meal hours, not psychology</div>
      <div class="top-pill">Built for sensitive gut / nervous system people</div>
      <div class="top-pill">Free for personal use and sharing</div>
    </div>

    <div class="app-grid">
      <!-- LEFT COLUMN -->
      <section id="left-column">
        <div class="card">
          <div class="card-title-row">
            <div class="card-title">Basic timing and sensitivity</div>
            <div class="card-sub">Fill this in first; the gauge updates instantly.</div>
          </div>

          <div style="margin-bottom:10px;">
            <div class="input-label">Time since you started eating</div>
            <div class="time-row">
              <input id="minutesSinceMeal" type="range" min="0" max="240" value="0" />
              <div id="minutesSinceMealLabel" class="helper-text" style="min-width:90px;">
                Just now
              </div>
            </div>
            <div class="helper-text">
              0 to 240 minutes; most people feel carb and caffeine waves between 60 and 180 minutes.
            </div>
          </div>

          <div style="margin-bottom:10px;">
            <div class="input-label">About what time did you eat this meal?</div>
            <div class="time-row">
              <input id="mealClockTime" type="time" />
              <div class="helper-text">
                Optional; this lets the timeline show your spike and crash in clock time.
              </div>
            </div>
          </div>

          <div style="margin-bottom:8px;">
            <div class="input-label">Mode</div>
            <div class="pill-buttons">
              <button class="pill selected" data-mode="simple" id="modeSimpleBtn">
                Simple (tap foods)
              </button>
              <button class="pill" data-mode="advanced" id="modeAdvancedBtn">
                Advanced (enter numbers)
              </button>
            </div>
            <div class="helper-text" style="margin-top:4px;">
              Simple mode is fine for most people; advanced is for nutrition labels and data nerds.
            </div>
          </div>

          <div style="margin-top:10px;">
            <div class="input-label">How sensitive is your system today?</div>
            <div class="pill-buttons">
              <button class="pill selected sens-btn" data-sens="0">Low</button>
              <button class="pill sens-btn" data-sens="1">Typical</button>
              <button class="pill sens-btn" data-sens="2">Very sensitive</button>
            </div>
            <div class="helper-text" style="margin-top:4px;">
              This is your overall ‚Äúwiring‚Äù today; sleep, stress, hormones and IBS flares can all turn the dial up.
            </div>
          </div>
        </div>
                <div class="card">
          <div class="card-title-row">
            <div class="card-title">Meal and pattern</div>
            <div class="card-sub" id="modeLabel">Simple: tap foods that look closest.</div>
          </div>

          <!-- SIMPLE MODE -->
          <div id="simpleModeBlock">
            <div class="input-label">Simple: what did this meal look like?</div>
            <div class="helper-text">
              Tap something close; it does not have to be perfect.
            </div>

            <div class="search-row">
              <input
                id="mealSearchInput"
                type="text"
                placeholder="Search: pasta, pizza, salad, burger, cereal, soda..."
              />
              <button id="mealSearchClearBtn">Clear</button>
            </div>

            <div class="meal-grid-wrapper">
              <div id="mealGrid" class="meal-grid"></div>
            </div>

            <div id="selectedMealText" class="helper-text" style="margin-top:4px;">
              No meal selected yet.
            </div>
          </div>

          <!-- ADVANCED MODE -->
          <div id="advancedModeBlock" style="display:none; margin-top:4px;">
            <div class="input-label">Advanced: enter approximate grams</div>
            <div class="helper-text" style="margin-bottom:6px;">
              This is for labels and food tracking apps. If you are not sure, stick with simple mode.
            </div>
            <div class="time-row" style="margin-bottom:4px;">
              <label class="helper-text" style="min-width:110px;">Total carbs (g)</label>
              <input id="advCarbs" type="number" min="0" max="250" value="0" />
            </div>
            <div class="time-row" style="margin-bottom:4px;">
              <label class="helper-text" style="min-width:110px;">Added sugar (g)</label>
              <input id="advSugar" type="number" min="0" max="150" value="0" />
            </div>
            <div class="time-row">
              <label class="helper-text" style="min-width:110px;">Caffeine (mg)</label>
              <input id="advCaffeine" type="number" min="0" max="400" value="0" />
            </div>
          </div>

          <hr style="border:none; border-top:1px solid rgba(30,64,175,0.8); margin:10px 0 8px 0;" />

          <div style="margin-bottom:8px;">
            <div class="input-label">Extra dessert / sweets</div>
            <div class="pill-buttons">
              <button class="pill selected dessert-btn" data-dessert="0">None</button>
              <button class="pill dessert-btn" data-dessert="10">Small treat (~10 g sugar)</button>
              <button class="pill dessert-btn" data-dessert="20">Medium dessert (~20 g)</button>
              <button class="pill dessert-btn" data-dessert="35">Big dessert (~35 g)</button>
            </div>
            <div class="helper-text" style="margin-top:4px;">
              Examples: 2 cookies ‚âà 18 g, typical candy bar ‚âà 25 g, big dessert plate ‚âà 30‚Äì40 g, pint of ice cream can be 60+ g.
            </div>
            <div class="time-row" style="margin-top:4px;">
              <label class="helper-text" style="min-width:160px;">Or enter sugar directly (g)</label>
              <input id="extraSugarInput" type="number" min="0" max="120" value="0" />
            </div>
          </div>

          <div style="margin-bottom:8px;">
            <div class="input-label">Soda / sugary drink with this meal</div>
            <div class="pill-buttons">
              <button class="pill selected soda-btn" data-soda="none">No sugary drink</button>
              <button class="pill soda-btn" data-soda="smallNoCaff">Small soda, no caffeine</button>
              <button class="pill soda-btn" data-soda="largeNoCaff">Large soda, no caffeine</button>
              <button class="pill soda-btn" data-soda="smallCaff">Small caffeinated soda</button>
              <button class="pill soda-btn" data-soda="largeCaff">Large caffeinated soda</button>
            </div>
            <div class="helper-text" style="margin-top:4px;">
              Pick what is closest; we will estimate sugar and caffeine based on typical cans and fountain sizes.
            </div>
          </div>

          <div style="margin-bottom:8px;">
            <div class="input-label">Coffee or energy drink near this meal</div>
            <div class="pill-buttons">
              <button class="pill selected coffee-btn" data-coffee="none">No coffee or energy drink</button>
              <button class="pill coffee-btn" data-coffee="small">Small coffee / tea</button>
              <button class="pill coffee-btn" data-coffee="strong">Strong coffee or energy drink</button>
            </div>
            <div class="helper-text" style="margin-top:4px;">
              If you drink coffee hours earlier, slide the time-since-meal and sensitivity to see how it stacks.
            </div>
          </div>

          <hr style="border:none; border-top:1px solid rgba(30,64,175,0.8); margin:10px 0 8px 0;" />

          <div style="margin-bottom:6px;">
            <div class="input-label">Rest of day and sensitivity</div>

            <div style="margin-bottom:4px;">
              <div class="helper-text" style="margin-bottom:2px;">How carb-heavy has the rest of your day been?</div>
              <div class="pill-buttons">
                <button class="pill daycarb-btn selected" data-daycarb="0">Low</button>
                <button class="pill daycarb-btn" data-daycarb="1">Medium</button>
                <button class="pill daycarb-btn" data-daycarb="2">High</button>
              </div>
              <div class="helper-text" style="margin-top:2px;">
                0 = mostly light / low carb so far, 2 = lots of bread, pasta, sweets, snacks earlier.
              </div>
            </div>

            <div style="margin-bottom:4px;">
              <div class="helper-text" style="margin-bottom:2px;">Visceral sensitivity (gut volume knob)</div>
              <div class="pill-buttons">
                <button class="pill visc-btn" data-visc="0">Low</button>
                <button class="pill visc-btn selected" data-visc="1">Medium</button>
                <button class="pill visc-btn" data-visc="2">High</button>
              </div>
              <div class="helper-text" style="margin-top:2px;">
                0 = gut rarely complains, 2 = gut feels every bubble and stretch.
              </div>
            </div>

            <div>
              <div class="helper-text" style="margin-bottom:2px;">Anxiety system sensitivity</div>
              <div class="pill-buttons">
                <button class="pill anx-btn" data-anx="0">Low</button>
                <button class="pill anx-btn selected" data-anx="1">Medium</button>
                <button class="pill anx-btn" data-anx="2">High</button>
              </div>
              <div class="helper-text" style="margin-top:2px;">
                0 = rarely anxious, 2 = nervous system that notices every little crash and flutter.
              </div>
            </div>
          </div>
        </div>
      </section>
            <!-- RIGHT COLUMN -->
      <section id="right-column">
        <div class="card">
          <div class="card-title-row">
            <div class="card-title">Risk gauge</div>
            <div class="card-sub">0‚Äì49 Low, 50‚Äì74 Moderate, 75+ High</div>
          </div>

          <div class="risk-bar-shell">
            <div class="risk-bar-gradient">
              <div id="riskMarker" class="risk-marker-line" style="left:0%;"></div>
            </div>
            <div class="risk-label-row">
              <span>Low</span><span>25</span><span>50</span><span>75</span><span>100</span>
            </div>
          </div>

          <div class="big-score" id="bigScore">0 / 100</div>
          <div class="right-score-row">
            <div id="statusPill" class="status-pill">
              <span id="statusText">Current score 0 of 100</span>
              <span id="statusLevel">Low</span>
            </div>
          </div>
          <div class="helper-text">
            Biology says this pattern should feel fairly steady for most people.
          </div>
        </div>

        <div class="card">
          <div class="card-title-row">
            <div class="card-title">Spike ‚Üí crash ‚Üí recovery timeline</div>
          </div>
          <div class="helper-text">
            Add a rough meal time to see your crash window in clock time.
          </div>

          <div class="timeline-bar-shell" style="position:relative;">
            <div class="timeline-bar">
              <div class="timeline-seg-spike"></div>
              <div class="timeline-seg-crash"></div>
              <div class="timeline-seg-recov"></div>
            </div>
            <div id="timelineMarkerLine" class="timeline-marker-line" style="left:0%;"></div>
            <div
              id="timelineMarkerLabel"
              style="position:absolute; top:28px; transform:translateX(-50%); font-size:11px; color:var(--text-soft);"
            >
              You are here
            </div>
          </div>

          <div class="timeline-legend">
            <span><span class="dot dot-yellow"></span>Spike window</span>
            <span><span class="dot dot-red"></span>Crash / anxiety window</span>
            <span><span class="dot dot-blue"></span>Recovery</span>
          </div>

          <div class="helper-text" style="margin-bottom:6px;">
            Add meal, sugar, caffeine and timing to see where you sit in the 0‚Äì240 minute wave.
          </div>

          <div style="display:flex; flex-wrap:wrap; gap:16px; font-size:var(--font-sm); margin-top:6px;">
            <div style="flex:1 1 160px;">
              <div style="font-weight:600;">Spike window</div>
              <div id="spikeClockText" class="helper-text">‚Äî</div>
            </div>
            <div style="flex:1 1 180px;">
              <div style="font-weight:600;">Crash / anxiety window</div>
              <div id="crashClockText" class="helper-text">‚Äî</div>
            </div>
            <div style="flex:1 1 180px;">
              <div style="font-weight:600;">Recovery trend</div>
              <div id="recoveryClockText" class="helper-text">‚Äî</div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-title-row">
            <div class="card-title">Quick summary</div>
          </div>
          <div id="quickSummaryText" class="helper-text" style="margin-bottom:8px;">
            0/100 risk until you add a meal, sugar, caffeine and timing. This is just a pattern explorer, not a diagnosis.
          </div>
          <button id="whyBtn" class="pill" style="margin-bottom:6px;">
            Why am I feeling this way?
          </button>
          <div id="whyPanel" class="helper-text" style="display:none;">
            If the timing of your wave lines up with the crash window, biology is likely doing most of the work:
            blood sugar overshoot, insulin shift, gut-brain nerve traffic, and your sensitivity level. If the timing
            does not match at all, stress, thoughts or something else may be carrying more of the load.
          </div>
        </div>

        <!-- Body snapshot ABOVE what this is and is not -->
        <div class="card card-tight">
          <div class="card-title-row">
            <div class="card-title">Body snapshot</div>
          </div>
          <div class="helper-text">Tap what feels closest right now:</div>
          <div class="pill-buttons" style="margin-top:6px;">
            <button class="pill symptom-btn" data-symptom="jittery">Jittery / wired / inner buzz</button>
            <button class="pill symptom-btn" data-symptom="warmChest">Warm chest / adrenaline rush</button>
            <button class="pill symptom-btn" data-symptom="gutBuzz">Gut buzzing / bloating</button>
            <button class="pill symptom-btn" data-symptom="flat">Flat / tired / drained</button>
            <button class="pill symptom-btn" data-symptom="headache">Headache instead of gut pain</button>
          </div>
          <div id="symptomText" class="helper-text" style="margin-top:8px;">
            We will compare your pick to the predicted crash window and show whether biology is likely driving it.
          </div>
        </div>

        <div class="card">
          <div class="card-title-row">
            <div class="card-title">What this is and is not</div>
          </div>
          <div class="helper-text" style="margin-bottom:6px;">
            This is a rough timing model for people who notice that carbs, sugar and caffeine can create waves of anxiety a couple of hours later, especially if they also have IBS or visceral hypersensitivity.
          </div>
          <div class="helper-text">
            It is not a diagnosis. If you ever have chest pain, severe shortness of breath, or feel unsafe, that is an emergency issue for real-world care, not a timing calculator.
          </div>
        </div>

        <div class="footer">
          ¬© 2025 Darkstar747. Free for personal use and community sharing. Not for commercial use, resale, or paywalled distribution.
        </div>
      </section>
    </div>
  </div>
  <script>
  // ---------- FOOD PRESETS (lots of common meals) ----------
  const mealPresets = [
    // Breakfast ‚Äì higher carb
    { id: "pancakes", emoji: "ü•û", name: "Pancakes with syrup", category: "Breakfast, sweet", carbs: 65, fiber: 2, fatLevel: 1, sugarBase: 20, tag: "High carb + sugar" },
    { id: "waffles", emoji: "üßá", name: "Waffles with syrup", category: "Breakfast, sweet", carbs: 65, fiber: 2, fatLevel: 1, sugarBase: 20, tag: "High carb + sugar" },
    { id: "frenchToast", emoji: "üçû", name: "French toast with syrup", category: "Breakfast, sweet", carbs: 60, fiber: 2, fatLevel: 1, sugarBase: 18, tag: "High carb + sugar" },
    { id: "cerealSweet", emoji: "ü•£", name: "Sugary cereal with milk", category: "Breakfast", carbs: 55, fiber: 2, fatLevel: 1, sugarBase: 18, tag: "Sugary" },
    { id: "oatmealFruit", emoji: "ü•£", name: "Oatmeal with fruit", category: "Breakfast, warm", carbs: 45, fiber: 6, fatLevel: 0, sugarBase: 8, tag: "Medium carb, higher fiber" },
    { id: "bagelCreamCheese", emoji: "ü•Ø", name: "Bagel with cream cheese", category: "Breakfast or snack", carbs: 60, fiber: 3, fatLevel: 2, sugarBase: 4, tag: "High carb" },
    { id: "eggsToast", emoji: "üç≥", name: "Eggs with toast", category: "Breakfast plate", carbs: 25, fiber: 2, fatLevel: 2, sugarBase: 2, tag: "Medium carb" },
    { id: "bigBreakfast", emoji: "ü•ì", name: "Big breakfast platter", category: "Eggs, potatoes, toast", carbs: 55, fiber: 3, fatLevel: 2, sugarBase: 4, tag: "Medium carb + fat" },

    // Sandwich / lunch
    { id: "turkeySandwich", emoji: "ü•™", name: "Turkey sandwich", category: "Lunch", carbs: 40, fiber: 4, fatLevel: 1, sugarBase: 3, tag: "Medium carb" },
    { id: "hamCheese", emoji: "ü•™", name: "Ham and cheese sandwich", category: "Lunch", carbs: 40, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "Medium carb + fat" },
    { id: "grilledCheese", emoji: "üßÄ", name: "Grilled cheese sandwich", category: "Lunch", carbs: 35, fiber: 2, fatLevel: 2, sugarBase: 2, tag: "Medium carb + fat" },
    { id: "chickenSaladSandwich", emoji: "ü•™", name: "Chicken salad sandwich", category: "Lunch", carbs: 40, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "Medium carb + fat" },
    { id: "veggieWrap", emoji: "üåØ", name: "Veggie wrap", category: "Lunch wrap", carbs: 40, fiber: 5, fatLevel: 1, sugarBase: 3, tag: "Medium carb, higher fiber" },
    { id: "saladLowCarb", emoji: "ü•ó", name: "Green salad, low carb", category: "Lighter meal", carbs: 18, fiber: 6, fatLevel: 1, sugarBase: 1, tag: "Light" },
    { id: "cobbSalad", emoji: "ü•ó", name: "Cobb salad", category: "Salad with protein", carbs: 20, fiber: 5, fatLevel: 2, sugarBase: 2, tag: "Lower carb, higher fat" },

    // Pasta / rice / bowls
    { id: "pastaPlate", emoji: "üçù", name: "Plate of pasta", category: "Dinner, Italian", carbs: 80, fiber: 3, fatLevel: 1, sugarBase: 3, tag: "High carb" },
    { id: "pastaTomato", emoji: "üçù", name: "Pasta with tomato sauce", category: "Dinner, Italian", carbs: 80, fiber: 4, fatLevel: 1, sugarBase: 4, tag: "High carb" },
    { id: "pastaAlfredo", emoji: "üçù", name: "Pasta with Alfredo", category: "Creamy pasta", carbs: 80, fiber: 3, fatLevel: 2, sugarBase: 3, tag: "High carb + fat" },
    { id: "ramen", emoji: "üçú", name: "Ramen or noodle bowl", category: "Asian noodles", carbs: 65,fiber:3,fatLevel:1,sugarBase:3,tag:"High carb" },
    { id: "friedRice", emoji: "üçõ", name: "Fried rice", category: "Chinese style", carbs: 75,fiber:3,fatLevel:2,sugarBase:3,tag:"High carb + fat" },
    { id: "riceBowl", emoji: "üçö", name: "Rice bowl with toppings", category: "Rice bowl", carbs: 70,fiber:2,fatLevel:0,sugarBase:2,tag:"High carb" },
    { id: "curryRice", emoji: "üçõ", name: "Curry with rice", category: "Indian / Thai", carbs: 70,fiber:4,fatLevel:2,sugarBase:4,tag:"High carb + fat" },
    { id: "burrito", emoji: "üåØ", name: "Burrito", category: "Mexican", carbs: 75,fiber:6,fatLevel:2,sugarBase:3,tag:"High carb" },
    { id: "tacos3", emoji: "üåÆ", name: "Tacos, 3", category: "Mexican", carbs: 50,fiber:4,fatLevel:1,sugarBase:2,tag:"Medium carb" },
    { id: "chipotleBowl", emoji: "ü•ó", name: "Burrito bowl", category: "Mexican bowl", carbs: 65,fiber:7,fatLevel:2,sugarBase:3,tag:"High carb, higher fiber" },
    { id: "sushi12", emoji: "üç£", name: "Sushi, 12 pieces", category: "Lighter dinner", carbs: 70,fiber:3,fatLevel:0,sugarBase:3,tag:"High carb, low fat" },
    { id: "pokeBowl", emoji: "üçö", name: "Poke bowl", category: "Rice bowl", carbs: 60,fiber:4,fatLevel:1,sugarBase:4,tag:"High carb" },

    // Pizza / fast food
    { id: "pizza2", emoji: "üçï", name: "Pizza, 2 slices", category: "Pizza dinner", carbs: 60,fiber:3,fatLevel:2,sugarBase:3,tag:"High carb + fat" },
    { id: "pizza3", emoji: "üçï", name: "Pizza, 3 slices", category: "Pizza dinner", carbs: 90,fiber:4,fatLevel:2,sugarBase:4,tag:"Very high carb" },
    { id: "burgerFries", emoji: "üçî", name: "Burger with fries", category: "Fast food", carbs: 70,fiber:4,fatLevel:2,sugarBase:4,tag:"Heavy" },
    { id: "burgerOnly", emoji: "üçî", name: "Burger, no fries", category: "Fast food", carbs: 45,fiber:2,fatLevel:2,sugarBase:2,tag:"Medium carb" },
    { id: "chickenSandwichFries", emoji: "üçó", name: "Crispy chicken sandwich + fries", category:"Fast food", carbs:75,fiber:4,fatLevel:2,sugarBase:4,tag:"High carb + fat" },
    { id: "steakPotato", emoji: "ü•©", name: "Steak with baked potato", category:"Dinner plate", carbs:50,fiber:4,fatLevel:2,sugarBase:1,tag:"Medium carb + fat" },
    { id: "chickenVeg", emoji: "üçó", name: "Chicken with vegetables", category:"Dinner plate", carbs:20,fiber:4,fatLevel:1,sugarBase:1,tag:"Lower carb" },

    // Snacks
    { id: "chipsBag", emoji: "üçü", name: "Bag of chips", category:"Snack", carbs:30,fiber:2,fatLevel:2,sugarBase:1,tag:"Medium carb + fat" },
    { id: "popcornBowl", emoji: "üçø", name: "Bowl of popcorn", category:"Snack", carbs:25,fiber:4,fatLevel:1,sugarBase:1,tag:"Medium carb" },
    { id: "nutsHandful", emoji: "ü•ú", name: "Handful of nuts", category:"Snack", carbs:8,fiber:3,fatLevel:2,sugarBase:1,tag:"Mostly fat and fiber" },
    { id: "trailMix", emoji: "ü•ú", name: "Trail mix", category:"Snack", carbs:25,fiber:4,fatLevel:2,sugarBase:10,tag:"Medium carb + sugar" },
    { id: "applePb", emoji: "üçé", name: "Apple with peanut butter", category:"Snack", carbs:30,fiber:4,fatLevel:1,sugarBase:15,tag:"Medium carb" },
    { id: "banana", emoji: "üçå", name: "Banana", category:"Snack", carbs:25,fiber:3,fatLevel:0,sugarBase:14,tag:"Medium carb, natural sugar" },
    { id: "proteinBar", emoji: "üç´", name: "Protein bar", category:"Snack", carbs:25,fiber:4,fatLevel:1,sugarBase:8,tag:"Medium carb" },

    // Desserts
    { id: "iceCream", emoji: "üç®", name: "Ice cream bowl", category:"Dessert", carbs:45,fiber:1,fatLevel:2,sugarBase:28,tag:"High sugar" },
    { id: "cakeSlice", emoji: "üç∞", name: "Slice of cake", category:"Dessert", carbs:45,fiber:1,fatLevel:2,sugarBase:28,tag:"High sugar" },
    { id: "brownie", emoji: "üç´", name: "Brownie", category:"Dessert", carbs:40,fiber:2,fatLevel:2,sugarBase:25,tag:"High sugar" },
    { id: "cookies2", emoji: "üç™", name: "Cookies, 2", category:"Dessert", carbs:30,fiber:1,fatLevel:2,sugarBase:18,tag:"High sugar" },
    { id: "donut", emoji: "üç©", name: "Donut", category:"Dessert / breakfast", carbs:40,fiber:1,fatLevel:2,sugarBase:20,tag:"High sugar" },

    // Drinks ‚Äì sugary
    { id: "sodaCan", emoji: "ü•§", name: "Soda, 12 oz can", category:"Sugary drink", carbs:39,fiber:0,fatLevel:0,sugarBase:39,tag:"High sugar" },
    { id: "sodaLarge", emoji: "ü•§", name: "Soda, large", category:"Sugary drink", carbs:60,fiber:0,fatLevel:0,sugarBase:60,tag:"Very high sugar" },
    { id: "sweetTea", emoji: "ü•§", name: "Sweet tea", category:"Sugary drink", carbs:35,fiber:0,fatLevel:0,sugarBase:35,tag:"High sugar" },
    { id: "sportsDrink", emoji: "ü•§", name: "Sports drink", category:"Sugary drink", carbs:30,fiber:0,fatLevel:0,sugarBase:30,tag:"High sugar" },
    { id: "fruitJuice", emoji: "üßÉ", name: "Fruit juice glass", category:"Sugary drink", carbs:30,fiber:0,fatLevel:0,sugarBase:28,tag:"High sugar" },

    // Drinks ‚Äì coffee baseline
    { id: "latte", emoji: "‚òïÔ∏è", name: "Latte, medium", category:"Coffee drink", carbs:18,fiber:0,fatLevel:1,sugarBase:15,tag:"Medium sugar" },
    { id: "blackCoffee", emoji: "‚òïÔ∏è", name: "Black coffee", category:"Coffee, no sugar", carbs:0,fiber:0,fatLevel:0,sugarBase:0,tag:"No sugar" },

    // Catch-all
    { id: "otherHeavy", emoji: "üçΩÔ∏è", name: "Other heavy carb dinner", category:"General", carbs:75,fiber:3,fatLevel:1,sugarBase:3,tag:"Heavy" },
    { id: "otherLight", emoji: "ü•ó", name: "Other lighter plate", category:"General", carbs:25,fiber:4,fatLevel:1,sugarBase:2,tag:"Light to medium carb" }
  ];

  // ---------- ELEMENT REFERENCES ----------
  const elements = {
    minutesSinceMeal: document.getElementById("minutesSinceMeal"),
    minutesSinceMealLabel: document.getElementById("minutesSinceMealLabel"),
    mealClockTime: document.getElementById("mealClockTime"),
    modeSimpleBtn: document.getElementById("modeSimpleBtn"),
    modeAdvancedBtn: document.getElementById("modeAdvancedBtn"),
    modeLabel: document.getElementById("modeLabel"),
    simpleModeBlock: document.getElementById("simpleModeBlock"),
    advancedModeBlock: document.getElementById("advancedModeBlock"),
    mealSearchInput: document.getElementById("mealSearchInput"),
    mealSearchClearBtn: document.getElementById("mealSearchClearBtn"),
    mealGrid: document.getElementById("mealGrid"),
    selectedMealText: document.getElementById("selectedMealText"),
    advCarbs: document.getElementById("advCarbs"),
    advSugar: document.getElementById("advSugar"),
    advCaffeine: document.getElementById("advCaffeine"),
    extraSugarInput: document.getElementById("extraSugarInput"),
    riskMarker: document.getElementById("riskMarker"),
    bigScore: document.getElementById("bigScore"),
    statusPill: document.getElementById("statusPill"),
    statusText: document.getElementById("statusText"),
    statusLevel: document.getElementById("statusLevel"),
    spikeClockText: document.getElementById("spikeClockText"),
    crashClockText: document.getElementById("crashClockText"),
    recoveryClockText: document.getElementById("recoveryClockText"),
    quickSummaryText: document.getElementById("quickSummaryText"),
    whyBtn: document.getElementById("whyBtn"),
    whyPanel: document.getElementById("whyPanel"),
    copySummaryBtn: document.getElementById("copySummaryBtn"),
    timelineMarkerLine: document.getElementById("timelineMarkerLine"),
    timelineMarkerLabel: document.getElementById("timelineMarkerLabel")
  };

  let selectedMealId = null;
  let mode = "simple";

  // helper for minutesSince label
  function minutesLabel(min) {
    if (min === 0) return "Just now";
    if (min <= 30) return `${min} min`;
    const hours = Math.floor(min / 60);
    const rem = min % 60;
    if (rem === 0) return `${hours} hr`;
    return `${hours} hr ${rem} min`;
  }

  elements.minutesSinceMeal.addEventListener("input", () => {
    const v = parseInt(elements.minutesSinceMeal.value, 10);
    elements.minutesSinceMealLabel.textContent = minutesLabel(v);
    updateScore();
  });

  // mode switching
  elements.modeSimpleBtn.addEventListener("click", () => {
    mode = "simple";
    elements.modeSimpleBtn.classList.add("selected");
    elements.modeAdvancedBtn.classList.remove("selected");
    elements.simpleModeBlock.style.display = "";
    elements.advancedModeBlock.style.display = "none";
    elements.modeLabel.textContent = "Simple: tap foods that look closest.";
    updateScore();
  });
  elements.modeAdvancedBtn.addEventListener("click", () => {
    mode = "advanced";
    elements.modeAdvancedBtn.classList.add("selected");
    elements.modeSimpleBtn.classList.remove("selected");
    elements.simpleModeBlock.style.display = "none";
    elements.advancedModeBlock.style.display = "";
    elements.modeLabel.textContent = "Advanced: use label numbers for this meal.";
    updateScore();
  });

  // sensitivity buttons
  document.querySelectorAll(".sens-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".sens-btn").forEach((b) => b.classList.remove("selected"));
      btn.classList.add("selected");
      updateScore();
    });
  });

  ["dessert-btn", "soda-btn", "coffee-btn", "daycarb-btn", "visc-btn", "anx-btn"].forEach(
    (cls) => {
      document.querySelectorAll("." + cls).forEach((btn) => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("." + cls).forEach((b) => b.classList.remove("selected"));
          btn.classList.add("selected");
          updateScore();
        });
      });
    }
  );

  // symptom buttons
  document.querySelectorAll(".symptom-btn").forEach((btn) => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".symptom-btn").forEach((b) => b.classList.remove("selected"));
      btn.classList.add("selected");
      const kind = btn.dataset.symptom;
      let txt = "We will compare this to the predicted crash window.";
      if (kind === "jittery" || kind === "warmChest") {
        txt = "Jittery or warm-chest feelings that land squarely in the crash window are classic sugar / caffeine biology, not you \"going crazy.\"";
      } else if (kind === "gutBuzz") {
        txt = "Gut buzzing in the spike or crash window fits a carb + visceral sensitivity pattern. Outside that window, IBS baseline or gas is more likely.";
      } else if (kind === "flat") {
        txt = "Flat or drained feelings that show up late in the crash window are often the tail of an insulin and adrenaline swing.";
      } else if (kind === "headache") {
        txt = "Headaches in your crash window can be part of the same wave, especially if you also get relief when your gut calms down.";
      }
      document.getElementById("symptomText").textContent = txt;
    });
  });

  elements.mealClockTime.addEventListener("change", updateScore);
  elements.extraSugarInput.addEventListener("input", updateScore);
  ["advCarbs", "advSugar", "advCaffeine"].forEach((id) => {
    elements[id].addEventListener("input", updateScore);
  });

  // build meal grid
  function renderMeals(filterText = "") {
    const q = filterText.trim().toLowerCase();
    elements.mealGrid.innerHTML = "";
    mealPresets
      .filter((m) => {
        if (!q) return true;
        return (
          m.name.toLowerCase().includes(q) ||
          m.category.toLowerCase().includes(q) ||
          (m.tag && m.tag.toLowerCase().includes(q))
        );
      })
      .forEach((meal) => {
        const card = document.createElement("div");
        card.className = "meal-card";
        card.dataset.id = meal.id;
        if (meal.id === selectedMealId) card.classList.add("selected");

        card.innerHTML = `
          <div class="meal-title-line">
            <div class="meal-name">${meal.emoji} ${meal.name}</div>
            <div class="meal-tag">${meal.tag}</div>
          </div>
          <div class="meal-meta">${meal.category}</div>
          <div class="meal-meta">~${meal.carbs} g carbs ¬∑ ~${meal.sugarBase} g sugar</div>
        `;
        card.addEventListener("click", () => {
          selectedMealId = meal.id;
          renderMeals(elements.mealSearchInput.value);
          elements.selectedMealText.textContent = "Selected meal: " + meal.name;
          updateScore();
        });

        elements.mealGrid.appendChild(card);
      });
  }

  renderMeals();

  elements.mealSearchInput.addEventListener("input", () => {
    renderMeals(elements.mealSearchInput.value);
  });
  elements.mealSearchClearBtn.addEventListener("click", () => {
    elements.mealSearchInput.value = "";
    renderMeals("");
  });

  // ---------- CORE MATH ----------
  function getSelectedValue(className, attr, defaultVal) {
    const btn = document.querySelector("." + className + ".selected");
    if (!btn) return defaultVal;
    return btn.getAttribute(attr);
  }

  function computeModel() {
    let carbs = 0;
    let sugar = 0;
    let caffeine = 0;

    if (mode === "simple") {
      if (selectedMealId) {
        const meal = mealPresets.find((m) => m.id === selectedMealId);
        if (meal) {
          carbs += meal.carbs;
          sugar += meal.sugarBase;
        }
      }
    } else {
      carbs += parseFloat(elements.advCarbs.value || "0");
      sugar += parseFloat(elements.advSugar.value || "0");
      caffeine += parseFloat(elements.advCaffeine.value || "0");
    }

    // dessert sugar
    const dessertSugar =
      parseFloat(getSelectedValue("dessert-btn", "data-dessert", "0")) || 0;
    sugar += dessertSugar;

    const extraSugar = parseFloat(elements.extraSugarInput.value || "0");
    if (extraSugar > 0) sugar += extraSugar;

    // soda logic
    const soda = getSelectedValue("soda-btn", "data-soda", "none");
    if (soda === "smallNoCaff") {
      sugar += 25;
    } else if (soda === "largeNoCaff") {
      sugar += 40;
    } else if (soda === "smallCaff") {
      sugar += 25;
      caffeine += 35;
    } else if (soda === "largeCaff") {
      sugar += 40;
      caffeine += 60;
    }

    // coffee logic
    const coffee = getSelectedValue("coffee-btn", "data-coffee", "none");
    if (coffee === "small") {
      caffeine += 80;
    } else if (coffee === "strong") {
      caffeine += 160;
    }

    // approximate carb load from sugar too
    carbs += sugar * 0.4;

    const minutes = parseInt(elements.minutesSinceMeal.value || "0", 10);
    const systemSens = parseInt(
      getSelectedValue("sens-btn", "data-sens", "0"),
      10
    );
    const dayCarb = parseInt(
      getSelectedValue("daycarb-btn", "data-daycarb", "0"),
      10
    );
    const visc = parseInt(getSelectedValue("visc-btn", "data-visc", "1"), 10);
    const anx = parseInt(getSelectedValue("anx-btn", "data-anx", "1"), 10);

    return {
      carbs,
      sugar,
      caffeine,
      minutes,
      systemSens,
      dayCarb,
      visc,
      anx
    };
  }

  function timeWaveMultiplier(min) {
    if (min <= 30) return 0.1;
    if (min <= 60) return 0.4;
    if (min <= 90) return 0.8;
    if (min <= 120) return 1.0;
    if (min <= 150) return 0.9;
    if (min <= 180) return 0.6;
    if (min <= 210) return 0.4;
    if (min <= 240) return 0.2;
    return 0.1;
  }

  function computeScore() {
    const s = computeModel();

    // base from carbs and sugar
    const carbFactor = Math.min(1, s.carbs / 120);
    const sugarFactor = Math.min(1, s.sugar / 55);
    const caffeineFactor = Math.min(1, s.caffeine / 250);

    let base = 55 * carbFactor + 25 * sugarFactor + 20 * caffeineFactor;

    // stacking / sensitivity
    const stackBoost = 1 + s.dayCarb * 0.12;
    const viscBoost = 1 + s.visc * 0.1;
    const anxBoost = 1 + s.anx * 0.12;
    const systemBoost = 1 + s.systemSens * 0.1;

    base *= stackBoost * viscBoost * anxBoost * systemBoost;

    // time of wave
    const timeMult = timeWaveMultiplier(s.minutes);
    const score = Math.max(0, Math.min(100, base * timeMult));

    return {
      score,
      effectiveTime: s.minutes,
      carbs: s.carbs,
      sugar: s.sugar,
      caffeine: s.caffeine
    };
  }

  function clockFromMinutesOffset(offsetMin) {
    const tValue = elements.mealClockTime.value;
    if (!tValue) return "Add meal time to see this.";
    const [hStr, mStr] = tValue.split(":");
    if (hStr == null) return "Add meal time to see this.";
    let total = parseInt(hStr, 10) * 60 + parseInt(mStr, 10);
    total += offsetMin;
    total = ((total % 1440) + 1440) % 1440;
    const h = Math.floor(total / 60);
    const m = total % 60;
    const ampm = h >= 12 ? "pm" : "am";
    const displayH = ((h + 11) % 12) + 1;
    const displayM = m.toString().padStart(2, "0");
    return `${displayH}:${displayM} ${ampm}`;
  }

  function updateTimeline(result) {
    const spikeStart = 45;
    const spikeEnd = 105;
    const crashStart = 105;
    const crashEnd = 165;
    const recovStart = 165;
    const recovEnd = 240;

    const spikeText = `${clockFromMinutesOffset(spikeStart)} ‚Äì ${clockFromMinutesOffset(
      spikeEnd
    )}`;
    const crashText = `${clockFromMinutesOffset(crashStart)} ‚Äì ${clockFromMinutesOffset(
      crashEnd
    )}`;
    const recovText = `${clockFromMinutesOffset(recovStart)} ‚Äì ${clockFromMinutesOffset(
      recovEnd
    )}`;

    elements.spikeClockText.textContent = spikeText;
    elements.crashClockText.textContent = crashText;
    elements.recoveryClockText.textContent = recovText;

    const rawPercent =
      (Math.max(0, Math.min(result.effectiveTime, 240)) / 240) * 100;
    const clampedPercent = Math.max(4, Math.min(96, rawPercent));
    elements.timelineMarkerLine.style.left = clampedPercent + "%";
    elements.timelineMarkerLabel.style.left = clampedPercent + "%";
  }

  function updateScore() {
    const result = computeScore();
    const score = Math.round(result.score);

    const percent = (score / 100) * 100;
    elements.riskMarker.style.left = `${Math.max(0, Math.min(100, percent))}%`;
    elements.bigScore.textContent = `${score} / 100`;
    elements.statusText.textContent = `Current score ${score} of 100`;

    let level = "Low";
    let pillClass = "status-pill";
    if (score >= 75) {
      level = "High";
      pillClass += " high";
    } else if (score >= 50) {
      level = "Moderate";
      pillClass += " mod";
    }
    elements.statusLevel.textContent = level;
    elements.statusPill.className = pillClass;

    let summary = "";
    if (score === 0 && !selectedMealId && result.sugar === 0 && result.caffeine === 0) {
      summary =
        "0/100 risk until you add a meal, sugar, caffeine and timing. This is just a pattern explorer, not a diagnosis.";
    } else {
      summary = `${score}/100 risk in the 1‚Äì4 hour window after this meal. `;
      if (result.caffeine > 0 && result.sugar > 0) {
        summary +=
          "This pattern is built from a carb-heavy plate plus added sugar and caffeine, stacked with how sensitive your gut and anxiety system are.";
      } else if (result.caffeine > 0) {
        summary +=
          "This wave is driven more by caffeine plus carb load and sensitivity, rather than sugar alone.";
      } else if (result.sugar > 0) {
        summary +=
          "This wave is mainly a sugar + carb effect adjusted by how carb-heavy the rest of the day was and how sensitive your system is.";
      } else {
        summary +=
          "This is mostly a carb timing effect plus your sensitivity today, with little added sugar or caffeine.";
      }
    }
    elements.quickSummaryText.textContent = summary;

    updateTimeline(result);
  }

  elements.whyBtn.addEventListener("click", () => {
    const visible = elements.whyPanel.style.display === "block";
    elements.whyPanel.style.display = visible ? "none" : "block";
  });

  elements.copySummaryBtn.addEventListener("click", async () => {
    try {
      const text =
        elements.quickSummaryText.textContent +
        "\n\nSpike window: " +
        elements.spikeClockText.textContent +
        "\nCrash window: " +
        elements.crashClockText.textContent +
        "\nRecovery trend: " +
        elements.recoveryClockText.textContent;
      await navigator.clipboard.writeText(text);
      elements.copySummaryBtn.classList.add("success");
      elements.copySummaryBtn.textContent = "Copied";
      setTimeout(() => {
        elements.copySummaryBtn.classList.remove("success");
        elements.copySummaryBtn.textContent = "Copy summary";
      }, 1800);
    } catch (e) {
      elements.copySummaryBtn.textContent = "Copy failed";
    }
  });

  // initial render
  updateScore();
</script>
</body>
</html>
