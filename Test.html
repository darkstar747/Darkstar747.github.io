<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Body Rhythm Console - Beta v0.1</title>
  <style>
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
      background: #05060a;
      color: #f2f2f7;
      display: flex;
      height: 100vh;
    }
    .console {
      margin: auto;
      width: 980px;
      height: 580px;
      border-radius: 24px;
      border: 2px solid #313446;
      display: grid;
      grid-template-columns: 2fr 1fr;
      background: radial-gradient(circle at top, #22263a 0, #090b13 40%, #05060a 80%);
      box-shadow: 0 22px 45px rgba(0,0,0,0.8);
      overflow: hidden;
    }

    /* Chat side */
    .chat {
      border-right: 1px solid #26293a;
      display: flex;
      flex-direction: column;
    }
    .chat-header {
      padding: 10px 14px;
      border-bottom: 1px solid #26293a;
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: #9ba2ff;
      background: linear-gradient(to right, rgba(60,68,120,0.5), transparent);
    }
    .chat-messages {
      flex: 1;
      padding: 14px;
      overflow-y: auto;
      font-size: 14px;
    }
    .chat-msg {
      margin-bottom: 8px;
      line-height: 1.5;
    }
    .chat-msg strong {
      color: #d4d7ff;
    }
    .chat-input {
      display: flex;
      border-top: 1px solid #26293a;
    }
    .chat-input input {
      flex: 1;
      border: none;
      padding: 10px;
      background: #121522;
      color: #f2f2f7;
      outline: none;
      font-size: 14px;
    }
    .chat-input button {
      border: none;
      padding: 10px 16px;
      background: #2f7df6;
      color: white;
      font-size: 14px;
      cursor: pointer;
      border-radius: 0;
      white-space: nowrap;
    }
    .chat-input button:active {
      transform: translateY(1px);
    }

    /* Control side */
    .controls {
      padding: 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .panel {
      background: rgba(10,12,22,0.95);
      border-radius: 14px;
      padding: 10px 10px 12px 10px;
      border: 1px solid #2a3043;
    }
    .panel h3 {
      margin: 0 0 6px 0;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #a7b0ff;
    }
    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .btn {
      flex: 1;
      min-width: 90px;
      padding: 6px 8px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid #3a4058;
      background: #191e30;
      color: #f2f2f7;
      cursor: pointer;
      text-align: center;
    }
    .btn:active {
      transform: translateY(1px);
    }

    .slider-group {
      display: flex;
      flex-direction: column;
      gap: 3px;
      font-size: 12px;
      margin-bottom: 6px;
    }
    .slider-group label {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #b3b7d2;
    }
    .slider-group input[type="range"] {
      width: 100%;
    }
    .mini-label {
      font-size: 10px;
      color: #7e84a8;
      margin-top: 2px;
    }

    .time-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px 8px;
      font-size: 11px;
    }
    .time-grid label {
      display: flex;
      flex-direction: column;
      gap: 2px;
      color: #c1c6e3;
    }
    .time-grid input[type="time"] {
      background: #151829;
      border: 1px solid #303651;
      border-radius: 6px;
      padding: 3px 4px;
      color: #f2f2f7;
      font-size: 11px;
      outline: none;
    }

    .tag-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
      margin-top: 4px;
    }
    .tag {
      font-size: 10px;
      border-radius: 999px;
      padding: 3px 6px;
      border: 1px solid #333a5b;
      color: #aab0d5;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #090b13;
    }
    ::-webkit-scrollbar-thumb {
      background: #2d3145;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <div class="console">
    <!-- Chat side -->
    <div class="chat">
      <div class="chat-header">Body Rhythm Console · Beta</div>
      <div class="chat-messages" id="chatMessages">
        <div class="chat-msg">
          <strong>App:</strong> Welcome back. Use the sliders and times on the right, then tap a button to see how your system looks tonight.
        </div>
      </div>
      <div class="chat-input">
        <input id="chatInput" placeholder="Type a note or question (optional, not wired to AI yet)...">
        <button onclick="sendChat()">Send</button>
      </div>
    </div>

    <!-- Controls side -->
    <div class="controls">
      <!-- Quick actions -->
      <div class="panel">
        <h3>Quick actions</h3>
        <div class="btn-row">
          <button class="btn" onclick="preset('log_today')">Log today</button>
          <button class="btn" onclick="preset('insight')">Show pattern</button>
          <button class="btn" onclick="preset('forecast')">Forecast tomorrow</button>
        </div>
        <div class="btn-row" style="margin-top:4px;">
          <button class="btn" onclick="preset('explain')">Explain my system</button>
          <button class="btn" onclick="preset('driving')">What is driving today?</button>
        </div>
      </div>

      <!-- State sliders -->
      <div class="panel">
        <h3>State sliders</h3>
        <div class="slider-group">
          <label>
            <span>Stress</span>
            <span id="stressVal">2/10</span>
          </label>
          <input type="range" id="stress" min="0" max="10" value="2" oninput="updateLabel('stress')">
        </div>
        <div class="slider-group">
          <label>
            <span>Shoulder tension</span>
            <span id="shoulderVal">3/10</span>
          </label>
          <input type="range" id="shoulder" min="0" max="10" value="3" oninput="updateLabel('shoulder')">
        </div>
        <div class="slider-group">
          <label>
            <span>Gut comfort</span>
            <span id="gutVal">6/10</span>
          </label>
          <input type="range" id="gut" min="0" max="10" value="6" oninput="updateLabel('gut')">
        </div>
        <div class="slider-group">
          <label>
            <span>Anxiety level</span>
            <span id="anxVal">3/10</span>
          </label>
          <input type="range" id="anx" min="0" max="10" value="3" oninput="updateLabel('anx')">
        </div>
        <p class="mini-label">
          These describe how your nervous system feels right now. In the real version this is what the AI uses to estimate sensitivity and predict mornings.
        </p>
      </div>

      <!-- Timing -->
      <div class="panel">
        <h3>Tonight's timing</h3>
        <div class="time-grid">
          <label>
            Dinner
            <input type="time" id="dinTime" value="19:00">
          </label>
          <label>
            Last food
            <input type="time" id="foodTime" value="19:45">
          </label>
          <label>
            Last drink
            <input type="time" id="drinkTime" value="21:30">
          </label>
          <label>
            Magnesium
            <input type="time" id="magTime" value="23:00">
          </label>
          <label>
            Sleep
            <input type="time" id="sleepTime" value="00:30">
          </label>
          <label>
            Wake
            <input type="time" id="wakeTime" value="08:00">
          </label>
        </div>
        <div class="tag-row">
          <span class="tag">Timing focused</span>
          <span class="tag">Vagus aware</span>
          <span class="tag">Morning stability</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    function addMessage(sender, text) {
      const box = document.getElementById('chatMessages');
      const div = document.createElement('div');
      div.className = 'chat-msg';
      div.innerHTML = `<strong>${sender}:</strong> ${text}`;
      box.appendChild(div);
      box.scrollTop = box.scrollHeight;
    }

    function sendChat() {
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text) return;
      addMessage('You', text);
      input.value = '';
      setTimeout(() => {
        addMessage('App', 'In the full version this text would be interpreted alongside your sliders and timing so the AI can learn your patterns.');
      }, 400);
    }

    function updateLabel(which) {
      if (which === 'stress') {
        const v = document.getElementById('stress').value;
        document.getElementById('stressVal').textContent = `${v}/10`;
      }
      if (which === 'shoulder') {
        const v = document.getElementById('shoulder').value;
        document.getElementById('shoulderVal').textContent = `${v}/10`;
      }
      if (which === 'gut') {
        const v = document.getElementById('gut').value;
        document.getElementById('gutVal').textContent = `${v}/10`;
      }
      if (which === 'anx') {
        const v = document.getElementById('anx').value;
        document.getElementById('anxVal').textContent = `${v}/10`;
      }
    }

    function timeToMinutes(id) {
      const t = document.getElementById(id).value;
      if (!t) return null;
      const [h, m] = t.split(':').map(Number);
      return h * 60 + m;
    }

    function preset(type) {
      const stress = +document.getElementById('stress').value;
      const shoulder = +document.getElementById('shoulder').value;
      const gut = +document.getElementById('gut').value;
      const anx = +document.getElementById('anx').value;

      const tDinner = timeToMinutes('dinTime');
      const tFood = timeToMinutes('foodTime');
      const tDrink = timeToMinutes('drinkTime');
      const tMag = timeToMinutes('magTime');
      const tSleep = timeToMinutes('sleepTime');
      const tWake = timeToMinutes('wakeTime');

      const drinkGap = tMag != null && tDrink != null ? tMag - tDrink : null;
      const foodGap = tSleep != null && tFood != null ? tSleep - tFood : null;

      if (type === 'log_today') {
        addMessage('You', `Log today with stress=${stress}, shoulder=${shoulder}, gut=${gut}, anxiety=${anx}.`);
        addMessage('App', 'Logged this state. In a full build this would be stored and used to refine your personal rhythm model over time.');
      }

      if (type === 'insight') {
        addMessage('You', 'Show me today’s pattern.');
        let msg;

        if (drinkGap !== null && drinkGap < 75) {
          msg = 'Your last drink is fairly close to magnesium. On your kind of system, mornings tend to be softer or more unpredictable when the gap is under 75 to 90 minutes.';
        } else if (shoulder >= 7) {
          msg = 'Shoulder tension is high. On days like this, splenic flexure and left side sensitivity often show up even if digestion is fine. This is more nervous system than gut.';
        } else if (anx >= 6 && stress >= 6) {
          msg = 'Both stress and anxiety are elevated. This usually raises your internal volume knob and makes normal sensations feel louder, even when timing is decent.';
        } else if (gut >= 7 && stress <= 3 && (drinkGap === null || drinkGap >= 90)) {
          msg = 'This looks close to your stable rhythm: decent gut comfort, low stress, and a solid gap between last drink and magnesium. That is usually a strong setup for a predictable morning.';
        } else {
          msg = 'Today looks mixed. Nothing screams disaster, but sensitivity is a bit elevated. Small improvements in cutoff or evening calm will likely pay off tomorrow.';
        }

        addMessage('App', msg);
      }

      if (type === 'forecast') {
        addMessage('You', 'What is the forecast for tomorrow?');

        let msg = 'Given this setup, tomorrow looks like a “sensitive but workable” morning. Not perfect, not terrible. Expect a bit more awareness than pain.';

        if (drinkGap !== null && drinkGap >= 90 && stress <= 3 && anx <= 3 && shoulder <= 4 && gut >= 6) {
          msg = 'This is one of your stronger setups. I would expect a single mostly solid morning BM, low pain, and a quieter nervous system overall.';
        } else if (drinkGap !== null && drinkGap < 60) {
          msg = 'Tomorrow has a higher chance of a soft or partially watery morning, mostly due to the tight drink to magnesium gap. Not dangerous, just less stable.';
        } else if (anx >= 7 || stress >= 7) {
          msg = 'Tomorrow may feel louder in your body even if the gut behaves. Expect a little more internal noise, mostly driven by nervous system state rather than true gut trouble.';
        }

        addMessage('App', msg);
      }

      if (type === 'explain') {
        addMessage('You', 'Explain my system.');
        const msg = 'You have a timing sensitive, nervous system heavy pattern. Evenings with calm stress, lower shoulder tension, and a clear cutoff between last drink and magnesium usually give you stable mornings. When stress, anxiety, or shoulder tension run high, your sensitivity goes up even if nothing is “wrong” in the gut itself.';
        addMessage('App', msg);
      }

      if (type === 'driving') {
        addMessage('You', 'What is driving today?');
        let drivers = [];

        if (drinkGap !== null && drinkGap < 75) {
          drivers.push('tight last drink to magnesium gap');
        }
        if (shoulder >= 6) {
          drivers.push('shoulder and neck tension');
        }
        if (anx >= 6) {
          drivers.push('anxiety level');
        }
        if (stress >= 6) {
          drivers.push('overall stress load');
        }

        if (drivers.length === 0) {
          addMessage('App', 'Nothing is screaming as a strong driver today. This looks more like a “fine tune and watch what happens” kind of day rather than a clear trigger day.');
        } else {
          addMessage('App', `The main drivers tonight look like: ${drivers.join(', ')}. Those are the knobs that usually change your sensitivity the most.`);
        }
      }
    }
  </script>
</body>
</html>
